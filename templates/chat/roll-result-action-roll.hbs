{{eLog "CHAT ACTION ROLL RESULT CONTEXT" this}}



<div class="blades-roll roll-type-{{case "lower" rollType}} roll-position-{{finalPosition}} roll-effect-{{finalEffect}} roll-result-{{rollResult}}"
  data-chat-id="{{chatMsgID}}"
  data-roll-id="{{rollID}}"
  data-user-id="{{flagData.rollUserID}}"
  data-primary-id="{{flagData.rollPrimaryData.rollPrimaryID}}"
  data-primary-type="{{flagData.rollPrimaryData.rollPrimaryType}}"
  data-position="{{finalPosition}}"
  data-effect="{{finalEffect}}"
  data-result="{{rollResult}}"
  data-roll-phase="{{flagData.rollPhase}}">

  {{!-- Roll Primary Portrait --}}
  <div class="chat-message-speaker-portrait-wrapper">
  <div class="chat-message-speaker-portrait">
    <img class="portrait-image" src="{{rollPrimary.rollPrimaryImg}}" />
    <div class="chat-message-speaker-portrait-overlay"></div>
  </div>
  </div>

  {{!-- Floating Backgrounds --}}
  <div class="chat-message-bg roll-position-{{finalPosition}}"></div>
  <div class="chat-result-bg roll-position-{{finalPosition}} roll-result-{{rollResult}}"></div>

  {{!-- Roll Trait  --}}
  <h1 class="chat-header roll-trait">
    <span class="trait-label">{{case "upper" rollTrait}}</span>
  </h1>

  {{!-- Opposition --}}
  {{#if rollOpposition}}
  <h3 class="chat-header roll-opposition">
    <span class="vs">vs.</span>
    <span class="opp-name">{{case "title" rollOpposition.rollOppName}}</span>
  </h3>
  {{/if}}

  {{!-- Dice Rolls --}}
  <div class="dice-roll-strip">{{{dieValsHTML}}}</div>

  {{!-- Position / Result / Effect --}}
  <div class="roll-outcome-container roll-result-{{rollResult}} flex-horizontal full-width">

    {{!-- Position --}}
    <div class="roll-state-container flex-vertical">
      <h3 class="roll-state roll-state-position roll-state-position-{{finalPosition}}">{{case "title" finalPosition}}</h3>
      <h4 class="roll-state-label">Position</h4>
    </div>

    {{!-- Result --}}
    <div class="roll-result-container roll-result-{{rollResult}} flex-vertical">
      {{#if (test rollResult "==" "critical")}}
      <h2 class="roll-result-label roll-result-top-label">Critical</h2>
      <h3 class="roll-result-label roll-result-bottom-label">Success!</h3>
      {{else if (test rollResult "==" "success")}}
      <h2 class="roll-result-label roll-result-main-label">Success!</h2>
      {{else if (test rollResult "==" "partial")}}
      <h2 class="roll-result-label roll-result-top-label">Success</h2>
      <h3 class="roll-result-label roll-result-bottom-label">with Consequences:</h3>
      {{else if (test rollResult "==" "fail")}}
      <h2 class="roll-result-label roll-result-main-label">Fail</h2>
      {{/if}}
    </div>

    {{!-- Effect --}}
    <div class="roll-state-container flex-vertical">
      <h3 class="roll-state roll-state-effect roll-state-effect-{{finalEffect}}">{{case "title" finalEffect}}</h3>
      <h4 class="roll-state-label">Effect</h4>
    </div>

  </div>

  {{!-- Consequences --}}
  {{#if (test rollResult "==" "partial")}}
  <div class="consequence-container flex-vertical full-width">
  {{#with (lookup flagData.consequenceData finalPosition) as |csqData|}}
  {{#each csqData.partial as |cData cIndex|}}
    {{eLog "ConsequenceContainer" cIndex csqData cData}}
    {{#if cData.resistTo}}
    {{> "systems/eunos-blades/templates/components/consequence.hbs" cData
      flagData=../../flagData }}
    {{/if}}
  {{/each}}
  {{/with}}
  </div>
  {{/if}}
  {{#if (test rollResult "==" "fail")}}
  <div class="consequence-container flex-vertical full-width">
  {{#with (lookup flagData.consequenceData finalPosition) as |csqData|}}
  {{#each csqData.fail as |cData cIndex|}}
    {{#if cData.resistTo}}
    {{> "systems/eunos-blades/templates/components/consequence.hbs" cData
      flagData=../../flagData }}
    {{/if}}
  {{/each}}
  {{/with}}
  </div>
  {{/if}}
</div>
