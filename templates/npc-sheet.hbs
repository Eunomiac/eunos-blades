<form class="{{cssClass}} actor-sheet" autocomplete="off">

  {{!-- Actor Img: Portrait --}}
  <img class="sheet-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
  {{#unless (test actor.img "==" "icons/svg/mystery-man.svg")}}
  <div class="sheet-img-bg full-width">
    <img src="{{actor.img}}" />
  </div>
  {{/unless}}

  {{!-- SubActor GM Alert --}}
  {{#if isGM}}{{#if isSubActor}}
  <div class="gm-alert-header">Editing as SubActor of {{parentActor.name}}</div>
  {{/if}}{{/if}}

  {{!-- Tags --}}
  {{#if isGM}}
  <input type="text" class="comp-tags tags-gm" />
  {{/if}}

  {{!-- Sheet Container --}}
  <div class="sheet-root">

    {{!-- Header --}}
    <section class="sheet-top">

      <input class="sheet-title shadowed" type="text" name="name" value="{{actor.name}}" placeholder="Who Are You?" />

      {{#if isSubActor}}
      {{#if (test "Acquaintance" "in" system.tags)}}
      <div class="comp comp-vertical comp-status">
        <label class="comp-label shadowed">status</label>
        <div class="comp-body">
          <div class="comp-title comp-status-toggle shadowed">
          {{#if (test actor.system.status "==" -1)}}
        <span class="status-negative">▼</span>
            {{!-- <i class="fa-sharp fa-solid fa-caret-up fa-rotate-180"></i> --}}
          {{else}}{{#if (test actor.system.status "==" 1)}}
        <span class="status-positive">▲</span>
              {{!-- <i class="fa-sharp fa-solid fa-caret-up"></i> --}}
            {{else}}
        <span class="status-neutral">◊</span>
                {{!-- <i class="fa-sharp fa-regular fa-diamond"></i> --}}
            {{/if}}
          {{/if}}
          </div>
        </div>
      </div>
      {{/if}}
      {{/if}}

      <input class="comp comp-concept sheet-subtitle shadowed" type="text" name="system.concept"
        value="{{system.concept}}" placeholder="Concept" />

      <div class="flex-horizontal comp-horizontal comp comp-labeled-input comp-district">
        <label class="comp-label shadowed">District:</label>
        <input class="comp-tags tags-district" data-tag-target="system.district" type="text">
      </div>

      <div class="flex-horizontal comp-horizontal comp comp-labeled-input comp-faction">
        <label class="comp-label shadowed">Faction:</label>
        <!-- Find a faction subactor with tag = 'Member' and extract name to here -->
      </div>

      <div class="comp comp-traits">
        <div class="comp comp-randomizer-field field-size-half">

          {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
            isToggled=system.persona.trait1.isLocked
            activeClass="fa-solid fa-lock"
            activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
            inactiveClass="fa-regular fa-lock-open"
            inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
            targetKey="system.persona.trait1.isLocked"
            targetFlagKey=false
          }}


          <input class="shadowed randomizer-input" type="text" name="system.persona.trait1.value" value="{{system.persona.trait1.value}}" placeholder="Trait">
        </div>

        <div class="comp comp-randomizer-field field-size-half">
          {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
          isToggled=system.persona.trait2.isLocked
          activeClass="fa-solid fa-lock"
          activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
          inactiveClass="fa-regular fa-lock-open"
          inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
          targetKey="system.persona.trait2.isLocked" }}
          <input class="shadowed randomizer-input" type="text" name="system.persona.trait2.value" value="{{system.persona.trait2.value}}" placeholder="Trait">
        </div>

        <div class="comp comp-randomizer-field field-size-half">
          {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
          isToggled=system.persona.trait3.isLocked
          activeClass="fa-solid fa-lock"
          activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
          inactiveClass="fa-regular fa-lock-open"
          inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
          targetKey="system.persona.trait3.isLocked" }}
          <input class="shadowed randomizer-input" type="text" name="system.persona.trait3.value" value="{{system.persona.trait3.value}}" placeholder="Trait">
        </div>
      </div>

      <div class="comp comp-traits comp-secret-trait">
        <div class="comp comp-randomizer-field field-size-half">
          {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
          isToggled=system.secret.trait.isLocked
          activeClass="fa-solid fa-lock"
          activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
          inactiveClass="fa-regular fa-lock-open"
          inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
          targetKey="system.secret.trait.isLocked" }}
          <input class="shadowed secret-trait randomizer-input" type="text" name="system.secret.trait.value" value="{{system.secret.trait.value}}" placeholder="Trait">
        </div>
      </div>

      <input class="comp comp-short-description shadowed" type="text" name="system.subtitle"
        value="{{system.subtitle}}" placeholder="Short Description">

    </section>

    {{!-- Tabs, Tab Navigation --}}
    <section class="tab-content nav-group flex-vertical">

      {{!-- Nav menu --}}
      <nav class="nav-tabs flex-horizontal full-width">
        <a class="tab-selector" data-tab="description">Description</a>
        <a class="tab-selector" data-tab="friends-and-foes">Friends & Foes</a>
        {{#if isGM}}
        <a class="tab-selector" data-tab="randomizer">Randomizer</a>
        {{/if}}
      </nav>

      {{!-- Description --}}
      <div class="tab description flex-vertical" data-tab="description">
        {{editor system.description target="system.description" button=true owner=owner editable=editable}}
      </div>

      {{!-- Friends & Foes --}}
      <div class="tab friends-and-foes flex-vertical" data-tab="friends-and-foes">
        <div class="flex-horizontal full-width">
          <div class="comp-connections-list allies-list">
            <label class="comp tab-label"><span class="tab-title">Allies</span></label>
          </div>
          <div class="comp-connections-list enemies-list">
            <label class="comp tab-label"><span class="tab-title">Enemies</span></label>
          </div>
          <div class="comp-connections-list others-list">
            <label class="comp tab-label"><span class="tab-title">Others</span></label>
          </div>
        </div>
      </div>

      {{!-- Randomizer --}}
      {{#if isGM}}
      <div class="tab randomizer flex-vertical" data-tab="randomizer">
        {{> "systems/eunos-blades/templates/components/button-icon.hbs"
        blockClass="randomize-button"
        buttonClass="fa-fade fa-shuffle fa-flip-horizontal"
        tooltip="<b>Randomize!</b>"
        action="randomize"
        }}

        <div class="randomizer">

          {{#each random as |data key|}}
          <div class="comp comp-randomizer-field field-size-{{data.size}}">
            {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
            isToggled=data.isLocked
            activeClass="fa-solid fa-lock"
            activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
            inactiveClass="fa-regular fa-lock-open"
            inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
            targetKey=(concat "system.random." key ".isLocked") }}
            {{#if data.label}}
            <label class="comp-label shadowed randomizer-label">{{data.label}}</label>
            {{/if}}
            <input class="randomizer-input" type="text" value="{{data.value}}"
              name="system.random.{{key}}.value" />
          </div>
          {{/each}}

          {{#each persona as |data key|}}
          {{#unless (isIn key "trait1" "trait2" "trait3")}}
          <div class="comp comp-randomizer-field field-size-{{data.size}}">
            {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
            isToggled=data.isLocked
            activeClass="fa-solid fa-lock"
            activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
            inactiveClass="fa-regular fa-lock-open"
            inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
            targetKey=(concat "system.persona." key ".isLocked") }}
            {{#if data.label}}
            <label class="comp-label shadowed randomizer-label">{{data.label}}</label>
            {{/if}}
            <input class="randomizer-input" type="text" value="{{data.value}}"
              name="system.persona.{{key}}.value" />
          </div>
          {{/unless}}
          {{/each}}

          <h2 class="full-width">Secrets</h2>
          {{#each secret as |data key|}}
          {{#unless (isIn key "trait")}}
          <div class="comp comp-randomizer-field field-size-{{data.size}}">
            {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
            isToggled=data.isLocked
            activeClass="fa-solid fa-lock"
            activeTooltip="<b>Field Frozen</b><br>Click to Randomize"
            inactiveClass="fa-regular fa-lock-open"
            inactiveTooltip="<b>Randomizing Field</b><br>Click to Freeze"
            targetKey=(concat "system.secret." key ".isLocked") }}
            {{#if data.label}}
            <label class="comp-label shadowed randomizer-label">{{data.label}}</label>
            {{/if}}
            <input class="randomizer-input" type="text" value="{{data.value}}"
              name="system.secret.{{key}}.value" />
          </div>
          {{/unless}}
          {{/each}}

        </div>
      </div>
      {{/if}}
    </section>
  </div>
</form>