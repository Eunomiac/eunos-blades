    {{#with rollPosition as |rollPosition|}}
    {{#with (lookup @root.consequenceData rollPosition) as |csqData|}}
    {{#with (lookup @root.consequenceTypeOptions rollPosition) as |csqTypeOptions|}}
    {{#with @root.consequenceTypeOptionsAll as |csqTypeOptionsAll|}}
    {{#with @root.consequenceAttributeOptions as |csqAttrOptions|}}

    <div class="consequence-section consequence-section-{{rollPosition}} full-width">
      <h1 class="consequence-header-{{rollPosition}}">{{case "title" rollPosition}} Position</h1>

      <h2 class="consequence-subheader-{{rollPosition}}-partial">On Partial Success</h2>
      {{#with "partial" as |rollResult|}}
      {{#each (lookup csqData rollResult) as |cData cIndex|}}
        {{#if cData}}
        <div class="roll-consequence-row flex-vertical full-width">
          <div class="comp consequence-display-container roll-consequence-entry-row full-width flex-horizontal">
            {{!-- Icon --}}
            <div class="consequence-icon-container" style="position: relative;">
              <div class="consequence-icon-circle">
              {{{compileSvg cData.type cData.icon}}}
              </div>
            </div>
            {{!-- Type --}}
            {{> "systems/eunos-blades/templates/components/select.hbs"
              cssClass="roll-consequence-type-select"
              dataAction="gm-select"
              dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".type")
              dataDType="String"
              dataDocType=false
              selected=cData.type
              options=(lookup csqTypeOptions rollResult)
            }}
            {{!-- Attribute --}}
            {{> "systems/eunos-blades/templates/components/select.hbs"
              cssClass="roll-consequence-attribute-select"
              dataAction="gm-select"
              dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".attribute")
              dataDType="String"
              dataDocType=false
              selected=cData.attribute
              options=csqAttrOptions
            }}
            {{!-- AI Trigger --}}
            {{> "systems/eunos-blades/templates/components/button-icon.hbs"
              blockClass="ai-query-button"
              buttonClass="fa-solid fa-brain-circuit"
              tooltip="<b>Query AI</b><br>Query OpenAI for suggestions on resisted versions of this consequence."
              action=(concat "ai-query-" rollPosition "-" rollResult "-" cIndex)
            }}
            {{!-- Name --}}
            <input class="shadowed consequence-name" type="text" value="{{cData.name}}" data-action="gm-update-dialog" data-flag-target="rollCollab.consequenceData.{{rollPosition}}.{{rollResult}}.{{cIndex}}.name" />
            {{!-- Armor Toggles --}}
            {{#if cData.canArmorA}}
              {{> "systems/eunos-blades/templates/components/toggle-icon.hbs"
                isToggled=cData.canArmorB
                activeClass="fa-sharp fa-solid fa-shield"
                inactiveClass="fa-sharp fa-solid fa-shield-halved"
              }}
            {{/if}}
          </div>
          {{!-- AI Options --}}
          <div class="flex-vertical consequence-resist-options-container">
            {{#each cData.resistOptions as |rData rIndex|}}
            <div class="flex-horizontal consequence-resist-option">
              {{!-- Select Resist Option --}}
              {{#if rData.isSelected}}
                {{> "systems/eunos-blades/templates/components/button-icon.hbs"
                  blockClass="resist-select-button"
                  buttonClass="fa-solid fa-star gold-bright"
                  tooltip="<b>Selected AI Suggestion</b><br>Click to Deselect"
                  action=(concat "gm-select-toggle-" rollPosition "-" rollResult "-" cIndex "-" rIndex)
                }}
              {{else}}
                {{> "systems/eunos-blades/templates/components/button-icon.hbs"
                  blockClass="resist-select-button"
                  buttonClass="fa-regular fa-star grey"
                  tooltip="<b>AI Suggestion</b><br>Click to Select."
                  action=(concat "gm-select-toggle-" rollPosition "-" rollResult "-" cIndex "-" rIndex)
                }}
              {{/if}}
              {{!-- Type --}}
              {{> "systems/eunos-blades/templates/components/select.hbs"
                cssClass="roll-consequence-type-select"
                dataAction="gm-select"
                dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".resistOptions." rIndex ".type")
                dataDType="String"
                dataDocType=false
                selected=rData.type
                options=csqTypeOptionsAll }}
              {{!-- Name --}}
              <input class="shadowed consequence-name" type="text" value="{{rData.name}}" data-action="gm-update-dialog" data-flag-target="rollCollab.consequenceData.{{rollPosition}}.{{rollResult}}.{{cIndex}}.resistOptions.{{rIndex}}.name" />
            </div>
            {{/each}}
          </div>
        </div>
        {{/if}}
      {{/each}}
      {{/with}}

      <h2 class="consequence-subheader-{{rollPosition}}-fail">On Failure</h2>
      {{#with "fail" as |rollResult|}}
      {{#each (lookup csqData rollResult) as |cData cIndex|}}
        {{#if cData}}
        <div class="roll-consequence-row flex-vertical full-width">
          <div class="comp consequence-display-container roll-consequence-entry-row full-width flex-horizontal">
            {{!-- Icon --}}
            <div class="consequence-icon-container" style="position: relative;">
              <div class="consequence-icon-circle">
              {{{compileSvg cData.type cData.icon}}}
              </div>
            </div>
            {{!-- Type --}}
            {{> "systems/eunos-blades/templates/components/select.hbs"
              cssClass="roll-consequence-type-select"
              dataAction="gm-select"
              dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".type")
              dataDType="String"
              dataDocType=false
              selected=cData.type
              options=(lookup csqTypeOptions rollResult)
            }}
            {{!-- Attribute --}}
            {{> "systems/eunos-blades/templates/components/select.hbs"
              cssClass="roll-consequence-attribute-select"
              dataAction="gm-select"
              dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".attribute")
              dataDType="String"
              dataDocType=false
              selected=cData.attribute
              options=csqAttrOptions
            }}
            {{!-- AI Trigger --}}
            {{> "systems/eunos-blades/templates/components/button-icon.hbs"
              blockClass="ai-query-button"
              buttonClass="fa-solid fa-brain-circuit"
              tooltip="<b>Query AI</b><br>Query OpenAI for suggestions on resisted versions of this consequence."
              action=(concat "ai-query-" rollPosition "-" rollResult "-" cIndex)
            }}
            {{!-- Name --}}
            <input class="shadowed consequence-name" type="text" value="{{cData.name}}" data-action="gm-update-dialog" data-flag-target="rollCollab.consequenceData.{{rollPosition}}.{{rollResult}}.{{cIndex}}.name" />
          </div>
          {{!-- AI Options --}}
          <div class="flex-vertical consequence-resist-options-container">
            {{#each cData.resistOptions as |rData rIndex|}}
            <div class="flex-horizontal consequence-resist-option">
              {{!-- Select Resist Option --}}
              {{#if rData.isSelected}}
                {{> "systems/eunos-blades/templates/components/button-icon.hbs"
                  blockClass="resist-select-button"
                  buttonClass="fa-solid fa-star gold-bright"
                  tooltip="<b>Selected AI Suggestion</b><br>Click to Deselect"
                  action=(concat "gm-select-toggle-" rollPosition "-" rollResult "-" cIndex "-" rIndex)
                }}
              {{else}}
                {{> "systems/eunos-blades/templates/components/button-icon.hbs"
                  blockClass="resist-select-button"
                  buttonClass="fa-regular fa-star grey"
                  tooltip="<b>AI Suggestion</b><br>Click to Select."
                  action=(concat "gm-select-toggle-" rollPosition "-" rollResult "-" cIndex "-" rIndex)
                }}
              {{/if}}
              {{!-- Type --}}
              {{> "systems/eunos-blades/templates/components/select.hbs"
                cssClass="roll-consequence-type-select"
                dataAction="gm-select"
                dataFlagTarget=(concat "rollCollab.consequenceData." rollPosition "." rollResult "." cIndex ".resistOptions." rIndex ".type")
                dataDType="String"
                dataDocType=false
                selected=rData.type
                options=csqTypeOptionsAll }}
              {{!-- Name --}}
              <input class="shadowed consequence-name" type="text" value="{{rData.name}}" data-action="gm-update-dialog" data-flag-target="rollCollab.consequenceData.{{rollPosition}}.{{rollResult}}.{{cIndex}}.resistOptions.{{rIndex}}.name" />
            </div>
            {{/each}}
          </div>
        </div>
        {{/if}}
      {{/each}}
      {{/with}}
    </div>

{{/with}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}
