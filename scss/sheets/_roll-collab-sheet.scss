
& {
  $heights: (70px, 70px);
  --sheet-top-height: #{calculate-sum($heights)};
  min-width: 550px;
  // max-width: 500px;
  // min-height: 400px;
  // max-height: 400px;
  overflow: visible;
  box-shadow: none;
  height: auto !important;

  * {
    --content-padding: 0px;
  }

  .window-header {
    opacity: 0;
    top: 3px;
    position: absolute;
    width: 80%;
    left: 10%;
    z-index: 10;
    transition: 0.25s;

    &:hover { opacity: 1 }
  }

  .window-content {
    border-radius: 30px;
    box-shadow: 25px 25px 15px var(--blades-black-dark-fade);
    border: 3px outset var(--blades-white);
    background: var(--blades-black);
    // overflow: hidden;

    form {
      .sheet-root {
        overflow: visible;

        .split-root {
          align-items: stretch;
          position: relative;

          .split-root-left {
            flex-basis: 75%;
            overflow: visible;
            position: relative;
            z-index: 2;

            section.sheet-top {
              display: block;
              height: auto;

              .roll-type {
                width: 100%;
                background: transparent;
                font-family: var(--font-emphasis);
                color: var(--blades-white-bright);
                margin: 0 0 0 15px;
                font-size: toRem(24px);
                line-height: toRem(24px);
                text-transform: uppercase;
                text-align: left;

                .source-name {
                  color: var(--blades-gold-bright);
                  transform-origin: 0 50%;
                  scale: 1.2;
                }
              }
            }

            section.sheet-main {
              justify-content: flex-start;
              align-items: flex-start;
              height: auto;
              overflow: visible;

              .roll-sheet-block {
                border-top: 2px solid var(--blades-white-bright);
                // padding: 0px 0px 5px 0px;
                align-items: flex-start;
                justify-content: flex-start;
                position: relative;
                gap: 5px 5px;

                &.rolling-block {
                  min-height: 62px;

                  .roll-sheet-sub-block.roll-effects-block {
                    width: 90%;
                  }

                  .roll-sheet-sub-block {
                    &.roll-header-block {
                      .roll-sheet-select, .roll-readonly {
                        background: var(--blades-white-bright);
                        color: var(--blades-black);
                        border: none;
                        text-align: center;
                        font-size: toRem(18px);
                        font-style: normal;
                        margin-left: 0;
                        position: unset;
                        margin-top: -2px;

                        &.roll-sheet-select {
                          text-align: right;
                          padding-right: 15px;

                        }
                      }
                    }
                  }
                }

                .roll-sheet-sub-block {
                  justify-content: flex-start;
                  flex-wrap: wrap;
                  align-items: stretch;

                  &.roll-header-block {
                    height: 24px;

                    .filled-label {
                      background: transparent;
                      color: var(--blades-white);
                      font-size: toRem(16px);
                      line-height: 20px;
                      height: 20px;
                      margin-top: 0;
                      margin-bottom: 5px;
                      padding: 1px 4px;
                      margin: 0;
                      padding: 0 4px;
                      display: inline-block;
                      width: 90px;
                    }
                    .roll-sheet-select, .roll-readonly {
                      margin: 0;
                      font-family: var(--font-emphasis);
                      border-top: none;
                      outline: none;
                      box-shadow: none;
                      text-shadow: none;
                      color: var(--blades-grey);
                      font-size: toRem(14px);
                      // font-style: italic;
                      // text-align: center;
                      margin-left: 40px;
                      display: inline-block;
                      text-transform: uppercase;
                      width: 110px;
                      position: absolute;
                      right: 155px;
                      text-align: right;
                      line-height: 20px;
                      appearance: none;
                    }

                    .roll-dotline-block {
                      display: inline-flex;
                      margin-left: 5px;
                      // background: var(--blades-white-bright);
                      // padding-right: 25px;

                      .dotline {
                        // margin-top: -2px;
                        .dot.full-dot .img-main {
                          filter: brightness(1.5) drop-shadow(0 0 2px var(--blades-black-dark));
                          // filter: brightness(1.5) invert(1);
                        }
                      }
                    }
                  }
                  &.roll-effects-block {
                    width: 100%;
                    margin: 0;
                    padding: 0;

                    > .roll-mod-block-spacer {
                      display: inline-flex;
                      flex-grow: 1;
                      flex-shrink: 1;
                      flex-basis: 0px;
                      height: 20px;


                      &.last-spacer {
                        display: none;
                        flex-grow: 0;
                        flex-shrink: 0;
                        width: 155px;
                        height: 20px;
                        display: inline-flex;
                        margin-left: auto;
                      }
                    }

                    > .roll-mod-container {
                      flex-grow: 0;
                      flex-shrink: 0;

                    }

                    &.inactive-mod-block {
                      position: absolute;
                      width: auto;
                      max-width: 175px;
                      margin: 0;
                      // left: calc(-50% - 3px);
                      right: calc(100% + 3px);
                      background: rgb(24, 24, 24);
                      top: 0px;
                      padding: 0 0 2px 5px;
                      outline: 1px solid var(--blades-white);

                      .roll-mod-container {
                        display: inline-flex;
                        flex-direction: row;
                        align-items: center;
                        height: 12px;
                        margin: 0;
                        padding: 0;

                        .roll-mod {
                          margin: 0;
                          padding: 0;
                          border: none;
                          background: transparent;
                          margin-right: 7px;
                          white-space: nowrap;
                          font-size: 10px;
                          height: 10px;
                          line-height: 10px;
                          color: var(--roll-mod-text-color, var(--blades-grey-bright));

                          &::before {
                            content: var(--roll-mod-bullet-symbol, "●");
                            color: var(--roll-mod-bullet-color, var(--blades-white-bright));
                            padding-right: 3px;
                            vertical-align: top;
                            line-height: 8px;
                            font-size: 14px;
                          }

                          &:hover {
                            color: var(--roll-mod-hover-text-color, var(--blades-gold));
                            background: var(--roll-mod-hover-bg-color, var(--blades-grey));
                            outline: 2px solid var(--roll-mod-hover-bg-color, var(--blades-grey));
                          }

                          &.roll-mod-ability {
                            --roll-mod-text-color: var(--blades-grey-bright);
                            --roll-mod-bullet-color: var(--blades-white-bright);
                            --roll-mod-hover-text-color: var(--blades-gold);
                            --roll-mod-hover-bg-color: var(--blades-grey);
                            --roll-mod-bullet-symbol: "♦";
                          }
                        }
                      }


                    }
                  }
                }

                .roll-sheet-float-block {
                  position: absolute;
                  z-index: 3;

                  &.rolling-dice-total-block {
                    left: unset;
                    right: 0px;
                    height: 64px;
                    width: 64px;
                    border-radius: 32px;
                    border: 2px solid var(--blades-white);
                    background: var(--blades-grey);
                    translate: 50% 0%;
                    top: -2px;
                    display: flex;
                    justify-content: center;
                    align-items: center;

                    .dice-total {
                      display: block;
                      // position: absolute;
                      font-size: 50px;
                      margin-right: 10px;
                      font-family: var(--font-emphasis);
                      color: var(--blades-white-bright);
                      padding-top: 5px;
                      // margin: auto auto;
                      // height: 100%;
                      // width: 100%;
                      // translate: 0% -50%;
                      // top: 50%;
                      // text-align: center;
                      // padding-right: 15px;

                    }

                    .d-symbol {
                      display: block;
                      position: absolute;
                      font-size: 20px;
                      right: 7px;
                      top: 10px;
                      font-family: var(--font-emphasis);

                      text-shadow:
                        0 0 3px var(--blades-black),
                        0 0 3px var(--blades-black),
                        0 0 3px var(--blades-black),
                        0 0 3px var(--blades-black);
                    }
                  }
                  &.final-block {
                    height: 24px;
                    width: 150px;
                    font-family: var(--font-emphasis);
                    text-transform: uppercase;
                    background: var(--final-block-background-color, var(--blades-grey));
                    color: var(--final-block-text-color, var(--blades-white-bright));
                    border: 2px solid var(--final-block-border-color, var(--blades-white));
                    border-top: none;
                    font-size: 18px;
                    line-height: 22px;
                    text-align: center;
                    right: 0;
                    top: 0;

                    &.position-final-block {
                      &.position-desperate {
                        --final-block-text-color: var(--blades-red-bright);
                        --final-block-background-color: var(--blades-red-dark-fade);
                        --final-block-border-color: var(--blades-red);
                      }
                      &.position-controlled {
                        --final-block-text-color: var(--blades-cyan-bright);
                        --final-block-background-color: var(--blades-cyan-dark-fade);
                        --final-block-border-color: var(--blades-cyan);
                      }
                    }

                    &.effect-final-block {
                      &.effect-zero {
                        --final-block-text-color: var(--blades-red-dark);
                        --final-block-background-color: transparent;
                        --final-block-border-color: transparent;
                      }
                      &.effect-limited {
                        --final-block-text-color: var(--blades-red-bright);
                        --final-block-background-color: var(--blades-red-dark-fade);
                        --final-block-border-color: var(--blades-red);
                      }
                      &.effect-great {
                        --final-block-text-color: var(--blades-cyan-bright);
                        --final-block-background-color: var(--blades-cyan-dark-fade);
                        --final-block-border-color: var(--blades-cyan);
                      }
                      &.effect-extreme {
                        --final-block-text-color: var(--blades-white-bright);
                        --final-block-background-color: var(--blades-gold-dark);
                        --final-block-border-color: var(--blades-gold-bright);
                      }
                    }

                    &.result-final-block {
                      width: 180px;
                      // right: -15px;
                    }
                  }
                  .pos-effect-trade-block {
                    width: min-content;
                    position: absolute;
                    // text-shadow:
                    //   0 0 3px var(--blades-black),
                    //   0 0 3px var(--blades-black),
                    //   0 0 3px var(--blades-black),
                    //   0 0 3px var(--blades-black);
                    color: var(--blades-white);
                  }
                  &.position-final-block .pos-effect-trade-block {
                    translate: -25% 40%;
                    left: 0px;
                    top: 10px;
                  }
                  &.effect-final-block .pos-effect-trade-block {
                    translate: 25% -40%;
                    right: 0px;
                    top: -10px;
                  }
                }
              }
            }
          }

          .split-root-right {
            flex-basis: 35%;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            flex-direction: column;


            section.sheet-top {
              display: flex;
              flex-direction: column;
              height: auto;

              .roll-sheet-block {
                &.factors-block {
                  .roll-factor {
                    .roll-factor-label { }
                    .roll-factor-value { }
                    .roll-factor-vs {

                    }
                  }
                }
              }
            }

            section.sheet-main {
              flex-grow: 1;
              background: var(--blades-black-dark);
              z-index: 0;

              .roll-opp-block {
                position: relative;
                top: 100px;
                .roll-opp-name {
                  color: var(--opp-name-color, var(--blades-white-bright));

                  &.roll-opp-type-cohort_expert,
                  &.roll-opp-type-npc {--opp-name-color: var(--blades-gold-bright) }
                  &.roll-opp-type-faction {--opp-name-color: #bd6dff }
                  &.roll-opp-type-location {--opp-name-color: #dbe7fd }
                  &.roll-opp-type-ritual {--opp-name-color: #bd6dff }
                  &.roll-opp-type-project,
                  &.roll-opp-type-design { --opp-name-color: #ffdcc0}
                  &.roll-opp-type-cohort_gang { --opp-name-color: var(--blades-red-bright) }
                }

              }

            }
          }
        }

        section.sheet-footer {
          height: 30px;

          .roll-sheet-float-block.roll-button {
            position: absolute;
            width: 100%;
            left: 0;
            // overflow: hidden;

            .roll-odds-strip {
              height: 28px;
              width: 100%;
              border-bottom-left-radius: 30px;
              border-bottom-right-radius: 30px;
              text-align: center;
              line-height: 28px;
              color: var(--blades-gold-dark);
              font-family: var(--font-emphasis);
              font-size: 18px;
              text-shadow: 1.5px 1.5px 0px var(--blades-black-dark);
            }

            .roll-button {
              display: block;
              padding: 0;
              height: 50px;
              width: 120px;
              position: absolute;
              translate: -50% -50%;
              top: 100%;
              left: 50%;
              border-radius: 20px;
              border: 4px outset var(--blades-white);
              background: var(--blades-white-bright);
              color: var(--blades-black-dark);
              font-family: var(--font-emphasis);
              font-size: 32px;
              line-height: 36px;
              transform-origin: 50% 50%;
              transition: 0.25s;
              filter: drop-shadow(3px 3px 5px var(--blades-black));
              opacity: 1;

              &:hover {
                scale: 1.2;
                color: var(--blades-gold-bright);
                text-shadow:
                  0 0 2px var(--blades-black-dark),
                  0 0 2px var(--blades-black-dark),
                  0 0 2px var(--blades-black-dark),
                  0 0 2px var(--blades-black-dark);
              }

              &.roll-readonly {
                // top: 50%;
                opacity: 0;
                height: 40px;
                width: 100px;
                pointer-events: none;
                border-color: var(--blades-grey);
                border-style: inset;
                background: var(--blades-grey-bright);
                color: var(--blades-grey);
                font-size: 24px;
                box-shadow:
                  inset 3px 3px 5px var(--blades-black),
                  inset -3px -3px 5px var(--blades-white-bright);
                filter: brightness(0.5);
                scale: 0.75;
                opacity: 0.75;
              }
            }

          }

          .roll-sheet-float-block.roll-stress-block {
            position: absolute;
            bottom: -24px;
            translate: -50% 0;
            left: 50%;
            font-family: var(--font-emphasis);
            color: var(--blades-red-bright);
            text-shadow:
              0 0 4px var(--blades-black-dark),
              0 0 4px var(--blades-black-dark),
              0 0 4px var(--blades-black-dark),
              0 0 4px var(--blades-black-dark);
          }
          // #747474
        }

        .roll-mod-container {
          margin-right: 3px;
          position: relative;

          .roll-mod {
            display: inline-block;
            height: 16px;
            line-height: 16px;
            border-radius: 8px;
            padding: 0 8px;
            // margin: 2px 4px;
            border: 1px solid var(--roll-mod-border-color, var(--blades-white));
            color: var(--roll-mod-text-color, var(--blades-white-bright));
            background: var(--roll-mod-background-color, var(--blades-grey));
            font-family: var(--font-emphasis);
            text-transform: uppercase;
            font-size: 12px;
            text-shadow:
              0 0 2px var(--blades-black-dark),
              0 0 2px var(--blades-black-dark),
              0 0 2px var(--blades-black-dark),
              0 0 2px var(--blades-black-dark);
            letter-spacing: 0.75px;
            vertical-align: middle;

            &.roll-mod-ability {
              border-radius: 0;
              font-family: Oswald;
              line-height: 14px;
            }

            &.roll-mod-sidestring {
              border-top-right-radius: 0;
              border-bottom-right-radius: 0;
              margin-right: 0;

              ~ .roll-mod-side-string {
                margin: 0 0 0 -8px;
                padding: 0px 6px 0px 2px;
                font-family: Oswald;
                color: var(--blades-black-dark);
                background: var(--roll-mod-active-bright, var(--blades-white));
                text-shadow: none;
                border: none;
                border-top-right-radius: 8px;
                border-bottom-right-radius: 8px;
                font-size: 12px;
                text-transform: uppercase;
                display: inline-block;
                height: 16px;
                line-height: 16px;
                font-weight: bold;
                vertical-align: middle;
              }
            }
            // &.status-hidden { display: none }

            &.posneg-positive, &.posneg-positive ~ .roll-mod-side-string {
              --roll-mod-active-bright: var(--blades-gold-bright);
              --roll-mod-active-dark: var(--blades-gold-dark);
            }
            &.posneg-negative, &.posneg-negative ~ .roll-mod-side-string {
              --roll-mod-active-bright: var(--blades-red-bright);
              --roll-mod-active-dark: var(--blades-red-dark);
            }
            &.status-toggledon {
              --roll-mod-border-color: var(--roll-mod-active-bright);
              --roll-mod-text-color: var(--blades-white-bright);
              --roll-mod-background-color: var(--roll-mod-active-dark);
            }
            &.status-toggledoff {
              --roll-mod-border-color: var(--blades-white);
              --roll-mod-text-color: var(--blades-black-dark);
              --roll-mod-background-color: var(--blades-grey);
              text-shadow: none;
            }
            &.status-forcedon {
              --roll-mod-border-color: var(--roll-mod-active-bright);
              --roll-mod-text-color: var(--roll-mod-active-bright);
              --roll-mod-background-color: var(--blades-black-dark);
              border-width: 1px;
              border-right: none;
              border-left: none;
              line-height: 16px;

            }
            &.status-forcedoff {
              --roll-mod-border-color: var(--blades-grey);
              --roll-mod-text-color: var(--blades-grey);
              --roll-mod-background-color: var(--blades-black-dark);
              border-width: 1px;
              border-right: none;
              border-left: none;
              line-height: 16px;
            }
            &.status-hidden {
              --roll-mod-border-color: var(--blades-grey-dark);
              --roll-mod-text-color: var(--blades-grey);
              --roll-mod-background-color: transparent;
            }
          }
        }

        .roll-num-container {
          height: var(--spread-size, 30px);
          width: calc(var(--spread-count, 7) * var(--spread-size, 30px));

          .roll-num-spread {
            height: 100%;
            display: flex;
            flex-wrap: nowrap;
            justify-content: flex-start;
            align-items: stretch;

            > * {
              height: 100%;
              width: var(--spread-size, 30px);
              flex-grow: 0;
              flex-shrink: 0;
              border: 2px solid var(--spread-color, var(--blades-white));
              font-family: var(--font-emphasis);
              font-size: 18px;
              line-height: 28px;
              color: var(--spread-color, var(--blades-white));
              text-align: center;

              &:hover { filter: brightness(0.8); opacity: 0.8 }
            }

            [data-active="true"] {
              color: var(--spread-puch-color, var(--blades-black-dark));
              text-shadow: none;
              font-weight: bold;
              transform-origin: 50% 50%;
              // scale: 1.2;
            }

            [data-active="true"] ~ * { background: var(--spread-neg-fade, rgba(150, 0, 0, 0.25))}
            .origin-box ~ * { background: var(--spread-pos-fade, rgba(0, 150, 0, 0.25)) }
            [data-active="true"] ~ .origin-box ~ * { background: transparent }
            .origin-box ~ [data-active="true"] ~ * { background: transparent }
            .origin-box { background: var(--spread-center-fade, rgba(150, 150, 0, 0.35))}
            [data-active="true"] { background: var(--spread-puck-color, var(--blades-white-bright)) }


          }
        }
      }
    }
  }
}