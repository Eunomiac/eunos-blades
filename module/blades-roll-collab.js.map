{"version":3,"sources":["../../ts/blades-roll-collab.ts"],"names":[],"mappings":"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","file":"blades-roll-collab.js","sourcesContent":["// #region IMPORTS ~\r\nimport U from \"./core/utilities.js\";\r\nimport C, {BladesActorType, BladesItemType, RollType, RollSubType, RollModStatus, RollModCategory, Action, DowntimeAction, Attribute, Position, Effect, Factor, RollResult, Harm, ConsequenceType} from \"./core/constants.js\";\r\nimport BladesActor from \"./blades-actor.js\";\r\nimport BladesPC from \"./documents/actors/blades-pc.js\";\r\nimport BladesNPC from \"./documents/actors/blades-npc.js\";\r\nimport BladesFaction from \"./documents/actors/blades-faction.js\";\r\nimport BladesCrew from \"./documents/actors/blades-crew.js\";\r\nimport BladesItem from \"./blades-item.js\";\r\nimport BladesActiveEffect from \"./blades-active-effect.js\";\r\nimport {ApplyTooltipListeners} from \"./core/gsap.js\";\r\nimport {EffectChangeData} from \"@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/effectChangeData.js\";\r\n// #endregion\r\n// #region Google Sheets Data Import ~\r\nconst DescriptionChanges: Record<string, string> = {\r\n  \"Battleborn\": \"<p><em>If you 'reduce harm' that means the level of harm you're facing right now is reduced by one.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Bodyguard\": \"<p><em>The protect teamwork maneuver lets you face a consequence for a teammate.</em></p><p><em>If you choose to resist that consequence, this ability gives you +1d to your resistance roll.</em></p><p><em>Also, when you read a situation to gather information about hidden dangers or potential attackers, you get +1 effectwhich means more detailed information.</em></p>\",\r\n  \"Ghost Fighter\": \"<p><em>When you're imbued, you can strongly interact with ghosts and spirit-stuff, rather than weakly interact.</em></p><p><em>When you imbue yourself with spirit energy, how do you do it? What does it look like when the energy manifests?</em></p>\",\r\n  \"Leader\": \"<p><em>This ability makes your cohorts more effective in battle and also allows them to resist harm by using armor.</em></p><p><em>While you lead your cohorts, they won't stop fighting until they take fatal harm (level 4) or you order them to cease.</em></p><p><em>What do you do to inspire such bravery in battle?</em></p>\",\r\n  \"Mule\": \"<p><em>This ability is great if you want to wear heavy armor and pack a heavy weapon without attracting lots of attention. Since your exact gear is determined on-the-fly during an operation, having more load also gives you more options to get creative with when dealing with problems during a score.</em></p>\",\r\n  \"Not to Be Trifled With\": \"<p><em>When you push yourself to activate this ability, you still get one of the normal benefits of pushing yourself (+1d, +1 effect, etc.) in addition to the special ability.</em></p><p><em>If you perform a feat that verges on the superhuman, you might break a metal weapon with your bare hands, tackle a galloping horse, lift a huge weight, etc.</em></p><p><em>If you engage a small gang on equal footing, you don't suffer reduced effect due to scale against a small gang (up to six people).</em></p>\",\r\n  \"Savage\": \"<p><em>You instill fear in those around you when you get violent. How they react depends on the person. Some people will flee from you, some will be impressed, some will get violent in return. The GM judges the response of a given NPC.</em></p><p><em>In addition, when you Command someone who's affected by fear (from this ability or otherwise), take +1d to your roll.</em></p>\",\r\n  \"Vigorous\": \"<p><em>Your healing clock becomes a 3-clock, and you get a bonus die when you recover.</em></p>\",\r\n  \"Sharpshooter\": \"<p><em>When you push yourself to activate this ability, you still get one of the normal benefits of pushing yourself (+1d, +1 effect, etc.) in addition to the special ability.</em></p><p><em>The first use of this ability allows you to attempt long-range sniper shots that would otherwise be impossible with the rudimentary firearms of Duskwall.</em></p><p><em>The second use allows you to keep up a steady rate of fire in a battle (enough to 'suppress' a small gang up to six people), rather than stopping for a slow reload or discarding a gun after each shot. When an enemy is suppressed, they're reluctant to maneuver or attack (usually calling for a fortune roll to see if they can manage it).</em></p>\",\r\n  \"Focused\": \"<p><em>If you 'resist a consequence' of the appropriate type, you avoid it completely.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Ghost Hunter (Arrow-Swift)\": \"<p><em>Your pet functions as a <strong>cohort (Expert: Hunter)</strong>.</em></p><p><em>This ability gives them potency against supernatural targets and the arcane ability to move extremely quickly, out-pacing any other creature or vehicle.</em></p>\",\r\n  \"Ghost Hunter (Ghost Form)\": \"<p><em>Your pet functions as a <strong>cohort (Expert: Hunter)</strong>.</em></p><p><em>This ability gives them potency against supernatural targets and the arcane ability to transform into electroplasmic vapor as if it were a spirit.</em></p>\",\r\n  \"Ghost Hunter (Mind Link)\": \"<p><em>Your pet functions as a <strong>cohort (Expert: Hunter)</strong>.</em></p><p><em>This ability gives them potency against supernatural targets and the arcane ability to share senses and thoughts telepathically with their master.</em></p>\",\r\n  \"Scout\": \"<p><em>A 'target' can be a person, a destination, a good ambush spot, an item, etc.</em></p>\",\r\n  \"Survivor\": \"<p><em>This ability gives you an additional stress box, so you have 10 instead of 9. The maximum number of stress boxes a PC can have (from any number of additional special abilities or upgrades) is 12.</em></p>\",\r\n  \"Tough As Nails\": \"<p><em>With this ability, level 3 harm doesn't incapacitate you; instead you take -1d to your rolls (as if it were level 2 harm). Level 2 harm affects you as if it were level 1 (less effect). Level 1 harm has no effect on you (but you still write it on your sheet, and must recover to heal it). Record the harm at its original levelfor healing purposes, the original harm level applies.</em></p>\",\r\n  \"Alchemist\": \"<p><em>Follow the Inventing procedure with the GM (page 224) to define your first special alchemical formula.</em></p>\",\r\n  \"Artificer\": \"<p><em>Follow the Inventing procedure with the GM (page 224) to define your first spark-craft design.</em></p>\",\r\n  \"Fortitude\": \"<p><em>If you 'resist a consequence' of the appropriate type, you avoid it completely.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Ghost Ward\": \"<p><em>If you make an area anathema to spirits, they will do everything they can to avoid it, and will suffer torment if forced inside the area.</em></p><p><em>If you make an area enticing to spirits, they will seek it out and linger in the area, and will suffer torment if forced to leave.</em></p><p><em>This effect lasts for several days over an area the size of a small room.</em></p><p><em>Particularly powerful or prepared spirits may roll their quality or arcane magnitude to see how well they're able to resist the effect.</em></p>\",\r\n  \"Physicker\": \"<p><em>Knowledge of anatomy and healing is a rare and esoteric thing in Duskwall. Without this ability, any attempts at treatment are likely to fail or make things worse.</em></p><p><em>You can use this ability to give first aid (rolling <strong>Tinker</strong>) to allow your patient to ignore a harm penalty for an hour or two.</em></p>\",\r\n  \"Saboteur\": \"<p><em>You can drill holes in things, melt stuff with acid, even use a muffled explosive, and it will all be very quiet and extremely hard to notice.</em></p>\",\r\n  \"Venomous\": \"<p><em>You choose the type of drug or poison when you get this ability. Only a single drug or poison may be chosenyou can't become immune to any essences, oils, or other alchemical substances.</em></p><p><em>You may change the drug or poison by completing a <strong>long-term project</strong>.</em></p><p><em>When you push yourself to activate this ability, you still get one of the normal benefits of pushing yourself (+1d, +1 effect, etc.) if you're making a roll, in addition to the special ability.</em></p>\",\r\n  \"Infiltrator\": \"<p><em>This ability lets you contend with higher-Tier enemies on equal footing. When you're cracking a safe, picking a lock, or sneaking past elite guards, your effect level is never reduced due to superior Tier or quality level of your opposition.</em></p><p><em>Are you a renowned safe cracker? Do people tell stories of how you slipped under the noses of two Chief Inspectors, or are your exceptional talents yet to be discovered?</em></p>\",\r\n  \"Ambush\": \"<p><em>This ability benefits from preparation so don't forget you can do that in a flashback.</em></p>\",\r\n  \"Daredevil\": \"<p><em>This special ability is a bit of a gamble. The bonus die helps you, but if you suffer consequences, they'll probably be more costly to resist. But hey, you're a daredevil, so no big deal, right?</em></p>\",\r\n  \"The Devil's Footsteps\": \"<p><em>When you push yourself to activate this ability, you still get one of the normal benefits of pushing yourself (+1d, +1 effect, etc.) if you're making a roll, in addition to the special ability.</em></p><p><em>If you perform an athletic feat (running, tumbling, balance, climbing, etc.) that verges on the superhuman, you might climb a sheer surface that lacks good hand-holds, tumble safely out of a three-story fall, leap a shocking distance, etc.</em></p><p><em>If you maneuver to confuse your enemies, they attack each other for a moment before they realize their mistake. The GM might make a fortune roll to see how badly they harm or interfere with each other.</em></p>\",\r\n  \"Expertise\": \"<p><em>This special ability is good for covering for your team. If they're all terrible at your favored action, you don't have to worry about suffering a lot of stress when you lead their group action.</em></p>\",\r\n  \"Ghost Veil\": \"<p><em>This ability transforms you into an intangible shadow for a few moments. If you spend additional stress, you can extend the effect for additional benefits, which may improve your position or effect for action rolls, depending on the circumstances, as usual.</em></p>\",\r\n  \"Reflexes\": \"<p><em>This ability gives you the initiative in most situations. Some specially trained NPCs (and some demons and spirits) might also have reflexes, but otherwise, you're always the first to act, and can interrupt anyone else who tries to beat you to the punch.</em></p><p><em>This ability usually doesn't negate the need to make an action roll that you would otherwise have to make, but it may improve your position or effect.</em></p>\",\r\n  \"Shadow\": \"<p><em>If you 'resist a consequence' of the appropriate type, you avoid it completely.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Rook's Gambit\": \"<p><em>This is the 'jack-of-all-trades' ability. If you want to attempt lots of different sorts of actions and still have a good dice pool to roll, this is the special ability for you.</em></p>\",\r\n  \"Cloak & Dagger\": \"<p><em>This ability gives you the chance to more easily get out of trouble if a covert operation goes haywire. Also, don't forget your <strong class='cyan-bright'>fine</strong> <strong>disguise kit</strong> gear, which boosts the effect of your covert deception methods.</em></p>\",\r\n  \"Ghost Voice\": \"<p><em>The first part of this ability gives you permission to do something that is normally impossible: when you speak to a spirit, it always listens and understands you, even if it would otherwise be too bestial or insane to do so.</em></p><p><em>The second part of the ability increases your effect when you use social actions with the supernatural.</em></p>\",\r\n  \"Like Looking Into a Mirror\": \"<p><em>This ability works in all situations without restriction. It is very powerful, but also a bit of a curse. You see though every lie, even the kind ones.</em></p>\",\r\n  \"A Little Something on the Side\": \"<p><em>Since this money comes at the end of downtime, after all downtime actions are resolved, you can't remove it from your stash and spend it on extra activities until your next downtime phase.</em></p>\",\r\n  \"Mesmerism\": \"<p><em>The victims' memory 'glosses over' the missing time, so it's not suspicious that they've forgotten something.</em></p><p><em>When you next interact with the victim, they remember everything clearly, including the strange effect of this ability.</em></p>\",\r\n  \"Subterfuge\": \"<p><em>If you 'resist a consequence' of the appropriate type, you avoid it completely.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Trust in Me\": \"<p><em>This ability isn't just for social interactions. Any action can get the bonus. 'Intimate' is for you and the group to define, it need not exclusively mean romantic intimacy.</em></p>\",\r\n  \"Foresight\": \"<p><em>You can narrate an event in the past that helps your teammate now, or you might explain how you expected this situation and planned a helpful contingency that you reveal now.</em></p>\",\r\n  \"Calculating\": \"<p><em>If you forget to use this ability during downtime, you can still activate it during the score and flashback to the previous downtime when the extra activity happened.</em></p>\",\r\n  \"Connected\": \"<p><em>Your array of underworld connections can be leveraged to loan assets, pressure a vendor to give you a better deal, intimidate witnesses, etc.</em></p>\",\r\n  \"Functioning Vice\": \"<p><em>If you indulged your vice and rolled a 4, you could increase the result to 5 or 6, or you could reduce the result to 3 or 2 (perhaps to avoid overindulgence).</em></p><p><em>Allies that join you don't need to have the same vice as you, just one that could be indulged alongside yours somehow.</em></p>\",\r\n  \"Ghost Contract\": \"<p><em>The mark of the oath is obvious to anyone who sees it (perhaps a magical rune appears on the skin).</em></p><p><em>When you suffer 'Cursed' harm, you're incapacitated by withering: enfeebled muscles, hair falling out, bleeding from the eyes and ears, etc., until you either fulfill the deal or discover a way to heal the curse.</em></p>\",\r\n  \"Jail Bird\": \"<p><em>Zero is the minimum wanted level; this ability can't make your wanted level negative.</em></p>\",\r\n  \"Mastermind\": \"<p><em>If you protect a teammate, this ability negates or reduces the severity of a consequence or harm that your teammate is facing. You don't have to be present to use this abilitysay how you prepared for this situation in the past.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Weaving the Web\": \"<p><em>Your network of underworld connections can always be leveraged to gain insight for a jobeven when your contacts aren't aware that they're helping you.</em></p>\",\r\n  \"Compel\": \"<p><em>The GM will tell you if you sense any ghosts nearby. If you don't, you can <strong>gather information</strong> (maybe <strong>Attune</strong>, <strong>Survey</strong>, or <strong>Study</strong>) to attempt to locate one.</em></p><p><em>By default, a ghost wants to satisfy its need for life essence and to exact vengeance. When you compel it, you can give it a general or specific command, but the more general it is (like 'Protect me') the more the ghost will interpret it according to its own desires.</em></p><p><em>Your control over the ghost lasts until the command is fulfilled, or until a day has passed, whichever comes first.</em></p>\",\r\n  \"Iron Will\": \"<p><em>With this ability, you do not freeze up or flee when confronted by any kind of supernatural entity or strange occult event.</em></p>\",\r\n  \"Occultist\": \"<p><em>Consorting with a given entity may require special preparations or travel to a specific place. The GM will tell you about any requirements.</em></p><p><em>You get the bonus die to your Command rolls because you can demonstrate a secret knowledge of or influence over the entity when you interact with cultists.</em></p>\",\r\n  \"Ritual\": \"<p><em>Without this special ability, the study and practice of rituals leaves you utterly vulnerable to the powers you supplicate. Such endeavors are not recommended.</em></p>\",\r\n  \"Strange Methods\": \"<p><em>Follow the Inventing procedure with the GM (page 224) to define your first arcane design.</em></p>\",\r\n  \"Tempest\": \"<p><em>When you push yourself to activate this ability, you still get one of the normal benefits of pushing yourself (+1d, +1 effect, etc.) if you're making a roll, in addition to the special ability.</em></p><p><em>When you unleash lightning as a weapon, the GM will describe its effect level and significant collateral damage. If you unleash it in combat against an enemy who's threatening you, you'll still make an action roll in the fight (usually with Attune).</em></p><p><em>When you summon a storm, the GM will describe its effect level. If you're using this power as cover or distraction, it's probably a setup teamwork maneuver, using Attune.</em></p>\",\r\n  \"Warded\": \"<p><em>If you resist a consequence, this ability negates it completely.</em></p><p><em>If you use this ability to push yourself, you get one of the benefits (+1d, +1 effect, act despite severe harm) but you don't take 2 stress.</em></p><p><em>Your special armor is restored at the beginning of downtime.</em></p>\",\r\n  \"Deadly\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\",\r\n  \"Crow's Veil\": \"<p><em>The bells don't ring at the crematorium when a member of your crew kills someone. Do you have a 'membership ritual' now that conveys this talent?</em></p>\",\r\n  \"Emberdeath\": \"<p><em>This ability activates at the moment of the target's death (spend 3 stress then or lose the opportunity to use it). It can only be triggered by a killing blow. Some particularly powerful supernatural entities or specially protected targets may be resistant or immune to this ability.</em></p>\",\r\n  \"No Traces\": \"<p><em>There are many clients who value quiet operations. This ability rewards you for keeping a low profile.</em></p>\",\r\n  \"Patron\": \"<p><em>Who is your patron? Why do they help you?</em></p>\",\r\n  \"Predators\": \"<p><em>This ability applies when the goal is murder. It doesn't apply to other stealth or deception operations you attempt that happen to involve killing.</em></p>\",\r\n  \"Vipers\": \"<p><em>The poison immunity lasts for the entire score, until you next have downtime.</em></p>\",\r\n  \"Dangerous\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\",\r\n  \"Blood Brothers\": \"<p><em>If you have the Elite Thugs upgrade, it stacks with this ability. So, if you had an Adepts gang cohort, and the Elite Thugs upgrade, and then took Blood Brothers, your Adepts would add the Thugs type and also get +1d to rolls when they did Thug-type actions.</em></p><p><em>This ability may result in a gang with three types, surpassing the normal limit of two.</em></p>\",\r\n  \"Door Kickers\": \"<p><em>This ability applies when the goal is to attack an enemy. It doesn't apply to other operations you attempt that happen to involve fighting.</em></p>\",\r\n  \"Fiends\": \"<p><em>The maximum wanted level is 4. Regardless of how much turf you hold (from this ability or otherwise) the minimum rep cost to advance your Tier is always 6.</em></p>\",\r\n  \"Forged In The Fire\": \"<p><em>This ability applies to PCs in the crew. It doesn't confer any special toughness to your cohorts.</em></p>\",\r\n  \"Chosen\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\",\r\n  \"Bound in Darkness\": \"<p><em>By what occult means does your teamwork manifest over distance? How is it strange or disturbing? By what ritualistic method are cult members initiated into this ability?</em></p>\",\r\n  \"Conviction\": \"<p><em>What sort of sacrifice does your deity find pleasing?</em></p>\",\r\n  \"Silver Tongues\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\",\r\n  \"Accord\": \"<p><em>If your status changes, you lose the turf until it becomes +3 again. Regardless of how much turf you hold (from this ability or otherwise) the minimum rep cost to advance your Tier is always 6.</em></p>\",\r\n  \"Ghost Market\": \"<p><em>They do not pay in coin. What do they pay with?</em></p><p><em>The GM will certainly have an idea about how your strange new clients pay, but jump in with your own ideas, too! This ability is usually a big shift in the game, so talk it out and come up with something that everyone is excited about. If it's a bit mysterious and uncertain, that's good. You have more to explore that way.</em></p>\",\r\n  \"The Good Stuff\": \"<p><em>The quality of your product might be used for a fortune roll to find out how impressed a potential client is, to find out how enthralled or incapacitated a user is in their indulgence of it, to discover if a strange variation has side-effects, etc.</em></p>\",\r\n  \"Everyone Steals\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\",\r\n  \"Ghost Echoes\": \"<p><em>You might explore the echo of an ancient building, crumbled to dust in the real world, but still present in the ghost field; or discern the electroplasmic glow of treasures lost in the depths of the canals; or use a sorcerous ghost door from the pre-cataclysm to infiltrate an otherwise secure location; etc.</em></p><p><em>The GM will tell you what echoes persist nearby when you gather information about them. You might also undertake investigations to discover particular echoes you hope to find.</em></p>\",\r\n  \"Pack Rats\": \"<p><em>This ability might mean that you actually have the item you need in your pile of stuff, or it could mean you have extra odds and ends to barter with.</em></p>\",\r\n  \"Slippery\": \"<p><em>The GM might sometimes want to choose an entanglement instead of rolling. In that case, they'll choose two and you can pick between them.</em></p>\",\r\n  \"Synchronized\": \"<p><em>For example, Lyric leads a group action to Attune to the ghost field to overcome a magical ward on the Dimmer Sisters' door. Emily, Lyric's player, rolls and gets a 6, and so does Matt! Because the crew has Synchronized, their two separate 6s count as a critical success on the roll.</em></p>\",\r\n  \"Ghost Passage\": \"<p><em>What do you do to 'carry' a spirit? Must the spirit consent, or can you use this ability to trap an unwilling spirit within?</em></p>\",\r\n  \"Reavers\": \"<p><em>If your vehicle already has armor, this ability gives an additional armor box.</em></p>\",\r\n  \"Renegades\": \"<p><em>Each player may choose the action they prefer (you don't all have to choose the same one).</em></p><p><em>If you take this ability during initial character and crew creation, it supersedes the normal starting limit for action ratings.</em></p>\"\r\n};\r\nconst RollCollabEffectChanges: Partial<Record<BladesItemType.ability|BladesItemType.crew_ability|BladesItemType.crew_upgrade,Record<string,Array<EffectData & {isMember?: boolean, isCohort?: boolean}>>>> = {\r\n  [BladesItemType.ability]: {\r\n    \"Battleborn\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Battleborn@cat:after@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune|command@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Battleborn</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself during a fight.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Battleborn@cat:roll@type:ability@cTypes:Resistance@val:0@eKey:Cost-SpecialArmor|Negate-HarmLevel@status:Hidden@tooltip:<h1>Battleborn</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to reduce the level of <strong class='red-bright'>harm</strong> you are resisting by one.</p>\"\r\n      }\r\n    ],\r\n    \"Bodyguard\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Bodyguard@cat:roll@type:ability@cTypes:Resistance@status:Hidden@tooltip:<h1>Bodyguard</h1><p>When you <strong class='cyan-bright'>protect</strong> a teammate, take <strong class='gold-bright'>+1d</strong> to your <strong>resistance</strong> roll.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Bodyguard@cat:effect@type:ability@cTypes:Engagement@status:Hidden@tooltip:<h1>Bodyguard</h1><p>When you <strong class='cyan-bright'>gather information</strong> to anticipate possible threats in the current situation, you get <strong class='gold-bright'>+1 effect</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Fighter\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Ghost Fighter@cat:effect@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune|command@val:0@eKey:ForceOn-Potency@status:Hidden@tooltip:<h1>Ghost Fighter</h1><p>You may <strong class='cyan-bright'>imbue</strong> your hands, melee weapons, or tools with spirit energy, giving you <strong class='gold-bright'>Potency</strong> in combat vs. the supernatural.</p><p>You may also grapple with spirits to restrain and capture them.</p>\"\r\n      }\r\n    ],\r\n    \"Leader\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Leader@cat:effect@type:ability@cTypes:Action@cTraits:command@status:Hidden@tooltip:<h1>Leader</h1><p>When a <strong class='cyan-bright'>Leader</strong> <strong>Command</strong>s this cohort in combat, it gains <strong class='gold-bright'>+1 effect</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Not to Be Trifled With\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Superhuman Feat@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|command@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Not to Be Trifled With@status:Hidden@tooltip:<h1>Not to Be Trifled With  Superhuman Feat</h1><p>You can <strong>Push</strong> yourself to perform a feat of physical force that verges on the superhuman <em>(you might break a metal weapon with your bare hands, tackle a galloping horse, lift a huge weight, etc.)</em>.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Superhuman Feat@cat:effect@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|command@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Not to Be Trifled With@status:Hidden@tooltip:<h1>Not to Be Trifled With  Superhuman Feat</h1><p>You can <strong>Push</strong> yourself to perform a feat of physical force that verges on the superhuman <em>(you might break a metal weapon with your bare hands, tackle a galloping horse, lift a huge weight, etc.)</em>.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Engage Gang@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune|command@val:0@eKey:Is-Push|ForceOn-Push|Negate-ScalePenalty@sourceName:Not to Be Trifled With@status:Hidden@tooltip:<h1>Not to Be Trifled With  Engage Gang</h1><p>You can <strong>Push</strong> yourself to engage a gang of up to six members on equal footing (negating any <strong>Scale</strong> penalties).</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Engage Gang@cat:effect@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune|command@val:0@eKey:Is-Push|ForceOn-Push|Negate-ScalePenalty@sourceName:Not to Be Trifled With@status:Hidden@tooltip:<h1>Not to Be Trifled With  Engage Gang</h1><p>You can <strong>Push</strong> yourself to engage a gang of up to six members on equal footing (negating any <strong>Scale</strong> penalties).</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Savage\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Savage@cat:roll@type:ability@cTypes:Action@cTraits:command@status:Hidden@tooltip:<h1>Savage</h1><p>When you <strong>Command</strong> a fightened target, gain <strong class='gold-bright'>+1d</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Vigorous\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Vigorous@cat:roll@type:ability@cTypes:Downtime@aTypes:Incarceration@status:Hidden@tooltip:<h1>Vigorous</h1><p>You gain <strong class='gold-bright'>+1d</strong> to <strong>healing treatment</strong> rolls.</p>\"\r\n      }\r\n    ],\r\n    \"Sharpshooter\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Extreme Range@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Sharpshooter@status:Hidden@tooltip:<h1>Sharpshooter  Extreme Range</h1><p>You can <strong>Push</strong> yourself to make a ranged attack at extreme distance, one that would otherwise be impossible with the rudimentary firearms of Duskwall.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Extreme Range@cat:effect@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Sharpshooter@status:Hidden@tooltip:<h1>Sharpshooter  Extreme Range</h1><p>You can <strong>Push</strong> yourself to make a ranged attack at extreme distance, one that would otherwise be impossible with the rudimentary firearms of Duskwall.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Suppression Fire@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Sharpshooter@status:Hidden@tooltip:<h1>Sharpshooter  Suppression Fire</h1><p>You can <strong>Push</strong> yourself to maintain a steady rate of suppression fire during a battle, enough to suppress a small gang of up to six members. <em>(When an enemy is suppressed, they're reluctant to maneuver or attack, usually calling for a <strong>fortune</strong> roll to see if they can manage it.)</em></p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Suppression Fire@cat:effect@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Sharpshooter@status:Hidden@tooltip:<h1>Sharpshooter  Suppression Fire</h1><p>You can <strong>Push</strong> yourself to maintain a steady rate of suppression fire during a battle, enough to suppress a small gang of up to six members. <em>When an enemy is suppressed, they're reluctant to maneuver or attack, usually calling for a <strong>fortune</strong> roll to see if they can manage it.</em></p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Focused\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Focused@cat:roll@type:ability@cTypes:Resistance@cTraits:Insight|Resolve@val:0@eKey:Cost-SpecialArmor|Negate-Consequence@status:Hidden@tooltip:<h1>Focused</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to completely negate a <strong>consequence</strong> of <strong class='red-bright'>surprise</strong> or <strong class='red-bright'>mental harm</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Focused@cat:after@type:ability@cTypes:Action@cTraits:hunt|study|survey|finesse|prowl|skirmish|wreck@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Focused</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself for ranged combat or tracking.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Hunter (Arrow-Swift)\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Ghost Hunter (Arrow-Swift)@cat:effect@type:ability@cTypes:Action@cTraits:quality@val:0@eKey:ForceOn-Potency@status:Hidden@tooltip:<h1>Ghost Hunter (Arrow-Swift)</h1><p>This cohort is <strong class='cyan-bright'>imbued</strong> with spirit energy, granting it <strong class='gold-bright'>Potency</strong> against the supernatural.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Hunter (Ghost Form)\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Ghost Hunter (Ghost Form)@cat:effect@type:ability@cTypes:Action@cTraits:quality@val:0@eKey:ForceOn-Potency@status:Hidden@tooltip:<h1>Ghost Hunter (Ghost Form)</h1><p>This cohort is <strong class='cyan-bright'>imbued</strong> with spirit energy, granting it <strong class='gold-bright'>Potency</strong> against the supernatural.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Hunter (Mind Link)\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Ghost Hunter (Mind Link)@cat:effect@type:ability@cTypes:Action@cTraits:quality@val:0@eKey:ForceOn-Potency@status:Hidden@tooltip:<h1>Ghost Hunter (Mind Link)</h1><p>This cohort is <strong class='cyan-bright'>imbued</strong> with spirit energy, granting it <strong class='gold-bright'>Potency</strong> against the supernatural.</p>\"\r\n      }\r\n    ],\r\n    \"Scout\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Scout@cat:effect@type:ability@cTypes:Action|Downtime|Clock@cTraits:hunt|study|survey|attune|consort|sway@status:Hidden@tooltip:<h1>Scout</h1><p>When you <strong>gather information</strong> to discover the location of a target <em>(a person, a destination, a good ambush spot, etc)</em>, you gain <strong class='gold-bright'>+1 effect</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Scout@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl@status:Hidden@tooltip:<h1>Scout</h1><p>When you hide in a prepared position or use camouflage, you get <strong class='gold-bright'>+1d</strong> to rolls to avoid detection.</p>\"\r\n      }\r\n    ],\r\n    \"Alchemist\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Alchemist@cat:result@type:ability@cTypes:Downtime|GatherInfo|Craft@status:Hidden@tooltip:<h1>Alchemist</h1><p>When you <strong>invent</strong> or <strong>craft</strong> a creation with <em>alchemical</em> features, you gain <strong class='gold-bright'>+1 result level</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Artificer\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Artificer@cat:result@type:ability@cTypes:Downtime|GatherInfo|Craft@cTraits:study|tinker@status:Hidden@tooltip:<h1>Artificer</h1><p>When you <strong>invent</strong> or <strong>craft</strong> a creation with <em>spark-craft</em> features, you gain <strong class='gold-bright'>+1 result level</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Fortitude\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Fortitude@cat:roll@type:ability@cTypes:Resistance@val:0@eKey:Cost-SpecialArmor|Negate-Consequence@status:Hidden@tooltip:<h1>Fortitude</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to completely negate a <strong>consequence</strong> of <strong class='red-bright'>fatigue</strong>, <strong class='red-bright'>weakness</strong>, or <strong class='red-bright'>chemical effects</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Fortitude@cat:after@type:ability@cTypes:Action@cTraits:study|survey|tinker|finesse|skirmish|wreck@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Fortitude</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself when working with technical skill or handling alchemicals.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Ward\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Ghost Ward@cat:after@type:ability@cTypes:Action@cTraits:wreck@val:0@status:Hidden@tooltip:<h1>Ghost Ward</h1><p>When you <strong>Wreck</strong> an area with <em>arcane</em> substances, ruining it for any other use, it becomes <strong class='cyan-bright'>anathema</strong> or <strong class='cyan-bright'>enticing</strong> to spirits (your choice).</p>\"\r\n      }\r\n    ],\r\n    \"Physicker\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Physicker@cat:roll@type:ability@cTypes:Downtime@aTypes:Incarceration@status:Hidden@tooltip:<h1>Physicker</h1><p>You gain <strong class='gold-bright'>+1d</strong> to your <strong>healing treatment</strong> rolls.</p>\"\r\n      }\r\n    ],\r\n    \"Saboteur\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Saboteur@cat:after@type:ability@cTypes:Action|Downtime|Clock@aTraits:wreck@val:0@status:Hidden@tooltip:<h1>Saboteur</h1><p>When you <strong>Wreck</strong>, your work is much quieter than it should be and the damage is very well-hidden from casual inspection.</p>\"\r\n      }\r\n    ],\r\n    \"Venomous\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Venomous@cat:roll@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@status:Hidden@tooltip:<h1>Venomous</h1><p>You can <strong>Push</strong> yourself to secrete your chosen drug or poison through your skin or saliva, or exhale it as a vapor.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Venomous@cat:effect@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@status:Hidden@tooltip:<h1>Venomous</h1><p>You can <strong>Push</strong> yourself to secrete your chosen drug or poison through your skin or saliva, or exhale it as a vapor.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Infiltrator\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Infiltrator@cat:effect@type:ability@cTypes:Action|Downtime|Clock@cTraits:tinker|finesse|wreck|attune@val:0@eKey:Negate-QualityPenalty|Negate-TierPenalty@status:Hidden@tooltip:<h1>Infiltrator</h1><p>You are not affected by low <strong class='red-bright'>Quality</strong> or <strong class='red-bright'>Tier</strong> when you bypass security measures.</p>\"\r\n      }\r\n    ],\r\n    \"Ambush\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Ambush@cat:roll@type:ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune@status:Hidden@tooltip:<h1>Ambush</h1><p>When you attack from hiding or spring a trap, you get <strong class='gold-bright'>+1d</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Daredevil\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Daredevil@cat:roll@type:ability@eKey:AutoRevealOn-Desperate|ForceOn-(Daredevil),after@status:ToggledOff@tooltip:<h1>Daredevil</h1><p>When you make a <strong class='red-bright'>desperate</strong> <strong>action</strong> roll, you may gain <strong class='gold-bright'>+1d</strong> to your roll, if you also take <strong class='red-bright'>1d</strong> to <strong>resistance</strong> rolls against any consequences.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Daredevil@cat:roll@posNeg:negative@type:ability@cTypes:Resistance@status:Hidden@tooltip:<h1 class='red-bright'>Daredevil</h1><p>By choosing to gain <strong>+1d</strong> to your <strong class='red-bright'>desperate</strong> <strong>action</strong> roll, you suffer <strong class='red-bright'>1d</strong> to <strong>resistance</strong> rolls against the consequences of that action.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:(Daredevil)@cat:after@posNeg:negative@type:ability@val:0@sourceName:Daredevil@status:Hidden@tooltip:<h1 class='red-bright'>Daredevil</h1><p>You will suffer <strong class='red-bright'>1d</strong> to <strong>resistance</strong> rolls against any consequences of this <strong>action</strong> roll.</p>\"\r\n      }\r\n    ],\r\n    \"The Devil's Footsteps\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Superhuman Feat@cat:roll@type:ability@val:0@eKey:Is-Push|ForceOn-Push@sourceName:The Devil's Footsteps@status:ToggledOff@tooltip:<h1>The Devil's Footsteps  Superhuman Feat</h1><p>You can <strong>Push</strong> yourself to perform a feat of physical force that verges on the superhuman <em>(you might climb a sheer surface that lacks good hand-holds, tumble safely out of a three-story fall, leap a shocking distance, etc.)</em>.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Superhuman Feat@cat:effect@type:ability@val:0@eKey:Is-Push|ForceOn-Push@sourceName:The Devil's Footsteps@status:ToggledOff@tooltip:<h1>The Devil's Footsteps  Superhuman Feat</h1><p>You can <strong>Push</strong> yourself to perform a feat of physical force that verges on the superhuman <em>(you might climb a sheer surface that lacks good hand-holds, tumble safely out of a three-story fall, leap a shocking distance, etc.)</em>.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Sow Confusion@cat:roll@type:ability@val:0@eKey:Is-Push|ForceOn-Push@sourceName:The Devil's Footsteps@status:ToggledOff@tooltip:<h1>The Devil's Footsteps  Sow Confusion</h1><p>You can <strong>Push</strong> yourself to maneuver to confuse your enemies so they mistakenly attack each other. <em>(They attack each other for a moment before they realize their mistake. The GM might make a <strong>fortune</strong> roll to see how badly they harm or interfere with each other.)</em>.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Sow Confusion@cat:effect@type:ability@val:0@eKey:Is-Push|ForceOn-Push@sourceName:The Devil's Footsteps@status:ToggledOff@tooltip:<h1>The Devil's Footsteps  Sow Confusion</h1><p>You can <strong>Push</strong> yourself to maneuver to confuse your enemies so they mistakenly attack each other. <em>(They attack each other for a moment before they realize their mistake. The GM might make a <strong>fortune</strong> roll to see how badly they harm or interfere with each other.)</em>.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Shadow\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Shadow@cat:after@type:ability@cTypes:Action@cTraits:hunt|study|survey|tinker|finesse|prowl|skirmish|wreck@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Shadow</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself for a feat of athletics or stealth.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Shadow@cat:roll@type:ability@cTypes:Resistance@val:0@eKey:Cost-SpecialArmor|Negate-HarmLevel@status:Hidden@tooltip:<h1>Shadow</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to completely negate a <strong>consequence</strong> of <strong class='red-bright'>detection</strong> or <strong class='red-bright'>security measures</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Rook's Gambit\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Rook's Gambit@cat:roll@type:ability@cTypes:Action|Downtime|GatherInfo|Craft|Acquire|Clock@val:0@eKey:ForceOn-BestAction|Cost-Stress2@status:Hidden@tooltip:<h1>Rook's Gambit</h1><p>Take <strong class='red-bright'>2 stress</strong> to roll your <strong class='gold-bright'>best action rating</strong> while performing a different action.</p><p><em>(Describe how you adapt your skill to this use.)</em></p>\"\r\n      }\r\n    ],\r\n    \"Cloak & Dagger\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Cloak & Dagger@cat:roll@type:ability@cTypes:Action|Resistance@cTraits:finesse|prowl|attune|command|consort|sway|Insight@status:Hidden@tooltip:<h1>Cloak & Dagger</h1><p>When you use a disguise or other form of covert misdirection, you get <strong class='gold-bright'>+1d</strong> to rolls to confuse or deflect suspicion.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Voice\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Ghost Voice@cat:effect@type:ability@cTypes:Action|Downtime|Clock@cTraits:attune|command|consort|sway@val:0@eKey:ForceOn-Potency@status:Hidden@tooltip:<h1>Ghost Voice</h1><p>You gain <strong class='gold-bright'>Potency</strong> when communicating with the supernatural.</p>\"\r\n      }\r\n    ],\r\n    \"Mesmerism\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Mesmerism@cat:after@type:ability@cTypes:Action@cTraits:sway@val:0@status:Hidden@tooltip:<h1>Mesmerism</h1><p>When you <strong>Sway</strong> someone, you may cause them to forget that it's happened until they next interact with you.</p>\"\r\n      }\r\n    ],\r\n    \"Subterfuge\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Subterfuge@cat:roll@type:ability@cTypes:Resistance@cTraits:Insight@val:0@eKey:Cost-SpecialArmor|Negate-Consequence@status:Hidden@tooltip:<h1>Subterfuge</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to completely negate a <strong>consequence</strong> of <strong class='red-bright'>suspicion</strong> or <strong class='red-bright'>persuasion</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Subterfuge@cat:after@type:ability@cTypes:Action@cTraits:finesse|attune|consort|sway@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Subterfuge</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself for subterfuge.</p>\"\r\n      }\r\n    ],\r\n    \"Trust in Me\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Trust in Me@cat:roll@type:ability@cTypes:Action|Downtime|Clock@cTraits:hunt|study|survey|tinker|finesse|prowl|skirmish|wreck|attune|command|consort|sway|Insight|Prowess|Resolve|tier|quality|magnitude|number@status:Hidden@tooltip:<h1>Trust in Me</h1><p>You gain <strong class='gold-bright'>+1d</strong> to rolls opposed by a target with whom you have an intimate relationship.</p>\"\r\n      }\r\n    ],\r\n    \"Connected\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Connected@cat:result@type:ability@cTypes:Downtime@aTypes:Heat|Acquire@status:Hidden@tooltip:<h1>Connected</h1><p>When you <strong>acquire an asset</strong> or <strong>reduce heat</strong>, you get <strong class='gold-bright'>+1 result level</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Jail Bird\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Jail Bird@cat:effect@type:ability@cTypes:Downtime@eKey:Increase-Tier1@status:Hidden@tooltip:<h1>Jail Bird</h1><p>You gain <strong class='gold-bright'>+1 Tier</strong> while <strong class='cyan-bright'>incarcerated</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Mastermind\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Mastermind@cat:after@type:ability@cTypes:Action|Downtime|GatherInfo|Craft|Clock@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Mastermind</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself when you <strong>gather information</strong> or work on a <strong>long-term project</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Weaving the Web\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Weaving the Web@cat:roll@type:ability@cTypes:Action|Downtime|Clock@cTraits:consort@status:Hidden@tooltip:<h1>Weaving the Web</h1><p>You gain <strong class='gold-bright'>+1d</strong> to <strong>Consort</strong> when you <strong>gather information</strong> on a target for a <strong>score</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Weaving the Web@cat:roll@type:ability@cTypes:Healing@status:Hidden@tooltip:<h1>Weaving the Web</h1><p>You gain <strong class='gold-bright'>+1d</strong> to the <strong>engagement roll</strong> for the targeted <strong>score</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Ghost Mind\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Ghost Mind@cat:roll@type:ability@cTypes:Action|Downtime|Clock@cTraits:hunt|study|survey|tinker|prowl|attune|command|consort|sway@status:Hidden@tooltip:<h1>Ghost Mind</h1><p>You gain <strong class='gold-bright'>+1d</strong> to rolls to <strong>gather information</strong> about the supernatural by any means.</p>\"\r\n      }\r\n    ],\r\n    \"Iron Will\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Iron Will@cat:roll@type:ability@cTypes:Resistance@aTraits:Resolve@status:Hidden@tooltip:<h1>Iron Will</h1><p>You gain <strong class='gold-bright'>+1d</strong> to <strong>Resolve resistance</strong> rolls.</p>\"\r\n      }\r\n    ],\r\n    \"Occultist\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Occultist@cat:roll@type:ability@cTypes:Action|Downtime|Clock@cTraits:command@status:Hidden@tooltip:<h1>Occultist</h1><p>You gain <strong class='gold-bright'>+1d</strong> to rolls to <strong>Command</strong> cultists following ancient powers, forgotten gods or demons with whom you have previously <strong>Consort</strong>ed</p>\"\r\n      }\r\n    ],\r\n    \"Strange Methods\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Strange Methods@cat:result@type:ability@cTypes:Downtime|GatherInfo|Craft@status:Hidden@tooltip:<h1>Strange Methods</h1><p>When you <strong>invent</strong> or <strong>craft</strong> a creation with <em>arcane</em> features, you gain <strong class='gold-bright'>+1 result level</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Tempest\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Throw Lightning@cat:roll@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Tempest@status:Hidden@tooltip:<h1>Tempest  Throw Lightning</h1><p>You can <strong>Push</strong> yourself to unleash a stroke of lightning as a weapon. The GM will describe its <strong>effect level</strong> and significant collateral damage.</p><p>If you unleash it in combat against an enemy who's threatening you, you'll still make an <strong>action</strong> roll in the fight (usually with <strong>Attune</strong>).</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Throw Lightning@cat:effect@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Tempest@status:Hidden@tooltip:<h1>Tempest  Throw Lightning</h1><p>You can <strong>Push</strong> yourself to unleash a stroke of lightning as a weapon. The GM will describe its <strong>effect level</strong> and significant collateral damage.</p><p>If you unleash it in combat against an enemy who's threatening you, you'll still make an <strong>action</strong> roll in the fight (usually with <strong>Attune</strong>).</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Summon Storm@cat:roll@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Tempest@status:Hidden@tooltip:<h1>Tempest  Summon Storm</h1><p>You can <strong>Push</strong> yourself to summon a storm in your immediate vicinity <em>(torrential rain, roaring winds, heavy fog, chilling frost and snow, etc.)</em>. The GM will describe its <strong>effect level</strong>.</p><p>If you're using this power as cover or distraction, it's probably a <strong>Setup teamwork</strong> maneuver, using <strong>Attune</strong>.</p><p>You still gain <strong class='gold-bright'>+1d</strong> to your roll at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Summon Storm@cat:effect@type:ability@cTypes:Action@val:0@eKey:Is-Push|ForceOn-Push@sourceName:Tempest@status:Hidden@tooltip:<h1>Tempest  Summon Storm</h1><p>You can <strong>Push</strong> yourself to summon a storm in your immediate vicinity <em>(torrential rain, roaring winds, heavy fog, chilling frost and snow, etc.)</em>. The GM will describe its <strong>effect level</strong>.</p><p>If you're using this power as cover or distraction, it's probably a <strong>Setup teamwork</strong> maneuver, using <strong>Attune</strong>.</p><p>You still gain <strong class='gold-bright'>+1 effect</strong> at the cost of <strong class='red-bright'>2 stress</strong>, as normal for a <strong>Push</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Warded\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Warded@cat:roll@type:ability@cTypes:Resistance@val:0@eKey:Cost-SpecialArmor|Negate-Consequence@status:Hidden@tooltip:<h1>Warded</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> to completely negate a <strong>consequence</strong> of <strong class='red-bright'>supernatural</strong> origin.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Warded@cat:after@type:ability@cTypes:Action@eKey:Negate-PushCost|Cost-SpecialArmor@status:Hidden@tooltip:<h1>Warded</h1><p>You may expend your <strong class='cyan-bright'>special armor</strong> instead of paying <strong class='red-bright'>2 stress</strong> to <strong>Push</strong> yourself when you contend with or employ <em>arcane</em> forces.</p>\"\r\n      }\r\n    ]\r\n  },\r\n  [BladesItemType.crew_ability]: {\r\n    \"Predators\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Predators@cat:roll@type:crew_ability@cTypes:Healing@val@status:Hidden@tooltip:<h1>Predators</h1><p>When you use a <strong><em>stealth</em></strong> or <strong><em>deception</em> plan</strong> to commit murder, take <strong class='gold-bright'>+1d</strong> to the <strong>engagement</strong> roll.</p>\"\r\n      }\r\n    ],\r\n    \"Vipers\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Vipers (Crew Ability)@cat:result@type:crew_ability@cTypes:GatherInfo|Craft|Acquire@val@sourceName:Vipers@status:Hidden@tooltip:<h1>Vipers (Crew Ability)</h1><p>When you <strong>acquire</strong> or <strong>craft</strong> poisons, you get <strong class='gold-bright'>+1 result level</strong> to your roll.</p>\"\r\n      }\r\n    ],\r\n    \"Blood Brothers\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Blood Brothers (Crew Ability)@cat:roll@type:crew_ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck|attune|command@val@sourceName:Blood Brothers@status:Hidden@tooltip:<h1>Blood Brothers (Crew Ability)</h1><p>When fighting alongside crew members in combat, gain <strong class='gold-bright'>+1d</strong> for <strong>assist</strong>, <strong>setup</strong> and <strong>group teamwork actions</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Door Kickers\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Door Kickers@cat:roll@type:crew_ability@cTypes:Healing@val@status:Hidden@tooltip:<h1>Door Kickers</h1><p>When you use an <strong><em>assault</em> plan</strong>, take <strong class='gold-bright'>+1d</strong> to the <strong>engagement</strong> roll.</p>\"\r\n      }\r\n    ],\r\n    \"Anointed\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Anointed (Crew Ability)@cat:roll@type:crew_ability@cTypes:Resistance@val@sourceName:Anointed@status:Hidden@tooltip:<h1>Anointed (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> to <strong>resistance</strong> rolls against supernatural threats.</p>\"\r\n      },\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Anointed (Crew Ability) (Crew Ability)@cat:roll@type:crew_ability@cTypes:Incarceration@val@sourceName:Anointed@status:Hidden@tooltip:<h1>Anointed (Crew Ability) (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> to <strong>healing treatment</strong> rolls when you have supernatural <strong class='red-bright'>harm</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Conviction\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Conviction (Crew Ability)@cat:roll@type:crew_ability@cTypes:Action@val@sourceName:Conviction@status:Hidden@tooltip:<h1>Conviction (Crew Ability)</h1><p>You may call upon your deity to <strong>assist</strong> any one <strong>action</strong> roll you make.</p><p>You cannot use this ability again until you indulge your <strong><em>Worship</em></strong> vice.</p>\"\r\n      }\r\n    ],\r\n    \"Zealotry\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isCohort: true,\r\n        value: \"name:Zealotry (Crew Ability)@cat:roll@type:crew_ability@cTypes:Action|Downtime@val@sourceName:Zealotry@status:Hidden@tooltip:<h1>Zealotry (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> when acting against enemies of the faith.</p>\"\r\n      }\r\n    ],\r\n    \"The Good Stuff\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:The Good Stuff (Crew Ability)@cat:effect@type:crew_ability@cTypes:Action|Downtime@val:0@eKey:Increase-Quality2@sourceName:The Good Stuff@status:Hidden@tooltip:<h1>The Good Stuff (Crew Ability)</h1><p>The quality of your product is equal to your <strong class='gold-bright'>Tier +2</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"High Society\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:High Society (Crew Ability)@cat:roll@type:crew_ability@cTypes:Engagement@val@sourceName:High Society@status:Hidden@tooltip:<h1>High Society (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> to <strong>gather information</strong> about the city's elite.</p>\"\r\n      }\r\n    ],\r\n    \"Pack Rats\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Pack Rats (Crew Ability)@cat:roll@type:crew_ability@aTypes:Acquire@val@sourceName:Pack Rats@status:Hidden@tooltip:<h1>Pack Rats (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> to <strong>acquire an asset</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Second Story\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        value: \"name:Second Story@cat:roll@type:crew_ability@cTypes:Healing@val@status:Hidden@tooltip:<h1>Second Story</h1><p>When you execute a <strong>clandestine infiltration plan</strong>, gain <strong class='gold-bright'>+1d</strong> to the <strong>engagement</strong> roll.</p>\"\r\n      }\r\n    ],\r\n    \"Slippery\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Slippery (Crew Ability)@cat:roll@type:crew_ability@aTypes:Heat@val@sourceName:Slippery@status:Hidden@tooltip:<h1>Slippery (Crew Ability)</h1><p>Gain <strong class='gold-bright'>+1d</strong> to <strong>reduce heat</strong> rolls.</p>\"\r\n      }\r\n    ],\r\n    \"Synchronized\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        isCohort: true,\r\n        value: \"name:Synchronized (Crew Ability)@cat:after@type:crew_ability@cTypes:Action@val@sourceName:Synchronized@status:Hidden@tooltip:<h1>Synchronized (Crew Ability)</h1><p>When you perform a <strong>group teamwork action</strong>, you may count <strong class='cyan-bright'>multiple 6s from different rolls</strong> as a <strong class='gold-bright'>critical success</strong>.</p>\"\r\n      }\r\n    ],\r\n    \"Just Passing Through\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Just Passing Through (Crew Ability)@cat:roll@type:crew_ability@cTypes:Action|Downtime@cTraits:finesse|prowl|consort|sway@val@sourceName:Just Passing Through@status:Hidden@tooltip:<h1>Just Passing Through (Crew Ability)</h1><p>When your <strong class='red-bright'>heat</strong> is <strong>4 or less</strong>, gain <strong class='gold-bright'>+1d</strong> to rolls to deceive people when you pass yourself off as ordinary citizens.</p>\"\r\n      }\r\n    ],\r\n    \"Reavers\": [\r\n      {\r\n        key: \"system.roll_mods\",\r\n        mode: 2,\r\n        priority: null,\r\n        isMember: true,\r\n        value: \"name:Reavers (Crew Ability)@cat:effect@type:crew_ability@cTypes:Action@cTraits:hunt|finesse|prowl|skirmish|wreck@val@sourceName:Reavers@status:Hidden@tooltip:<h1>Reavers (Crew Ability)</h1><p>When you go into conflict aboard a <strong class='cyan-bright'>vehicle</strong>, gain <strong class='gold-bright'>+1 effect</strong> for vehicle damage and speed.</p>\"\r\n      }\r\n    ]\r\n  }\r\n};\r\n\r\nRollCollabEffectChanges[BladesItemType.crew_upgrade] = {\r\n  \"Ironhook Contacts\": [\r\n    {\r\n      key: \"system.roll_mods\",\r\n      mode: 2,\r\n      priority: null,\r\n      isMember: true,\r\n      value: \"name:Ironhook Contacts@cat:roll@type:ability@cTypes:Downtime@eKey:Increase-Tier1@status:Conditional@tooltip:<h1>Ironhook Contacts</h1><p>Gain G>+1 Tier< while in prison, including the >incarceration< roll.</p>\"\r\n    }\r\n  ]\r\n};\r\n\r\nexport const ApplyRollEffects = async () => {\r\n  Object.entries(RollCollabEffectChanges[BladesItemType.ability]!)\r\n    .forEach(async ([aName, eData]) => {\r\n      // Get ability doc\r\n      const abilityDoc = game.items.getName(aName);\r\n      if (!abilityDoc) {\r\n        eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} Not Found.`);\r\n        return;\r\n      }\r\n\r\n      // Get active effects on abilityDoc\r\n      const abilityEffects = Array.from(abilityDoc.effects ?? []) as BladesActiveEffect[];\r\n\r\n      // Separate out 'APPLYTOMEMBERS' and 'APPLYTOCOHORTS' ActiveEffects\r\n      const toMemberEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOMEMBERS\"));\r\n      const toCohortEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOCOHORTS\"));\r\n      const standardEffects = abilityEffects.filter((effect) => effect.changes.every((change) => ![\"APPLYTOMEMBERS\", \"APPLYTOCOHORTS\"].includes(change.key)));\r\n\r\n      // Confirm eData.isMember and eData.isCohort are consistent across all changes.\r\n      const testChange = eData[0];\r\n      if (\r\n        (testChange.isMember && eData.some((change) => !change.isMember))\r\n        || (!testChange.isMember && eData.some((change) => change.isMember))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} has inconsistent 'isMember' entries.`); return }\r\n      if (\r\n        (testChange.isCohort && eData.some((change) => !change.isCohort))\r\n        || (!testChange.isCohort && eData.some((change) => change.isCohort))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} has inconsistent 'isCohort' entries.`); return }\r\n\r\n      // If eData.isMember or eData.isCohort, first see if there already is such an effect on the doc\r\n      if (testChange.isMember) {\r\n        if (toMemberEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} Has Multiple 'APPLYTOMEMBERS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: abilityDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isMember;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toMemberEffects.length === 1) {\r\n          const abilityEffect = toMemberEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOMEMBERS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Scoundrel Ability)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await abilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else if (testChange.isCohort) {\r\n        if (toCohortEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} Has Multiple 'APPLYTOCOHORTS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: abilityDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isCohort;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toCohortEffects.length === 1) {\r\n          const abilityEffect = toCohortEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOCOHORTS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Scoundrel Ability)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await abilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else {\r\n        if (standardEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Ability ${aName} Has Multiple Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: abilityDoc.img ?? \"\",\r\n          changes: eData\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (standardEffects.length === 1) {\r\n          const abilityEffect = standardEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await abilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      }\r\n    });\r\n  Object.entries(RollCollabEffectChanges[BladesItemType.crew_ability]!)\r\n    .forEach(async ([aName, eData]) => {\r\n      // Get crew ability doc\r\n      const crewAbilityDoc = game.items.getName(aName);\r\n      if (!crewAbilityDoc) {\r\n        eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} Not Found.`);\r\n        return;\r\n      }\r\n\r\n      // Get active effects on crewAbilityDoc\r\n      const abilityEffects = Array.from(crewAbilityDoc.effects ?? []) as BladesActiveEffect[];\r\n\r\n      // Separate out 'APPLYTOMEMBERS' and 'APPLYTOCOHORTS' ActiveEffects\r\n      const toMemberEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOMEMBERS\"));\r\n      const toCohortEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOCOHORTS\"));\r\n      const standardEffects = abilityEffects.filter((effect) => effect.changes.every((change) => ![\"APPLYTOMEMBERS\", \"APPLYTOCOHORTS\"].includes(change.key)));\r\n\r\n      // Confirm eData.isMember and eData.isCohort are consistent across all changes.\r\n      const testChange = eData[0];\r\n      if (\r\n        (testChange.isMember && eData.some((change) => !change.isMember))\r\n        || (!testChange.isMember && eData.some((change) => change.isMember))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} has inconsistent 'isMember' entries.`); return }\r\n      if (\r\n        (testChange.isCohort && eData.some((change) => !change.isCohort))\r\n        || (!testChange.isCohort && eData.some((change) => change.isCohort))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} has inconsistent 'isCohort' entries.`); return }\r\n\r\n      // If eData.isMember or eData.isCohort, first see if there already is such an effect on the doc\r\n      if (testChange.isMember) {\r\n        if (toMemberEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} Has Multiple 'APPLYTOMEMBERS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewAbilityDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isMember;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toMemberEffects.length === 1) {\r\n          const abilityEffect = toMemberEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOMEMBERS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Crew Ability)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewAbilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else if (testChange.isCohort) {\r\n        if (toCohortEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} Has Multiple 'APPLYTOCOHORTS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewAbilityDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isCohort;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toCohortEffects.length === 1) {\r\n          const abilityEffect = toCohortEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOCOHORTS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Crew Ability)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewAbilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else {\r\n        if (standardEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Ability ${aName} Has Multiple Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewAbilityDoc.img ?? \"\",\r\n          changes: eData\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (standardEffects.length === 1) {\r\n          const abilityEffect = standardEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewAbilityDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      }\r\n    });\r\n  Object.entries(RollCollabEffectChanges[BladesItemType.crew_upgrade]!)\r\n    .forEach(async ([aName, eData]) => {\r\n      // Get crew upgrade doc\r\n      const crewUpgradeDoc = game.items.getName(aName);\r\n      if (!crewUpgradeDoc) {\r\n        eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} Not Found.`);\r\n        return;\r\n      }\r\n\r\n      // Get active effects on crewAbilityDoc\r\n      const abilityEffects = Array.from(crewUpgradeDoc.effects ?? []) as BladesActiveEffect[];\r\n\r\n      // Separate out 'APPLYTOMEMBERS' and 'APPLYTOCOHORTS' ActiveEffects\r\n      const toMemberEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOMEMBERS\"));\r\n      const toCohortEffects = abilityEffects.filter((effect) => effect.changes.some((change) => change.key === \"APPLYTOCOHORTS\"));\r\n      const standardEffects = abilityEffects.filter((effect) => effect.changes.every((change) => ![\"APPLYTOMEMBERS\", \"APPLYTOCOHORTS\"].includes(change.key)));\r\n\r\n      // Confirm eData.isMember and eData.isCohort are consistent across all changes.\r\n      const testChange = eData[0];\r\n      if (\r\n        (testChange.isMember && eData.some((change) => !change.isMember))\r\n        || (!testChange.isMember && eData.some((change) => change.isMember))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} has inconsistent 'isMember' entries.`); return }\r\n      if (\r\n        (testChange.isCohort && eData.some((change) => !change.isCohort))\r\n        || (!testChange.isCohort && eData.some((change) => change.isCohort))\r\n      ) { eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} has inconsistent 'isCohort' entries.`); return }\r\n\r\n      // If eData.isMember or eData.isCohort, first see if there already is such an effect on the doc\r\n      if (testChange.isMember) {\r\n        if (toMemberEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} Has Multiple 'APPLYTOMEMBERS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewUpgradeDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isMember;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toMemberEffects.length === 1) {\r\n          const abilityEffect = toMemberEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOMEMBERS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Crew Upgrade)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewUpgradeDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else if (testChange.isCohort) {\r\n        if (toCohortEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} Has Multiple 'APPLYTOCOHORTS' Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewUpgradeDoc.img ?? \"\",\r\n          changes: eData.map((change) => {\r\n            delete change.isCohort;\r\n            return change;\r\n          })\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (toCohortEffects.length === 1) {\r\n          const abilityEffect = toCohortEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        } else {\r\n          effectData.changes.unshift({\r\n            key: \"APPLYTOCOHORTS\",\r\n            mode: 0,\r\n            priority: null,\r\n            value: `${aName.replace(/\\s*\\([^()]*? (Ability|Upgrade)\\)\\s*$/, \"\")} (Crew Upgrade)`\r\n          });\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewUpgradeDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      } else {\r\n        if (standardEffects.length > 1) {\r\n          eLog.error(\"applyRollEffects\", `ApplyRollEffects: Crew Upgrade ${aName} Has Multiple Active Effects`);\r\n          return;\r\n        }\r\n\r\n        // Initialize new effect data\r\n        const effectData: {\r\n          name: string,\r\n          icon: string,\r\n          changes: Array<Partial<EffectChangeData>>\r\n        } = {\r\n          name: aName,\r\n          icon: crewUpgradeDoc.img ?? \"\",\r\n          changes: eData\r\n        };\r\n\r\n        // Derive new effect data from existing effect, if any, then delete existing effect\r\n        if (standardEffects.length === 1) {\r\n          const abilityEffect = standardEffects[0] as BladesActiveEffect;\r\n          effectData.name = abilityEffect.name ?? effectData.name;\r\n          effectData.icon = abilityEffect.icon ?? effectData.icon;\r\n          effectData.changes.unshift(...abilityEffect.changes.filter((change) => change.key !== \"system.roll_mods\"));\r\n          await abilityEffect.delete();\r\n        }\r\n\r\n        // Create new ActiveEffect\r\n        await crewUpgradeDoc.createEmbeddedDocuments(\"ActiveEffect\", [effectData]);\r\n      }\r\n    });\r\n};\r\n\r\nexport const ApplyDescriptions = async () => {\r\n  Object.entries(DescriptionChanges)\r\n    .forEach(async ([aName, desc]) => {\r\n      // Get crew upgrade doc\r\n      const itemDoc = game.items.getName(aName);\r\n      if (!itemDoc) {\r\n        eLog.error(\"applyRollEffects\", `ApplyDescriptions: Item Doc ${aName} Not Found.`);\r\n        return;\r\n      }\r\n\r\n      // Update system.notes\r\n      itemDoc.update({\"system.notes\": desc});\r\n    });\r\n};\r\n\r\n// #endregion\r\n// #region Types & Type Checking ~\r\ntype EffectData = {\r\n  key: \"system.roll_mods\",\r\n  mode: 2,\r\n  priority: null,\r\n  value: string\r\n};\r\n\r\n// function getRollModStatus(mod: BladesRollMod) {\r\n//   return {\r\n//     status: mod.status,\r\n//     user_status: mod.user_status,\r\n//     held_status: mod.held_status,\r\n//     base_status: mod.base_status\r\n//   };\r\n// }\r\n// function stringifyRollModStatus(mod: BladesRollMod) {\r\n//   return JSON.stringify(getRollModStatus(mod));\r\n// }\r\nfunction compareRollModStatus(mod: BladesRollMod, lastStatusData: string) {\r\n  const lastStatus = JSON.parse(lastStatusData) as Record<\"status\"|\"user_status\"|\"held_status\"|\"base_status\",RollModStatus|undefined>;\r\n  const statusChangeData: Partial<Record<\"status\"|\"user_status\"|\"held_status\"|\"base_status\",string>> = {};\r\n  if (lastStatus.status !== mod.status) { statusChangeData.status = `${lastStatus.status} -> ${mod.status}` }\r\n  if (lastStatus.base_status !== mod.base_status) { statusChangeData.base_status = `${lastStatus.base_status} -> ${mod.base_status}` }\r\n  if (lastStatus.held_status !== mod.held_status) { statusChangeData.held_status = `${lastStatus.held_status} -> ${mod.held_status}` }\r\n  if (lastStatus.user_status !== mod.user_status) { statusChangeData.user_status = `${lastStatus.user_status} -> ${mod.user_status}` }\r\n  return statusChangeData;\r\n}\r\n\r\nfunction isAction(trait: unknown): trait is BladesRollCollab.RollTrait & Action {\r\n  return Boolean(trait && typeof trait === \"string\" && U.lCase(trait) in Action);\r\n}\r\nfunction isAttribute(trait: unknown): trait is BladesRollCollab.RollTrait & Attribute {\r\n  return Boolean(trait && typeof trait === \"string\" && U.lCase(trait) in Attribute);\r\n}\r\nfunction isFactor(trait: unknown): trait is BladesRollCollab.RollTrait & Factor {\r\n  return Boolean(trait && typeof trait === \"string\" && U.lCase(trait) in Factor);\r\n}\r\nfunction isNumber(trait: string | number): trait is BladesRollCollab.RollTrait & number { return U.isInt(trait) }\r\n// function isPushMod(rollMod: BladesRollMod) { return U.lCase(rollMod.name) === \"push\" }\r\n// #endregion\r\n\r\n// #region *** CLASS *** BladesRollMod ~\r\nexport class BladesRollMod {\r\n\r\n  get status() {\r\n    if (this.user_status && [RollModStatus.ForcedOn, RollModStatus.ForcedOff, RollModStatus.Hidden].includes(this.user_status)) {\r\n      return this.user_status;\r\n    }\r\n    if (this.held_status && [RollModStatus.ToggledOff, RollModStatus.ToggledOn].includes(this.held_status)) {\r\n      return this.user_status ?? this.held_status;\r\n    }\r\n    return this.held_status ?? this.user_status ?? this.base_status;\r\n  }\r\n\r\n  get isActive() { return [RollModStatus.ToggledOn, RollModStatus.ForcedOn].includes(this.status) }\r\n  get isVisible() { return this.status !== RollModStatus.Hidden }\r\n\r\n  _held_status?: RollModStatus;\r\n  get held_status(): RollModStatus | undefined { return this._held_status }\r\n  set held_status(val: RollModStatus | undefined) {\r\n    this._held_status = val;\r\n  }\r\n\r\n  get flagParams() { return [C.SYSTEM_ID, `rollCollab.rollModsData.${this.id}`] as const }\r\n  getFlag() { return this.rollInstance.document.getFlag(...this.flagParams) }\r\n\r\n  get user_status(): RollModStatus | undefined {\r\n    return this.rollInstance.document.getFlag(...this.flagParams) as\r\n      ValueOf<BladesRollCollab.FlagData[\"rollModsData\"]> | undefined;\r\n  }\r\n  set user_status(val: RollModStatus | undefined) {\r\n    if (val === this.user_status) { return }\r\n    if (!val || val === this.base_status) {\r\n      this.rollInstance.document.unsetFlag(...this.flagParams);\r\n    } else {\r\n      if ([RollModStatus.ForcedOn, RollModStatus.ForcedOff, RollModStatus.Hidden].includes(val)\r\n        && !game.user.isGM) { return }\r\n      if (this.user_status && [RollModStatus.ForcedOn, RollModStatus.ForcedOff, RollModStatus.Hidden].includes(this.user_status)\r\n        && !game.user.isGM) { return }\r\n      this.rollInstance.document.setFlag(...this.flagParams, val);\r\n    }\r\n  }\r\n\r\n  get sourceName(): string { return this.source_name }\r\n\r\n  get isConditional(): boolean {\r\n    return [\r\n      ...this.conditionalRollTraits,\r\n      ...this.autoRollTraits,\r\n      ...this.conditionalRollTypes,\r\n      ...this.autoRollTypes\r\n    ].length > 0;\r\n  }\r\n\r\n  get isInInactiveBlock(): boolean {\r\n    if (game.user.isGM) {\r\n      return [RollModStatus.Hidden, RollModStatus.ForcedOff, RollModStatus.ToggledOff].includes(this.status)\r\n        && (this.isConditional || [BladesItemType.ability].includes(this.modType as any));\r\n    }\r\n    return [RollModStatus.ForcedOff, RollModStatus.ToggledOff].includes(this.status)\r\n      && (this.isConditional || [BladesItemType.ability].includes(this.modType as any));\r\n  }\r\n\r\n  get isPush(): boolean {\r\n    return Boolean(U.lCase(this.name) === \"push\"\r\n      || this.effectKeys.find((eKey) => eKey === \"Is-Push\"));\r\n  }\r\n\r\n  get isBasicPush(): boolean { return U.lCase(this.name) === \"push\" }\r\n\r\n  get stressCost(): number {\r\n    const costKeys = this.effectKeys.filter((key) => /^Cost-Stress/.test(key));\r\n    if (costKeys.length === 0) { return 0 }\r\n    let stressCost = 0;\r\n    costKeys.forEach((key) => {\r\n      const [thisParam] = (key.split(/-/) ?? []).slice(1);\r\n      const [_, valStr] = (thisParam.match(/([A-Za-z]+)([0-9]*)/) ?? []).slice(1);\r\n      stressCost += U.pInt(valStr);\r\n    });\r\n    return stressCost;\r\n  }\r\n\r\n  setConditionalStatus(): boolean {\r\n    if (!this.isConditional) { return false }\r\n\r\n    // If ANY auto-Traits/Types apply, ForceOn\r\n    if (this.autoRollTypes.includes(this.rollInstance.rollType)\r\n      || this.autoRollTraits.includes(this.rollInstance.rollTrait)) {\r\n      this.held_status = RollModStatus.ForcedOn;\r\n      return false;\r\n    }\r\n\r\n    // If BOTH conditionalTypes and conditionalTraits apply, held = ToggledOff\r\n    if ((this.conditionalRollTypes.length === 0 || this.conditionalRollTypes.includes(this.rollInstance.rollType))\r\n      && (this.conditionalRollTraits.length === 0 || this.conditionalRollTraits.includes(this.rollInstance.rollTrait))) {\r\n      this.held_status = RollModStatus.ToggledOff;\r\n      return false;\r\n    }\r\n\r\n    // OTHERWISE, return HIDDEN\r\n    this.held_status = RollModStatus.Hidden;\r\n    return true;\r\n  }\r\n\r\n  setAutoStatus(): boolean {\r\n    // Check for AutoRevealOn and AutoEnableOn\r\n    const holdKeys = this.effectKeys.filter((key) => /^Auto/.test(key));\r\n    if (holdKeys.length === 0) { return false }\r\n\r\n    while (holdKeys.length) {\r\n      const [thisKey, thisParam] = holdKeys.pop()?.split(/-/) ?? [];\r\n      switch (U.lCase(thisParam)) {\r\n        case Position.controlled:\r\n        case Position.risky:\r\n        case Position.desperate: {\r\n          if (this.rollInstance.finalPosition === U.lCase(thisParam)) {\r\n            if (thisKey === \"AutoRevealOn\") {\r\n              this.held_status = RollModStatus.ToggledOff;\r\n              return false;\r\n            } else if (thisKey === \"AutoEnableOn\") {\r\n              this.held_status = RollModStatus.ForcedOn;\r\n              return false;\r\n            }\r\n          }\r\n          break;\r\n        }\r\n        // no default\r\n      }\r\n    }\r\n    this.held_status = RollModStatus.Hidden;\r\n    return true;\r\n  }\r\n\r\n  setRelevancyStatus(): boolean {\r\n    const holdKeys = this.effectKeys.filter((key) => /^Negate|^Increase/.test(key));\r\n    if (holdKeys.length === 0) { return false }\r\n\r\n    const relevantKeys = holdKeys\r\n      .filter((key) => {\r\n        const [thisKey, thisParam] = key.split(/-/) ?? [];\r\n        switch (thisKey) {\r\n          case \"Negate\": {\r\n            switch (thisParam) {\r\n              case \"PushCost\": {\r\n                return this.rollInstance.isPushed()\r\n                  && this.rollInstance.rollCostData.some((costData) => /Push/.test(costData.id)\r\n                    && costData.costType === \"Stress\"\r\n                    && costData.costAmount > 0);\r\n              }\r\n              case \"Consequence\": {\r\n                return this.rollInstance.rollType === RollType.Resistance\r\n                  && Boolean(this.rollInstance.rollConsequence);\r\n              }\r\n              case \"HarmLevel\": {\r\n                return this.rollInstance.rollType === RollType.Resistance\r\n                  && this.rollInstance.rollConsequence\r\n                  && [ConsequenceType.Harm1, ConsequenceType.Harm2, ConsequenceType.Harm3, ConsequenceType.Harm4].includes(this.rollInstance.rollConsequence.type);\r\n              }\r\n              case \"QualityPenalty\": {\r\n                if (!this.rollInstance.isTraitRelevant(Factor.quality)) { return false }\r\n                const {source, opposition} = this.rollInstance.rollFactors;\r\n                return (source[Factor.quality]?.value ?? 0) < (opposition[Factor.quality]?.value ?? 0);\r\n              }\r\n              case \"ScalePenalty\": {\r\n                if (!this.rollInstance.isTraitRelevant(Factor.scale)) { return false }\r\n                const {source, opposition} = this.rollInstance.rollFactors;\r\n                return (source[Factor.scale]?.value ?? 0) < (opposition[Factor.scale]?.value ?? 0);\r\n              }\r\n              case \"TierPenalty\": {\r\n                if (!this.rollInstance.isTraitRelevant(Factor.tier)) { return false }\r\n                const {source, opposition} = this.rollInstance.rollFactors;\r\n                return (source[Factor.tier]?.value ?? 0) < (opposition[Factor.tier]?.value ?? 0);\r\n              }\r\n              // no default\r\n            }\r\n            break;\r\n          }\r\n          case \"Increase\": {\r\n            const [_, traitStr] = thisParam.match(/(\\w+)\\d+/) ?? [];\r\n            return this.rollInstance.isTraitRelevant(traitStr as BladesRollCollab.RollTrait);\r\n          }\r\n          // no default\r\n        }\r\n        return undefined as never;\r\n      });\r\n    if (relevantKeys.length === 0) {\r\n      this.held_status = RollModStatus.Hidden;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setPayableStatus(): boolean {\r\n    const holdKeys = this.effectKeys.filter((key) => /^Cost/.test(key));\r\n    if (holdKeys.length === 0) { return false }\r\n\r\n    const payableKeys = holdKeys\r\n      .filter((key) => {\r\n        const [thisParam] = (key.split(/-/) ?? []).slice(1);\r\n        const [traitStr, valStr] = (thisParam.match(/([A-Za-z]+)([0-9]*)/) ?? []).slice(1);\r\n        switch (traitStr) {\r\n          case \"SpecialArmor\": {\r\n            return BladesActor.IsType(this.rollInstance!.rollSource?.rollSourceDoc, BladesActorType.pc)\r\n              && this.rollInstance!.rollSource!.rollSourceDoc.system.armor.active.special\r\n              && !this.rollInstance!.rollSource!.rollSourceDoc.system.armor.checked.special;\r\n          }\r\n          case \"Stress\": {\r\n            const val = U.pInt(valStr);\r\n            return BladesActor.IsType(this.rollInstance!.rollSource?.rollSourceDoc, BladesActorType.pc)\r\n              && this.rollInstance!.rollSource!.rollSourceDoc.system.stress.max - this.rollInstance!.rollSource!.rollSourceDoc.system.stress.value >= val;\r\n          }\r\n          // no default\r\n        }\r\n        return null as never;\r\n      });\r\n\r\n    if (payableKeys.length === 0) {\r\n      this.held_status = RollModStatus.ForcedOff;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  applyRollModEffectKeys() {\r\n    if (!this.isActive) { return }\r\n\r\n    const holdKeys = this.effectKeys.filter((key) => /^Negate|^Increase/.test(key));\r\n    if (holdKeys.length === 0) { return }\r\n\r\n    holdKeys.forEach((key) => {\r\n      const [thisKey, thisParam] = key.split(/-/) ?? [];\r\n      switch (thisKey) {\r\n        case \"Negate\": {\r\n          switch (thisParam) {\r\n            case \"PushCost\": {\r\n              const costlyPushMod = this.rollInstance.getActiveRollMods()\r\n                .find((mod) => mod.isPush && mod.stressCost > 0);\r\n              if (costlyPushMod) {\r\n                U.pullElement(costlyPushMod.effectKeys, (key) => /^Cost-Stress/.test(key));\r\n              }\r\n              return;\r\n            }\r\n            case \"Consequence\": {\r\n              /* Should cancel roll entirely? */\r\n              // return this.rollInstance.rollType === RollType.Resistance\r\n              //    && Boolean(this.rollInstance.rollConsequence);\r\n              return;\r\n            }\r\n            case \"HarmLevel\": {\r\n              if (!this.rollInstance.rollConsequence) { return }\r\n              const consequenceType = this.rollInstance.rollConsequence.type;\r\n              if (!consequenceType || !/^Harm/.test(consequenceType)) { return }\r\n              const curLevel = [ConsequenceType.Harm1, ConsequenceType.Harm2, ConsequenceType.Harm3, ConsequenceType.Harm4]\r\n                .findIndex((cType) => cType === consequenceType) + 1;\r\n              if (curLevel > 1) {\r\n                this.rollInstance.rollConsequence.type = `Harm${curLevel - 1}` as ConsequenceType;\r\n              } else {\r\n                /* Should cancel roll entirely? */\r\n              }\r\n              return;\r\n            }\r\n            case \"QualityPenalty\": {\r\n              this.rollInstance.negateFactorPenalty(Factor.quality);\r\n              return;\r\n            }\r\n            case \"ScalePenalty\": {\r\n              this.rollInstance.negateFactorPenalty(Factor.scale);\r\n              return;\r\n            }\r\n            case \"TierPenalty\": {\r\n              this.rollInstance.negateFactorPenalty(Factor.tier);\r\n              return;\r\n            }\r\n            // no default\r\n          }\r\n          break;\r\n        }\r\n        case \"Increase\": {\r\n          const [traitStr, valStr] = (thisParam.match(/([A-Za-z]+)([0-9]*)/) ?? []).slice(1);\r\n          this.rollInstance.tempGMBoosts[traitStr as \"Dice\" | Factor | \"Result\"] = U.pInt(valStr);\r\n          return;\r\n        }\r\n        // no default\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  get tooltip() {\r\n    if (this.sideString) {\r\n      return this._tooltip\r\n        .replace(/%COLON%/g, \":\")\r\n        .replace(/%DOC_NAME%/g, this.sideString);\r\n    }\r\n    return this._tooltip.replace(/%COLON%/g, \":\");\r\n  }\r\n\r\n  get sideString(): string | undefined {\r\n    if (this._sideString) { return this._sideString }\r\n    switch (this.category) {\r\n      case RollModCategory.roll: {\r\n        if (this.name === \"Assist\") {\r\n          const docID = this.rollInstance.document.getFlag(\"eunos-blades\", \"rollCollab.docSelections.roll.Assist\") as string | false | undefined;\r\n          if (!docID) { return undefined }\r\n          return (game.actors.get(docID) ?? game.items.get(docID) ?? {}).name ?? undefined;\r\n        }\r\n        return undefined;\r\n      }\r\n      case RollModCategory.position: {\r\n        if (this.name === \"Setup\") {\r\n          const docID = this.rollInstance.document.getFlag(\"eunos-blades\", \"rollCollab.docSelections.position.Setup\") as string | false | undefined;\r\n          if (!docID) { return undefined }\r\n          return (game.actors.get(docID) ?? game.items.get(docID) ?? {}).name ?? undefined;\r\n        }\r\n        return undefined;\r\n      }\r\n      case RollModCategory.effect: {\r\n        if (this.name === \"Setup\") {\r\n          const docID = this.rollInstance.document.getFlag(\"eunos-blades\", \"rollCollab.docSelections.effect.Setup\") as string | false | undefined;\r\n          if (!docID) { return undefined }\r\n          return (game.actors.get(docID) ?? game.items.get(docID) ?? {}).name ?? undefined;\r\n        }\r\n        return undefined;\r\n      }\r\n      // no default\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  get allFlagData(): BladesRollCollab.FlagData {\r\n    return this.rollInstance.document.getFlag(\"eunos-blades\", \"rollCollab\") as BladesRollCollab.FlagData;\r\n  }\r\n\r\n  get data(): BladesRollCollab.RollModData {\r\n    return {\r\n      id: this.id,\r\n      name: this.name,\r\n      base_status: this.base_status,\r\n      user_status: this.user_status,\r\n      value: this.value,\r\n      effectKeys: this.effectKeys,\r\n      sideString: this._sideString,\r\n      tooltip: this._tooltip,\r\n      posNeg: this.posNeg,\r\n      isOppositional: this.isOppositional,\r\n      modType: this.modType,\r\n      conditionalRollTypes: this.conditionalRollTypes,\r\n      autoRollTypes: this.autoRollTypes,\r\n      conditionalRollTraits: this.conditionalRollTraits,\r\n      autoRollTraits: this.autoRollTraits,\r\n      category: this.category\r\n    };\r\n  }\r\n\r\n  get costs(): BladesRollCollab.CostData[] | undefined {\r\n    if (!this.isActive) { return undefined }\r\n    const holdKeys = this.effectKeys.filter((key) => /^Cost/.test(key));\r\n    if (holdKeys.length === 0) { return undefined }\r\n\r\n    return holdKeys.map((key) => {\r\n      const [thisParam] = (key.split(/-/) ?? []).slice(1);\r\n      const [traitStr, valStr] = (thisParam.match(/([A-Za-z]+)([0-9]*)/) ?? []).slice(1);\r\n      return {\r\n        id: this.id,\r\n        label: this.isBasicPush\r\n          ? (this.posNeg === \"negative\"\r\n              ? `${this.name} (<span class='red-bright'>To Act</span>)`\r\n              : `${this.name} (<span class='gold-bright'>${this.category === RollModCategory.roll ? \"+1d\" : \"+1 effect\"}</span>)`)\r\n          : this.name,\r\n        costType: traitStr,\r\n        costAmount: valStr ? U.pInt(valStr) : 1\r\n      };\r\n    });\r\n  }\r\n\r\n  id: string;\r\n  name: string;\r\n  source_name: string;\r\n  base_status: RollModStatus;\r\n  value: number;\r\n  effectKeys: string[];\r\n  _sideString?: string;\r\n  _tooltip: string;\r\n  posNeg: \"positive\" | \"negative\";\r\n  isOppositional: boolean;\r\n  modType: BladesItemType | \"general\" | \"harm\" | \"teamwork\";\r\n  conditionalRollTypes: Array<RollType | DowntimeAction>;\r\n  autoRollTypes: Array<RollType | DowntimeAction>;\r\n  conditionalRollTraits: BladesRollCollab.RollTrait[];\r\n  autoRollTraits: BladesRollCollab.RollTrait[];\r\n  category: RollModCategory;\r\n\r\n  rollInstance: BladesRollCollab;\r\n\r\n  constructor(modData: BladesRollCollab.RollModData, rollInstance: BladesRollCollab) {\r\n    this.rollInstance = rollInstance;\r\n    this.id = modData.id;\r\n    this.name = modData.name;\r\n    this.source_name = modData.source_name ?? modData.name;\r\n    this.base_status = modData.base_status;\r\n    this.value = modData.value;\r\n    this.effectKeys = modData.effectKeys ?? [];\r\n    this._sideString = modData.sideString;\r\n    this._tooltip = modData.tooltip;\r\n    this.posNeg = modData.posNeg;\r\n    this.isOppositional = modData.isOppositional ?? false;\r\n    this.modType = modData.modType;\r\n    this.conditionalRollTypes = modData.conditionalRollTypes ?? [];\r\n    this.autoRollTypes = modData.autoRollTypes ?? [];\r\n    this.conditionalRollTraits = modData.conditionalRollTraits ?? [];\r\n    this.autoRollTraits = modData.autoRollTraits ?? [];\r\n    this.category = modData.category;\r\n  }\r\n}\r\n// #endregion\r\n\r\nclass BladesRollOpposition implements BladesRollCollab.OppositionDocData {\r\n\r\n  rollInstance: BladesRollCollab;\r\n  rollOppID: string|undefined;\r\n  rollOppDoc: BladesDoc|undefined;\r\n  rollOppName: string;\r\n  rollOppSubName: string;\r\n  rollOppType: string;\r\n  rollOppImg: string;\r\n  rollModsData: BladesRollCollab.RollModData[]|undefined;\r\n  rollFactors: Partial<Record<Factor, BladesRollCollab.FactorData>>;\r\n\r\n  constructor(rollInstance: BladesRollCollab, {rollOppID, rollOppDoc, rollOppName, rollOppSubName, rollOppType, rollOppImg, rollModsData, rollFactors}: Partial<BladesRollCollab.OppositionDocData> = {}) {\r\n    // Identify ID, Doc, Name, SubName, Type & Image, to best of ability\r\n    this.rollOppDoc = rollOppDoc;\r\n    this.rollInstance = rollInstance;\r\n    if (!this.rollOppDoc) {\r\n      if (rollOppID) {\r\n        this.rollOppDoc = game.items.get(rollOppID) ?? game.actors.get(rollOppID);\r\n      }\r\n      if (rollOppName) {\r\n        this.rollOppDoc = game.items.getName(rollOppName) ?? game.actors.getName(rollOppName);\r\n      }\r\n    }\r\n    if (this.rollOppDoc) {\r\n      this.rollOppID = this.rollOppDoc.rollOppID;\r\n      this.rollOppName = rollOppName ?? this.rollOppDoc.rollOppName;\r\n      this.rollOppSubName = rollOppSubName ?? this.rollOppDoc.rollOppSubName;\r\n      this.rollOppType = this.rollOppDoc.rollOppType;\r\n      this.rollOppImg = rollOppImg ?? this.rollOppDoc.rollOppImg ?? \"\";\r\n      this.rollModsData = [\r\n        ...rollModsData ?? [],\r\n        ...this.rollOppDoc.rollModsData ?? []\r\n      ];\r\n      this.rollFactors = Object.assign(\r\n        this.rollOppDoc.rollFactors,\r\n        rollFactors ?? {}\r\n      );\r\n    } else {\r\n      if (!rollOppName) { throw new Error(\"Must include a rollOppName when constructing a BladesRollOpposition object.\") }\r\n      if (!rollOppSubName) { throw new Error(\"Must include a rollOppSubName when constructing a BladesRollOpposition object.\") }\r\n      if (!rollOppType) { throw new Error(\"Must include a rollOppType when constructing a BladesRollOpposition object.\") }\r\n      if (!rollFactors) { throw new Error(\"Must include a rollFactors when constructing a BladesRollOpposition object.\") }\r\n\r\n      this.rollOppID = rollOppID;\r\n      this.rollOppName = rollOppName;\r\n      this.rollOppSubName = rollOppSubName;\r\n      this.rollOppType = rollOppType;\r\n      this.rollOppImg = rollOppImg ?? \"\";\r\n      this.rollModsData = rollModsData ?? [];\r\n      this.rollFactors = rollFactors;\r\n    }\r\n    if (this.rollModsData.length === 0) {\r\n      this.rollModsData = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nclass BladesRollSource implements BladesRollCollab.SourceDocData {\r\n\r\n  rollInstance: BladesRollCollab;\r\n  rollSourceID: string|undefined;\r\n  rollSourceDoc: BladesDoc|undefined;\r\n  rollSourceName: string;\r\n  rollSourceType: string;\r\n  rollSourceImg: string;\r\n\r\n  rollModsData: BladesRollCollab.RollModData[];\r\n  rollFactors: Partial<Record<Factor,BladesRollCollab.FactorData>>;\r\n\r\n  constructor(rollInstance: BladesRollCollab, {rollSourceID, rollSourceDoc, rollSourceName, rollSourceType, rollSourceImg, rollModsData, rollFactors}: Partial<BladesRollCollab.SourceDocData> = {}) {\r\n    // Identify ID, Doc, Name, SubName, Type & Image, to best of ability\r\n    this.rollSourceDoc = rollSourceDoc;\r\n    this.rollInstance = rollInstance;\r\n    if (!this.rollSourceDoc) {\r\n      if (rollSourceID) {\r\n        this.rollSourceDoc = game.items.get(rollSourceID) ?? game.actors.get(rollSourceID);\r\n      }\r\n      if (rollSourceName) {\r\n        this.rollSourceDoc = game.items.getName(rollSourceName) ?? game.actors.getName(rollSourceName);\r\n      }\r\n    }\r\n    if (this.rollSourceDoc) {\r\n      this.rollSourceID = this.rollSourceDoc.rollSourceID;\r\n      this.rollSourceName = rollSourceName ?? this.rollSourceDoc.rollSourceName;\r\n      this.rollSourceType = this.rollSourceDoc.rollSourceType;\r\n      this.rollSourceImg = rollSourceImg ?? this.rollSourceDoc.rollSourceImg ?? \"\";\r\n      this.rollModsData = [\r\n        ...rollModsData ?? [],\r\n        ...this.rollSourceDoc.rollModsData ?? []\r\n      ];\r\n      this.rollFactors = Object.assign(\r\n        this.rollSourceDoc.rollFactors,\r\n        rollFactors ?? {}\r\n      );\r\n    } else {\r\n      if (!rollSourceName) { throw new Error(\"Must include a rollSourceName when constructing a BladesRollSource object.\") }\r\n      if (!rollSourceImg) { throw new Error(\"Must include a rollSourceImg when constructing a BladesRollSource object.\") }\r\n      if (!rollSourceType) { throw new Error(\"Must include a rollSourceType when constructing a BladesRollSource object.\") }\r\n      if (!rollFactors) { throw new Error(\"Must include a rollFactors when constructing a BladesRollSource object.\") }\r\n\r\n      this.rollSourceID = rollSourceID;\r\n      this.rollSourceName = rollSourceName;\r\n      this.rollSourceType = rollSourceType;\r\n      this.rollSourceImg = rollSourceImg;\r\n      this.rollModsData = rollModsData ?? [];\r\n      this.rollFactors = rollFactors;\r\n    }\r\n  }\r\n}\r\n\r\n// #region *** CLASS *** BladesRollCollab\r\nclass BladesRollCollab extends DocumentSheet {\r\n\r\n  // #region STATIC METHODS: INITIALIZATION & DEFAULTS ~\r\n  static override get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"eunos-blades\", \"sheet\", \"roll-collab\", game.user.isGM ? \"gm-roll-collab\" : \"\"],\r\n      template: `systems/eunos-blades/templates/roll/roll-collab${game.user.isGM ? \"-gm\" : \"\"}.hbs`,\r\n      submitOnChange: true,\r\n      width: 500,\r\n      dragDrop: [\r\n        {dragSelector: null, dropSelector: \"[data-action='gm-drop-opposition'\"}\r\n      ]\r\n      // height: 500\r\n    });\r\n  }\r\n\r\n  static Initialize() {\r\n    // Hooks.on(\"preUpdateUser\", async (user: User, updateData: Record<string, any>) => {\r\n    //   const flatData = flattenObject(updateData);\r\n    //   const docSelectKeys = Object.keys(flatData)\r\n    //     .filter((key) => /docSelections/.test(key) && flatData[key] !== false);\r\n    //   if (docSelectKeys.length > 0) {\r\n    //     docSelectKeys.forEach((key) => {\r\n    //       const [_, category, name] = key.match(/docSelections\\.(.*?)\\.(.*)/) as [never, RollModCategory, string];\r\n    //       const rollMods = ((user.getFlag(\"eunos-blades\", \"rollCollab.rollMods\") ?? []) as BladesRollCollab.RollModData[]);\r\n    //       const rollMod = U.pullElement(rollMods, (mod: BladesRollCollab.RollModData | undefined) => mod?.name === name && mod?.category === category);\r\n    //       if (!rollMod || !rollMod.tooltip) { return }\r\n    //       const curSidestring = rollMod.sideString;\r\n    //       const newSidestring = (BladesActor.Get(flatData[key]) ?? BladesItem.Get(flatData[key]) ?? {name: \"\"}).name;\r\n    //       if (newSidestring === null) { return }\r\n    //       // if (curSidestring === newSidestring) { return }\r\n    //       rollMod.tooltip = rollMod.tooltip.replace(new RegExp(curSidestring || \"%DOC_NAME%\", \"g\"), newSidestring);\r\n    //       rollMod.sideString = newSidestring;\r\n    //       rollMods.push(rollMod);\r\n    //       user.setFlag(\"eunos-blades\", \"rollCollab.rollMods\", rollMods);\r\n    //     });\r\n    //   }\r\n\r\n    // });\r\n    return loadTemplates([\r\n      \"systems/eunos-blades/templates/roll/roll-collab.hbs\",\r\n      \"systems/eunos-blades/templates/roll/roll-collab-gm.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-gm-number-line.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-gm-select-doc.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-gm-factor-control.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-action.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-action-gm.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-resistance.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-resistance-gm.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-downtime.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-downtime-gm.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-fortune.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-fortune-gm.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-incarceration.hbs\",\r\n      \"systems/eunos-blades/templates/roll/partials/roll-collab-incarceration-gm.hbs\"\r\n    ]);\r\n  }\r\n  static InitSockets() {\r\n    socketlib.system.register(\"renderRollCollab\", BladesRollCollab.RenderRollCollab);\r\n    socketlib.system.register(\"closeRollCollab\", BladesRollCollab.CloseRollCollab);\r\n  }\r\n\r\n  static get DefaultRollMods(): BladesRollCollab.RollModData[] {\r\n    return [\r\n      {\r\n        id: \"Push-positive-roll\",\r\n        name: \"PUSH\",\r\n        category: RollModCategory.roll,\r\n        base_status: RollModStatus.ToggledOff,\r\n        posNeg: \"positive\",\r\n        modType: \"general\",\r\n        value: 1,\r\n        effectKeys: [\"ForceOff-Bargain\", \"Cost-Stress2\"],\r\n        tooltip: \"<h1>Push for +1d</h1><p>For <strong class='red-bright'>2 Stress</strong>, add <strong class='gold-bright'>1 die</strong> to your pool.</p><p><em>(You <strong>cannot</strong> also accept a <strong class='red-bright'>Devil's Bargain</strong> to increase your dice pool: It's one or the other.)</em></p>\"\r\n      },\r\n      {\r\n        id: \"Bargain-positive-roll\",\r\n        name: \"Bargain\",\r\n        category: RollModCategory.roll,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"positive\",\r\n        modType: \"general\",\r\n        value: 1,\r\n        effectKeys: [],\r\n        tooltip: \"<h1 class='red-bright'>Devil's Bargain</h1><p>The GM has offered you a <strong class='red-bright'>Devil's Bargain</strong>.</p><p><strong class='red-bright'>Accept the terms</strong> to add <strong class='gold-bright'>1 die</strong> to your pool.</p><p><em>(You <strong>cannot</strong> also <strong>Push for +1d</strong> to increase your dice pool: It's one or the other.)</em></p>\"\r\n      },\r\n      {\r\n        id: \"Assist-positive-roll\",\r\n        name: \"Assist\",\r\n        category: RollModCategory.roll,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"positive\",\r\n        modType: \"teamwork\",\r\n        value: 1,\r\n        tooltip: \"<h1 class='gold-bright'>%DOC_NAME% Assists</h1><p><strong class='gold-bright'>%DOC_NAME%</strong> is <strong>Assisting</strong> your efforts, adding <strong class='gold-bright'>1 die</strong> to your pool.</p>\"\r\n      },\r\n      {\r\n        id: \"Setup-positive-position\",\r\n        name: \"Setup\",\r\n        category: RollModCategory.position,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"positive\",\r\n        modType: \"teamwork\",\r\n        value: 1,\r\n        tooltip: \"<h1 class='gold-bright'>%DOC_NAME% Sets You Up</h1><p><strong class='gold-bright'>%DOC_NAME%</strong> has set you up for success with a preceding <strong>Setup</strong> action, increasing your <strong class='gold-bright'>Position</strong> by one level.</p>\"\r\n      },\r\n      {\r\n        id: \"Push-positive-effect\",\r\n        name: \"PUSH\",\r\n        category: RollModCategory.effect,\r\n        base_status: RollModStatus.ToggledOff,\r\n        posNeg: \"positive\",\r\n        modType: \"general\",\r\n        value: 1,\r\n        effectKeys: [\"Cost-Stress2\"],\r\n        tooltip: \"<h1>Push for Effect</h1><p>For <strong class='red-bright'>2 Stress</strong>, increase your <strong class='gold-bright'>Effect</strong> by one level.</p>\"\r\n      },\r\n      {\r\n        id: \"Setup-positive-effect\",\r\n        name: \"Setup\",\r\n        category: RollModCategory.effect,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"positive\",\r\n        modType: \"teamwork\",\r\n        value: 1,\r\n        tooltip: \"<h1 class='gold-bright'>%DOC_NAME% Sets You Up</h1><p><strong class='gold-bright'>%DOC_NAME%</strong> has set you up for success with a preceding <strong>Setup</strong> action, increasing your <strong class='gold-bright'>Effect</strong> by one level.</p>\"\r\n      },\r\n      {\r\n        id: \"Potency-positive-effect\",\r\n        name: \"Potency\",\r\n        category: RollModCategory.effect,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"positive\",\r\n        modType: \"general\",\r\n        value: 1,\r\n        tooltip: \"<h1>Potency</h1><p>By circumstance or advantage, you have <strong>Potency</strong> in this action, increasing your <strong class='gold-bright'>Effect</strong> by one level.</p>\"\r\n      },\r\n      {\r\n        id: \"Potency-negative-effect\",\r\n        name: \"Potency\",\r\n        category: RollModCategory.effect,\r\n        base_status: RollModStatus.Hidden,\r\n        posNeg: \"negative\",\r\n        modType: \"general\",\r\n        value: 1,\r\n        tooltip: \"<h1 class='red-bright'>Potency</h1><p>By circumstance or advantage, <strong class='red-bright'>@OPPOSITION_NAME@</strong> has <strong>Potency</strong> against you, reducing your <strong class='red-bright'>Effect</strong> by one level.\"\r\n      }\r\n    ];\r\n  }\r\n  static get DefaultFlagData(): BladesRollCollab.FlagData {\r\n    return {\r\n      rollID: randomID(),\r\n      rollType: RollType.Action,\r\n      rollSourceType: BladesActorType.pc,\r\n      rollSourceID: \"\",\r\n      rollTrait: Factor.tier,\r\n      rollModsData: {},\r\n      rollPositionInitial: Position.risky,\r\n      rollEffectInitial: Effect.standard,\r\n      rollPosEffectTrade: false,\r\n      isGMReady: false,\r\n      GMBoosts: {\r\n        [Factor.tier]: 0,\r\n        [Factor.quality]: 0,\r\n        [Factor.scale]: 0,\r\n        [Factor.magnitude]: 0\r\n      },\r\n      GMOppBoosts: {\r\n        [Factor.tier]: 0,\r\n        [Factor.quality]: 0,\r\n        [Factor.scale]: 0,\r\n        [Factor.magnitude]: 0\r\n      },\r\n      docSelections: {\r\n        [RollModCategory.roll]: {\r\n          Assist: false,\r\n          Group_1: false,\r\n          Group_2: false,\r\n          Group_3: false,\r\n          Group_4: false,\r\n          Group_5: false,\r\n          Group_6: false\r\n        },\r\n        [RollModCategory.position]: {\r\n          Setup: false\r\n        },\r\n        [RollModCategory.effect]: {\r\n          Setup: false\r\n        }\r\n      },\r\n      rollFactorToggles: {\r\n        source: {\r\n          [Factor.tier]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.quality]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.scale]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.magnitude]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          }\r\n        },\r\n        opposition: {\r\n          [Factor.tier]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.quality]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.scale]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          },\r\n          [Factor.magnitude]: {\r\n            display: \"\",\r\n            isActive: false,\r\n            isPrimary: false,\r\n            isDominant: false,\r\n            highFavorsPC: true\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n  // #endregion\r\n\r\n  // #region NEW ROLL CREATION: Rendering, Constructor ~\r\n  static Current: Record<string, BladesRollCollab> = {};\r\n\r\n  static _Active?: BladesRollCollab;\r\n  static get Active(): BladesRollCollab|undefined {\r\n    if (BladesRollCollab._Active) { return BladesRollCollab._Active }\r\n    if (U.objSize(BladesRollCollab.Current) > 0) { return Object.values(BladesRollCollab.Current)[0] }\r\n    return undefined;\r\n  }\r\n  static set Active(val: BladesRollCollab|undefined) {\r\n    BladesRollCollab._Active = val;\r\n  }\r\n\r\n  static async RenderRollCollab({userID, rollID}: { userID: string, rollID: string }) {\r\n    const user = game.users.get(userID); // as User & {flags: {[\"eunos-blades\"]: {rollCollab: BladesRollCollab.FlagData}}};\r\n    if (!user) { return }\r\n    BladesRollCollab.Current[rollID] = new BladesRollCollab(user, rollID);\r\n    BladesRollCollab.Current[rollID].render(true);\r\n  }\r\n\r\n  static async CloseRollCollab(rollID: string) {\r\n    eLog.checkLog3(\"rollCollab\", \"CloseRollCollab()\", {rollID});\r\n    await BladesRollCollab.Current[rollID]?.close({rollID});\r\n    delete BladesRollCollab.Current[rollID];\r\n  }\r\n\r\n  static async NewRoll(config: BladesRollCollab.Config) {\r\n    if (game.user.isGM && BladesActor.IsType(config.rollSource, BladesActorType.pc)) {\r\n      const rSource: BladesPC = config.rollSource;\r\n      if (rSource.primaryUser?.id) {\r\n        config.userID = rSource.primaryUser.id;\r\n      }\r\n    }\r\n\r\n    const user = game.users.get(config.userID ?? game.user._id);\r\n    if (!(user instanceof User)) {\r\n      eLog.error(\"rollCollab\", `[NewRoll()] Can't Find User '${config.userID}'`, config);\r\n      return;\r\n    }\r\n    await user.unsetFlag(C.SYSTEM_ID, \"rollCollab\");\r\n\r\n    const flagUpdateData: BladesRollCollab.FlagData = {...BladesRollCollab.DefaultFlagData};\r\n\r\n    flagUpdateData.rollType = config.rollType;\r\n    if (!(flagUpdateData.rollType in RollType)) {\r\n      eLog.error(\"rollCollab\", `[RenderRollCollab()] Invalid rollType: ${flagUpdateData.rollType}`, config);\r\n      return;\r\n    }\r\n    const rollSourceData: BladesRollCollab.SourceDocData|undefined = config.rollSource ?? user.character;\r\n    // const rollSource = rollSourceData ? new BladesRollSource(this, rollSourceData) : undefined;\r\n    if (!rollSourceData) {\r\n      eLog.error(\"rollCollab\", \"[RenderRollCollab()] Invalid rollSource\", {rollSourceData, config});\r\n      return;\r\n    }\r\n    flagUpdateData.rollSourceID = rollSourceData.rollSourceID;\r\n    flagUpdateData.rollSourceType = rollSourceData.rollSourceType;\r\n    if (U.isInt(config.rollTrait)) {\r\n      flagUpdateData.rollTrait = config.rollTrait;\r\n    } else if (!config.rollTrait) {\r\n      eLog.error(\"rollCollab\", \"[RenderRollCollab()] No RollTrait in Config\", config);\r\n      return;\r\n    } else {\r\n      switch (flagUpdateData.rollType) {\r\n        case RollType.Action: {\r\n          if (!(U.lCase(config.rollTrait) in {...Action, ...Factor})) {\r\n            eLog.error(\"rollCollab\", `[RenderRollCollab()] Bad RollTrait for Action Roll: ${config.rollTrait}`, config);\r\n            return;\r\n          }\r\n          flagUpdateData.rollTrait = U.lCase(config.rollTrait) as Action | Factor;\r\n          break;\r\n        }\r\n        case RollType.Downtime: {\r\n          if (!(U.lCase(config.rollTrait) in {...Action, ...Factor})) {\r\n            eLog.error(\"rollCollab\", `[RenderRollCollab()] Bad RollTrait for Downtime Roll: ${config.rollTrait}`, config);\r\n            return;\r\n          }\r\n          flagUpdateData.rollTrait = U.lCase(config.rollTrait) as Action | Factor;\r\n          break;\r\n        }\r\n        case RollType.Fortune: {\r\n          if (!(U.lCase(config.rollTrait) in {...Action, ...Attribute, ...Factor})) {\r\n            eLog.error(\"rollCollab\", `[RenderRollCollab()] Bad RollTrait for Fortune Roll: ${config.rollTrait}`, config);\r\n            return;\r\n          }\r\n          flagUpdateData.rollTrait = U.lCase(config.rollTrait) as Action | Attribute | Factor;\r\n          break;\r\n        }\r\n        case RollType.Resistance: {\r\n          if (!(U.lCase(config.rollTrait) in Attribute)) {\r\n            eLog.error(\"rollCollab\", `[RenderRollCollab()] Bad RollTrait for Resistance Roll: ${config.rollTrait}`, config);\r\n            return;\r\n          }\r\n          break;\r\n        }\r\n        // no default\r\n      }\r\n      flagUpdateData.rollTrait = U.lCase(config.rollTrait) as BladesRollCollab.RollTrait;\r\n    }\r\n\r\n    await user.setFlag(C.SYSTEM_ID, \"rollCollab\", flagUpdateData);\r\n    BladesRollCollab.RenderRollCollab({userID: user._id, rollID: flagUpdateData.rollID});\r\n    socketlib.system.executeForAllGMs(\"renderRollCollab\", {userID: user._id, rollID: flagUpdateData.rollID});\r\n  }\r\n\r\n  rollID: string;\r\n  constructor(user: User, rollID: string) {\r\n    super(user);\r\n    this.rollID = rollID;\r\n  }\r\n  // #endregion\r\n\r\n  // #region Basic User Flag Getters/Setters ~\r\n  get rData(): BladesRollCollab.FlagData {\r\n    if (!this.document.getFlag(C.SYSTEM_ID, \"rollCollab\")) {\r\n      throw new Error(\"[get flags()] No RollCollab Flags Found on User\");\r\n    }\r\n    return this.document.getFlag(C.SYSTEM_ID, \"rollCollab\") as BladesRollCollab.FlagData;\r\n  }\r\n\r\n  _rollSource?: BladesRollSource;\r\n  get rollSource(): BladesRollSource | undefined {\r\n    if (!this._rollSource) {\r\n      if (this.rData.rollSourceData) {\r\n        this._rollSource = new BladesRollSource(this, this.rData.rollSourceData);\r\n      }\r\n    }\r\n    if (this._rollSource instanceof BladesRollSource) {\r\n      return this._rollSource;\r\n    }\r\n    return undefined;\r\n  }\r\n  set rollSource(val: BladesRollCollab.SourceDocData | undefined) {\r\n    if (val === undefined) {\r\n      this._rollSource = undefined;\r\n    } else {\r\n      this._rollSource = new BladesRollSource(this, val);\r\n    }\r\n  }\r\n\r\n  _rollParticipants: BladesRollCollab.ParticipantDocData[] = [];\r\n  // get rollParticipants(): Array<BladesRollCollab.\r\n\r\n  _rollOpposition?: BladesRollOpposition;\r\n  get rollOpposition(): BladesRollOpposition|undefined {\r\n    if (!this._rollOpposition) {\r\n      if (this.rData.rollOppositionData) {\r\n        this._rollOpposition = new BladesRollOpposition(this, this.rData.rollOppositionData);\r\n      }\r\n    }\r\n    if (this._rollOpposition instanceof BladesRollOpposition) {\r\n      return this._rollOpposition;\r\n    }\r\n    return undefined;\r\n  }\r\n  set rollOpposition(val: BladesRollCollab.OppositionDocData | undefined) {\r\n    if (val === undefined) {\r\n      this._rollOpposition = undefined;\r\n    } else {\r\n      this._rollOpposition = new BladesRollOpposition(this, val);\r\n    }\r\n  }\r\n\r\n  get rollType(): RollType { return this.rData.rollType }\r\n  get rollSubType(): RollSubType|undefined { return this.rData.rollSubType }\r\n  get rollDowntimeAction(): DowntimeAction|undefined { return this.rData.rollDowntimeAction }\r\n  get rollTrait(): BladesRollCollab.RollTrait { return this.rData.rollTrait }\r\n\r\n  _rollTraitValOverride?: number;\r\n  get rollTraitValOverride(): number | undefined { return this._rollTraitValOverride }\r\n  set rollTraitValOverride(val: number | undefined) { this._rollTraitValOverride = val }\r\n  get rollTraitData(): NamedValueMax & {gmTooltip?: string, pcTooltip?: string} {\r\n    if (BladesActor.IsType(this.rollSource?.rollSourceDoc, BladesActorType.pc)) {\r\n      if (isAction(this.rollTrait)) {\r\n        return {\r\n          name: this.rollTrait,\r\n          value: this.rollTraitValOverride ?? this.rollSource!.rollSourceDoc.actions[this.rollTrait],\r\n          max: this.rollTraitValOverride ?? this.rollSource!.rollSourceDoc.actions[this.rollTrait],\r\n          pcTooltip: this.rollSource!.rollSourceDoc.rollTraitPCTooltipActions,\r\n          gmTooltip: C.ActionTooltipsGM[this.rollTrait]\r\n        };\r\n      }\r\n      if (isAttribute(this.rollTrait)) {\r\n        return {\r\n          name: this.rollTrait,\r\n          value: this.rollTraitValOverride ?? this.rollSource!.rollSourceDoc.attributes[this.rollTrait],\r\n          max: this.rollTraitValOverride ?? this.rollSource!.rollSourceDoc.attributes[this.rollTrait],\r\n          pcTooltip: this.rollSource!.rollSourceDoc.rollTraitPCTooltipAttributes,\r\n          gmTooltip: C.AttributeTooltips[this.rollTrait]\r\n        };\r\n      }\r\n    }\r\n    if (U.isInt(this.rollTrait)) {\r\n      return {\r\n        name: `+${this.rollTraitValOverride ?? this.rollTrait}`,\r\n        value: this.rollTraitValOverride ?? this.rollTrait,\r\n        max: this.rollTraitValOverride ?? this.rollTrait\r\n      };\r\n    }\r\n    if (isFactor(this.rollTrait)) {\r\n      return {\r\n        name: U.tCase(this.rollTrait),\r\n        value: this.rollTraitValOverride ?? this.rollSource?.rollFactors[this.rollTrait]?.value ?? 0,\r\n        max: this.rollTraitValOverride ?? this.rollSource?.rollFactors[this.rollTrait]?.max ?? 10\r\n      };\r\n    }\r\n    throw new Error(`[get rollTraitData] Invalid rollTrait: '${this.rollTrait}'`);\r\n  }\r\n  get rollTraitOptions(): Array<{ name: string, value: BladesRollCollab.RollTrait }> {\r\n    if (BladesActor.IsType(this.rollSource, BladesActorType.pc)) {\r\n      if (isAction(this.rollTrait)) {\r\n        return Object.values(Action)\r\n          .map((action) => ({\r\n            name: U.uCase(action),\r\n            value: action\r\n          }));\r\n      }\r\n      if (isAttribute(this.rollTrait)) {\r\n        return Object.values(Attribute)\r\n          .map((attribute) => ({\r\n            name: U.uCase(attribute),\r\n            value: attribute\r\n          }));\r\n      }\r\n    }\r\n    if (U.isInt(this.rollTrait)) {\r\n      return [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\r\n        .map((num) => ({\r\n          name: `+${num}`,\r\n          value: num\r\n        }));\r\n    }\r\n    if (isFactor(this.rollTrait)) {\r\n      return [];\r\n    }\r\n    throw new Error(`[get rollTraitOptions] Invalid rollTrait: '${this.rollTrait}'`);\r\n  }\r\n\r\n  get posEffectTrade(): \"position\" | \"effect\" | false {\r\n    return this.rData?.rollPosEffectTrade ?? false;\r\n  }\r\n  get initialPosition(): Position {\r\n    return this.rData?.rollPositionInitial ?? Position.risky;\r\n  }\r\n  set initialPosition(val: Position) {\r\n    this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollPositionInitial\", val);\r\n  }\r\n  get initialEffect(): Effect {\r\n    return this.rData?.rollEffectInitial ?? Effect.standard;\r\n  }\r\n  set initialEffect(val: Effect) {\r\n    this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollEffectInitial\", val);\r\n  }\r\n  get rollConsequence(): BladesRollCollab.ConsequenceData | undefined {\r\n    return this.rData?.rollConsequence;\r\n  }\r\n  // #endregion\r\n\r\n  // #region GETTERS: DERIVED DATA ~\r\n  get finalPosition(): Position {\r\n    return Object.values(Position)[U.clampNum(\r\n      Object.values(Position)\r\n        .indexOf(this.initialPosition)\r\n      + this.getModsDelta(RollModCategory.position)\r\n      + (this.posEffectTrade === \"position\" ? 1 : 0)\r\n      + (this.posEffectTrade === \"effect\" ? -1 : 0),\r\n      [0, 2]\r\n    )];\r\n  }\r\n  get finalEffect(): Effect {\r\n    return Object.values(Effect)[U.clampNum(\r\n      Object.values(Effect)\r\n        .indexOf(this.initialEffect)\r\n      + this.getModsDelta(RollModCategory.effect)\r\n      + (this.posEffectTrade === \"effect\" ? 1 : 0)\r\n      + (this.posEffectTrade === \"position\" ? -1 : 0),\r\n      [0, 4]\r\n    )];\r\n  }\r\n  get finalResult(): number {\r\n    return this.getModsDelta(RollModCategory.result)\r\n      + (this.rData?.GMBoosts.Result ?? 0)\r\n      + (this.tempGMBoosts.Result ?? 0);\r\n  }\r\n  get finalDicePool(): number {\r\n    return Math.max(0, this.rollTraitData.value\r\n      + this.getModsDelta(RollModCategory.roll)\r\n      + (this.rData.GMBoosts.Dice ?? 0)\r\n      + (this.tempGMBoosts.Dice ?? 0));\r\n  }\r\n  get isRollingZero(): boolean {\r\n    return Math.max(0, this.rollTraitData.value\r\n      + this.getModsDelta(RollModCategory.roll)\r\n      + (this.rData.GMBoosts.Dice ?? 0)\r\n      + (this.tempGMBoosts.Dice ?? 0)) <= 0;\r\n  }\r\n\r\n  _roll?: Roll;\r\n  get roll(): Roll { return (this._roll ??= new Roll(`${this.isRollingZero ? 2 : this.finalDicePool}d6`, {})) }\r\n\r\n  get rollFactors(): Record<\"source\" | \"opposition\", Partial<Record<Factor, BladesRollCollab.FactorData>>> {\r\n    const sourceFactors: Partial<Record<Factor, BladesRollCollab.FactorData>> = Object.fromEntries((Object.entries(this.rollSource?.rollFactors ?? {}) as Array<[Factor, BladesRollCollab.FactorData]>)\r\n      .map(([factor, factorData]) => [\r\n        factor,\r\n        {\r\n          ...factorData,\r\n          ...this.rData.rollFactorToggles.source[factor] ?? []\r\n        }\r\n      ]));\r\n    Object.entries(this.rData.rollFactorToggles.source).forEach(([factor, factorData]) => {\r\n      if (!(factor in sourceFactors)) {\r\n        sourceFactors[factor as Factor] = {\r\n          name: factor,\r\n          value: 0,\r\n          max: 0,\r\n          baseVal: 0,\r\n          cssClasses: \"factor-gold\",\r\n          isActive: factorData.isActive ?? false,\r\n          isPrimary: factorData.isPrimary ?? factor === Factor.tier ?? false,\r\n          isDominant: factorData.isDominant ?? false,\r\n          highFavorsPC: factorData.highFavorsPC ?? true\r\n        };\r\n      }\r\n    });\r\n    Object.keys(sourceFactors).forEach((factor) => {\r\n      sourceFactors[factor as Factor]!.value\r\n        += (this.rData.GMBoosts[factor as Factor] ?? 0)\r\n        + (this.tempGMBoosts[factor as Factor] ?? 0);\r\n\r\n      if (factor === Factor.tier) {\r\n        sourceFactors[factor as Factor]!.display = U.romanizeNum(sourceFactors[factor as Factor]!.value);\r\n      } else {\r\n        sourceFactors[factor as Factor]!.display = `${sourceFactors[factor as Factor]!.value}`;\r\n      }\r\n    });\r\n\r\n    // if (!this.rollOpposition) { return {source: sourceFactors, opposition: sourceFactors} }\r\n\r\n    const rollOppFactors = ((this.rollOpposition as any)?.rollFactors as Record<Factor, BladesRollCollab.FactorData> | undefined)\r\n      ?? Object.fromEntries(([\r\n        Factor.tier,\r\n        Factor.quality,\r\n        Factor.scale,\r\n        Factor.magnitude\r\n      ]).map((factor: Factor) => [\r\n        factor as Factor,\r\n        {\r\n          name: factor,\r\n          value: 0,\r\n          max: 0,\r\n          baseVal: 0,\r\n          cssClasses: \"factor-gold\",\r\n          isActive: false,\r\n          isPrimary: factor === Factor.tier ?? false,\r\n          isDominant: false,\r\n          highFavorsPC: true\r\n        } as BladesRollCollab.FactorData\r\n      ])) as Record<Factor, BladesRollCollab.FactorData>;\r\n    const oppFactors: Partial<Record<Factor, BladesRollCollab.FactorData>> = {};\r\n\r\n\r\n    (Object.entries(rollOppFactors) as Array<[Factor, BladesRollCollab.FactorData]>)\r\n      .forEach(([factor, factorData]) => {\r\n        oppFactors[factor as Factor] = {\r\n          ...factorData,\r\n          ...this.rData.rollFactorToggles.opposition[factor] ?? []\r\n        };\r\n      });\r\n\r\n    Object.entries(this.rData.rollFactorToggles.opposition).forEach(([factor, factorData]) => {\r\n      if (!(factor in oppFactors)) {\r\n        oppFactors[factor as Factor] = {\r\n          name: factor,\r\n          value: 0,\r\n          max: 0,\r\n          baseVal: 0,\r\n          cssClasses: \"factor-gold\",\r\n          isActive: factorData.isActive ?? false,\r\n          isPrimary: factorData.isPrimary ?? factor === Factor.tier ?? false,\r\n          isDominant: factorData.isDominant ?? false,\r\n          highFavorsPC: factorData.highFavorsPC ?? true\r\n        };\r\n      }\r\n    });\r\n    Object.keys(oppFactors).forEach((factor) => {\r\n      oppFactors[factor as Factor]!.value += this.rData.GMOppBoosts[factor as Factor] ?? 0;\r\n      if (factor === Factor.tier) {\r\n        oppFactors[factor as Factor]!.display = U.romanizeNum(oppFactors[factor as Factor]!.value);\r\n      } else {\r\n        oppFactors[factor as Factor]!.display = `${oppFactors[factor as Factor]!.value}`;\r\n      }\r\n    });\r\n\r\n    return {\r\n      source: sourceFactors,\r\n      opposition: oppFactors\r\n    };\r\n  }\r\n  // #endregion\r\n\r\n  // #region ROLL MODS: Getters & Update Method ~\r\n\r\n  initRollMods(modsData: BladesRollCollab.RollModData[]) {\r\n    // Reset override values previously enabled by rollmods\r\n    this.rollTraitValOverride = undefined;\r\n    this.rollFactorPenaltiesNegated = {};\r\n    this.tempGMBoosts = {};\r\n\r\n    this.rollMods = modsData.map((modData) => new BladesRollMod(modData, this));\r\n\r\n    // this.logModStatus();\r\n    const initReport: Record<string, Record<string, Partial<Record<\"mod\"|\"status\"|\"user_status\"|\"held_status\"|\"base_status\",string|BladesRollMod|undefined>>|null>> = {};\r\n\r\n    /* *** PASS ONE: DISABLE PASS *** */\r\n    // initReport[\"[PASS 1.0] *** DISABLE PASS ***\"] = this.getStatusSummary();\r\n\r\n    let checkDisableMods = [...this.rollMods];\r\n\r\n    // ... Conditional Status Pass\r\n    checkDisableMods = checkDisableMods\r\n      .filter((rollMod) => !rollMod.setConditionalStatus());\r\n    // initReport[\"[PASS 1.1] Conditional Status Pass\"] = this.getStatusChanges();\r\n\r\n    // ... AutoReveal/AutoEnable Pass\r\n    checkDisableMods = checkDisableMods\r\n      .filter((rollMod) => !rollMod.setAutoStatus());\r\n    // initReport[\"[PASS 1.2] Auto Status Pass\"] = this.getStatusChanges();\r\n\r\n    // ... Payable Pass\r\n    checkDisableMods = checkDisableMods\r\n      .filter((rollMod) => !rollMod.setPayableStatus());\r\n    // initReport[\"[PASS 1.3] Payable Status Pass\"] = this.getStatusChanges();\r\n\r\n    /* *** PASS TWO: FORCE-ON PASS *** */\r\n    // initReport[\"[PASS 2.0] *** FORCE-ON PASS ***\"] = this.getStatusSummary();\r\n\r\n    const parseForceOnKeys = (mod: BladesRollMod) => {\r\n      const holdKeys = mod.effectKeys.filter((key) => /^ForceOn/.test(key));\r\n      if (holdKeys.length === 0) { return }\r\n\r\n      while (holdKeys.length) {\r\n        const thisTarget = holdKeys.pop()!.split(/-/)!.pop()!;\r\n        if (thisTarget === \"BestAction\") {\r\n          if (BladesActor.IsType(this.rollSource?.rollSourceDoc, BladesActorType.pc)) {\r\n            this.rollTraitValOverride = Math.max(...Object.values(this.rollSource!.rollSourceDoc.actions));\r\n          }\r\n          continue;\r\n        }\r\n        const [targetName, targetCat, targetPosNeg] = thisTarget.split(/,/)! as [string, RollModCategory | undefined, \"positive\" | \"negative\" | undefined];\r\n        let targetMod = this.getRollModByName(targetName)\r\n          ?? this.getRollModByName(targetName, targetCat ?? mod.category);\r\n        if (!targetMod && targetName === \"Push\") {\r\n          [targetMod] = [\r\n            ...this.getActiveBasicPushMods(targetCat ?? mod.category, \"negative\").filter((mod) => mod.status === RollModStatus.ToggledOn),\r\n            ...this.getActiveBasicPushMods(targetCat ?? mod.category, \"positive\").filter((mod) => mod.status === RollModStatus.ToggledOn),\r\n            ...this.getInactiveBasicPushMods(targetCat ?? mod.category, \"positive\").filter((mod) => mod.status === RollModStatus.ToggledOff)\r\n          ];\r\n        }\r\n        targetMod ??= this.getRollModByName(targetName, targetCat ?? mod.category, targetPosNeg ?? mod.posNeg);\r\n        if (!targetMod) { throw new Error(`No mod found matching ${targetName}/${targetCat}/${targetPosNeg}`) }\r\n        if (!targetMod.isActive) {\r\n          targetMod.held_status = RollModStatus.ForcedOn;\r\n          parseForceOnKeys(targetMod);\r\n        } else {\r\n          targetMod.held_status = RollModStatus.ForcedOn;\r\n        }\r\n\r\n      }\r\n    };\r\n    this.getActiveRollMods().forEach((rollMod) => parseForceOnKeys(rollMod));\r\n    // initReport[\"[PASS 2.1] Force-On Pass\"] = this.getStatusChanges();\r\n\r\n    /* *** PASS THREE: PUSH-CHECK PASS *** */\r\n    // initReport[\"[PASS 3.0] *** PUSH-CHECK PASS ***\"] = this.getStatusSummary();\r\n\r\n    // IF ROLL FORCED ...\r\n    if (this.isForcePushed()) {\r\n      // ... Force Off _ALL_ visible, inactive \"Is-Push\" mods.\r\n      this.getInactivePushMods()\r\n        .filter((mod) => !mod.isBasicPush)\r\n        .forEach((mod) => { mod.held_status = RollModStatus.ForcedOff });\r\n      // initReport[\"[PASS 3.1] Forced-Off 'Is-Push' Pass\"] = this.getStatusChanges();\r\n    }\r\n\r\n    // ... BY CATEGORY ...\r\n    [RollModCategory.roll, RollModCategory.effect].forEach((cat, i) => {\r\n      if (this.isPushed(cat)) {\r\n        // ... if pushed by positive mod, Force Off any visible Bargain\r\n        if (cat === RollModCategory.roll && this.isPushed(cat, \"positive\")) {\r\n          const bargainMod = this.getRollModByID(\"Bargain-positive-roll\");\r\n          if (bargainMod?.isVisible) {\r\n            bargainMod.held_status = RollModStatus.ForcedOff;\r\n          }\r\n        }\r\n        // initReport[`[PASS 3.2.${i+1}] {${U.uCase(cat)}}: Force-Off Bargain Pass`] = this.getStatusChanges();\r\n      } else {\r\n        // Otherwise, hide all Is-Push mods\r\n        this.getInactivePushMods(cat)\r\n          .filter((mod) => !mod.isBasicPush)\r\n          .forEach((mod) => { mod.held_status = RollModStatus.Hidden});\r\n        // initReport[`[PASS 3.2.${i+1}] {${U.uCase(cat)}}: Hide 'Is-Push' Mods`] = this.getStatusChanges();\r\n      }\r\n    });\r\n\r\n    /* *** PASS FOUR: Relevancy Pass *** */\r\n    // initReport[\"[PASS 4] *** RELEVANCY PASS ***\"] = this.getStatusSummary();\r\n\r\n    this.getVisibleRollMods()\r\n      .forEach((mod) => { mod.setRelevancyStatus() });\r\n    // initReport[\"[PASS 4] 1. Relevancy Status Pass\"] = this.getStatusChanges();\r\n\r\n    /* *** PASS FIVE: Overpayment Pass *** */\r\n    // initReport[\"[PASS 5] *** OVERPAYMENT PASS ***\"] = this.getStatusSummary();\r\n\r\n    // ... If 'Cost-SpecialArmor' active, ForceOff other visible Cost-SpecialArmor mods\r\n    const activeArmorCostMod = this.getActiveRollMods().find((mod) => mod.effectKeys.includes(\"Cost-SpecialArmor\"));\r\n    if (activeArmorCostMod) {\r\n      this.getVisibleRollMods()\r\n        .filter((mod) => !mod.isActive && mod.effectKeys.includes(\"Cost-SpecialArmor\"))\r\n        .forEach((mod) => { mod.held_status = RollModStatus.ForcedOff });\r\n    }\r\n\r\n    // initReport[\"[PASS 5.1] Special Armor Force-Off Pass\"] = this.getStatusChanges();\r\n\r\n    eLog.checkLog2(\"rollMods\", \"*** initRollMods() PASS ***\", initReport);\r\n  }\r\n\r\n  isTraitRelevant(trait: BladesRollCollab.RollTrait): boolean {\r\n    if (trait in Factor) {\r\n      const {source, opposition} = this.rollFactors;\r\n      return Boolean(trait in source && trait in opposition && source[trait as Factor]?.isActive);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  rollFactorPenaltiesNegated: Partial<Record<Factor, boolean>> = {};\r\n  negateFactorPenalty(factor: Factor) {\r\n    this.rollFactorPenaltiesNegated[factor] = true;\r\n  }\r\n\r\n  tempGMBoosts: Partial<Record<\"Dice\" | Factor | \"Result\", number>> = {};\r\n\r\n  isPushed(cat?: RollModCategory, posNeg?: \"positive\"|\"negative\"): boolean { return this.getActiveBasicPushMods(cat, posNeg).length > 0 }\r\n  hasOpenPush(cat?: RollModCategory, posNeg?: \"positive\"|\"negative\"): boolean { return this.isPushed(cat) && this.getOpenPushMods(cat, posNeg).length > 0 }\r\n  isForcePushed(cat?: RollModCategory, posNeg?: \"positive\"|\"negative\"): boolean { return this.isPushed(cat) && this.getForcedPushMods(cat, posNeg).length > 0 }\r\n\r\n\r\n  get rollCosts(): number {\r\n    if (!this.isPushed) { return 0 }\r\n    const harmPush = this.getRollModByID(\"Push-negative-roll\");\r\n    const rollPush = this.getRollModByID(\"Push-positive-roll\");\r\n    const effectPush = this.getRollModByID(\"Push-positive-effect\");\r\n    const negatePushCostMods = this.getActiveRollMods(RollModCategory.after, \"positive\")\r\n      .filter((mod) => mod.effectKeys.includes(\"Negate-PushCost\"));\r\n    return ((harmPush && harmPush.isActive && harmPush.stressCost) || 0)\r\n      + ((rollPush && rollPush.isActive && rollPush.stressCost) || 0)\r\n      + ((effectPush && effectPush.isActive && effectPush.stressCost) || 0)\r\n      - (negatePushCostMods.length * 2);\r\n  }\r\n\r\n  get rollCostData(): Array<{ id: string, label: string, costType: string, costAmount: number }> {\r\n    return this.getActiveRollMods()\r\n      .map((rollMod) => rollMod.costs ?? [])\r\n      .flat();\r\n  }\r\n\r\n  getRollModByName(name: string, cat?: RollModCategory, posNeg?: \"positive\" | \"negative\"): BladesRollMod | undefined {\r\n    const modMatches = this.rollMods.filter((rollMod) => U.lCase(rollMod.name) === U.lCase(name)\r\n      && (!cat || rollMod.category === cat)\r\n      && (!posNeg || rollMod.posNeg === posNeg));\r\n    if (modMatches.length === 0) { return undefined }\r\n    if (modMatches.length > 1) {\r\n      // eLog.error(\"rollMods\", `Too Many Mods (${modMatches.length}) Match ${name}/${cat}/${posNeg}: [${modMatches.map((rollMod) => rollMod.id).join(\", \")}]`);\r\n      return undefined;\r\n    }\r\n    return modMatches[0];\r\n  }\r\n  getRollModByID(id: string) { return this.rollMods.find((rollMod) => rollMod.id === id) }\r\n  getRollMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.rollMods.filter((rollMod) =>\r\n      (!cat || rollMod.category === cat)\r\n      && (!posNeg || rollMod.posNeg === posNeg));\r\n  }\r\n  getVisibleRollMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getRollMods(cat, posNeg).filter((rollMod) => rollMod.isVisible);\r\n  }\r\n  getActiveRollMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getRollMods(cat, posNeg).filter((rollMod) => rollMod.isActive);\r\n  }\r\n  getVisibleInactiveRollMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getVisibleRollMods(cat, posNeg).filter((rollMod) => !rollMod.isActive);\r\n  }\r\n  getPushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getRollMods(cat, posNeg).filter((rollMod) => rollMod.isPush);\r\n  }\r\n  getVisiblePushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getPushMods(cat, posNeg).filter((rollMod) => rollMod.isVisible);\r\n  }\r\n  getActivePushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getVisiblePushMods(cat, posNeg).filter((rollMod) => rollMod.isActive);\r\n  }\r\n  getActiveBasicPushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getActivePushMods(cat, posNeg).filter((rollMod) => rollMod.isBasicPush);\r\n  }\r\n  getInactivePushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getVisiblePushMods(cat, posNeg).filter((rollMod) => !rollMod.isActive);\r\n  }\r\n  getInactiveBasicPushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getInactivePushMods(cat, posNeg).filter((rollMod) => rollMod.isBasicPush);\r\n  }\r\n  getForcedPushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getActivePushMods(cat, posNeg)\r\n      .filter((rollMod) => rollMod.isBasicPush\r\n        && rollMod.status === RollModStatus.ForcedOn);\r\n  }\r\n  getOpenPushMods(cat?: RollModCategory, posNeg?: \"positive\" | \"negative\") {\r\n    return this.getActivePushMods(cat, posNeg)\r\n      .filter((rollMod) => rollMod.isBasicPush\r\n        && rollMod.status === RollModStatus.ToggledOn);\r\n  }\r\n\r\n\r\n  getModsDelta = (cat: RollModCategory) => {\r\n    return U.sum([\r\n      ...this.getActiveRollMods(cat, \"positive\").map((mod) => mod.value),\r\n      ...this.getActiveRollMods(cat, \"negative\").map((mod) => -mod.value)\r\n    ]);\r\n  };\r\n\r\n  _rollMods?: BladesRollMod[];\r\n  get rollMods(): BladesRollMod[] {\r\n    if (!this._rollMods) { throw new Error(\"[get rollMods] No roll mods found!\") }\r\n    return this._rollMods.sort((modA, modB) => {\r\n      if (modA.isBasicPush) { return -1 }\r\n      if (modB.isBasicPush) { return 1 }\r\n      if (modA.name === \"Bargain\" && modA.isActive) { return -1 }\r\n      if (modB.name === \"Bargain\" && modB.isActive) { return 1 }\r\n      if (modA.isPush) { return -1 }\r\n      if (modB.isPush) { return 1 }\r\n      if (modA.name === \"Bargain\") { return -1 }\r\n      if (modB.name === \"Bargain\") { return 1 }\r\n      if (modA.name === \"Assist\") { return -1 }\r\n      if (modB.name === \"Assist\") { return 1 }\r\n      if (modA.name === \"Setup\") { return -1 }\r\n      if (modB.name === \"Setup\") { return 1 }\r\n      return modA.name.localeCompare(modB.name);\r\n    });\r\n  }\r\n  set rollMods(val: BladesRollMod[]) { this._rollMods = val }\r\n\r\n  // #endregion\r\n\r\n  // #region *** GETDATA *** ~\r\n\r\n  // _lastStatusData: Record<string,string> = {};\r\n  // logModStatus() {\r\n  //   if (!CONFIG.debug.logging) { return }\r\n  //   this._lastStatusData = {};\r\n  //   this.rollMods.forEach((mod) => {\r\n  //     this._lastStatusData[mod.id] = stringifyRollModStatus(mod);\r\n  //   });\r\n  // }\r\n  // getStatusSummary() {\r\n  //   if (!CONFIG.debug.logging) { return {} }\r\n  //   const statusData: Record<string, Record<\"mod\"|\"status\"|\"user_status\"|\"held_status\"|\"base_status\",BladesRollMod|string|undefined>> = {};\r\n  //   this.rollMods.forEach((mod) => {\r\n  //     statusData[mod.id] = {\r\n  //       mod,\r\n  //       ...getRollModStatus(mod)\r\n  //     };\r\n  //   });\r\n  //   return statusData;\r\n  // }\r\n  // getStatusChanges() {\r\n  //   if (!CONFIG.debug.logging) { return {} }\r\n  //   const statusChanges: Record<string, Partial<Record<\"status\"|\"user_status\"|\"held_status\"|\"base_status\",string|undefined>>|null> = {};\r\n  //   this.rollMods.forEach((mod) => {\r\n  //     const changeData = compareRollModStatus(mod, this._lastStatusData[mod.id]);\r\n  //     if (!U.isEmpty(changeData)) {\r\n  //       statusChanges[mod.id] = changeData;\r\n  //     }\r\n  //   });\r\n  //   this.logModStatus();\r\n  //   return statusChanges;\r\n  // }\r\n  override async getData() {\r\n\r\n    const context = super.getData();\r\n\r\n    const rData = this.rData;\r\n\r\n    if (!this.rollSource) {\r\n      throw new Error(\"No roll source configured for roll.\");\r\n    }\r\n\r\n    // Initialize roll mods from all available sources\r\n    const rollModsData: BladesRollCollab.RollModData[] = [\r\n      ...BladesRollCollab.DefaultRollMods,\r\n      ...this.rollSource.rollModsData ?? []\r\n    ];\r\n    // if (this.rollOpposition instanceof BladesActor || this.rollOpposition instanceof BladesItem) {\r\n    if (this.rollOpposition?.rollModsData) {\r\n      rollModsData.push(...this.rollOpposition.rollModsData);\r\n    }\r\n    // }\r\n\r\n    this.initRollMods(rollModsData);\r\n\r\n    const initReport: Record<string, Record<string, Partial<Record<\"mod\"|\"status\"|\"user_status\"|\"held_status\"|\"base_status\",string|undefined|BladesRollMod>>|null>> = {};\r\n\r\n    // initReport[\"[PASS 1] 0. EFFECT KEYS PASS\"] = this.getStatusSummary();\r\n\r\n    this.rollMods.forEach((rollMod) => rollMod.applyRollModEffectKeys());\r\n    // initReport[\"[PASS 1] 1. Effect Keys Pass\"] = this.getStatusChanges();\r\n\r\n    eLog.checkLog2(\"rollMods\", \"*** getData() PASS ***\", initReport);\r\n\r\n    const isGM = game.eunoblades.Tracker!.system.is_spoofing_player ? false : game.user.isGM;\r\n    const {rollSource, rollOpposition, rollTraitData, rollTraitOptions, finalPosition, finalEffect, finalResult, rollMods, posEffectTrade, rollFactors} = this;\r\n\r\n    const rollCosts = this.getActiveRollMods()\r\n      .map((rollMod) => rollMod.costs)\r\n      .flat()\r\n      .filter((costData): costData is BladesRollCollab.CostData => costData !== undefined);\r\n    const stressCosts = rollCosts.filter((costData) => costData.costType === \"Stress\");\r\n    const specArmorCost = rollCosts.find((costData) => costData.costType === \"SpecialArmor\");\r\n    const totalStressCost = U.sum(stressCosts.map((costData) => costData.costAmount));\r\n\r\n    const sheetData: BladesRollCollab.SheetData = {\r\n      ...rData,\r\n      cssClass: \"roll-collab\",\r\n      editable: this.options.editable,\r\n      isGM,\r\n      system: this.rollSource.rollSourceDoc?.system,\r\n\r\n      rollMods,\r\n      rollSource,\r\n      rollTraitData,\r\n      rollTraitOptions,\r\n\r\n      diceTotal: this.finalDicePool,\r\n\r\n      rollOpposition,\r\n\r\n      rollPositions: Object.values(Position),\r\n      rollEffects: Object.values(Effect),\r\n      teamworkDocs: game.actors.filter((actor) => BladesActor.IsType(actor, BladesActorType.pc)),\r\n\r\n      rollPositionFinal: finalPosition,\r\n      rollEffectFinal: finalEffect,\r\n      rollResultFinal: finalResult,\r\n      isAffectingResult: finalResult > 0\r\n        || this.getVisibleRollMods(RollModCategory.result).length > 0\r\n        || (isGM && this.getRollMods(RollModCategory.result).length > 0),\r\n      isAffectingAfter: this.getVisibleRollMods(RollModCategory.after).length > 0\r\n        || (isGM && this.getRollMods(RollModCategory.after).length > 0),\r\n\r\n      rollFactorPenaltiesNegated: this.rollFactorPenaltiesNegated,\r\n\r\n      GMBoosts: {\r\n        Dice: this.rData.GMBoosts.Dice ?? 0,\r\n        [Factor.tier]: this.rData.GMBoosts[Factor.tier] ?? 0,\r\n        [Factor.quality]: this.rData.GMBoosts[Factor.quality] ?? 0,\r\n        [Factor.scale]: this.rData.GMBoosts[Factor.scale] ?? 0,\r\n        [Factor.magnitude]: this.rData.GMBoosts[Factor.magnitude] ?? 0,\r\n        Result: this.rData.GMBoosts.Result ?? 0\r\n      },\r\n      GMOppBoosts: {\r\n        [Factor.tier]: this.rData.GMOppBoosts[Factor.tier] ?? 0,\r\n        [Factor.quality]: this.rData.GMOppBoosts[Factor.quality] ?? 0,\r\n        [Factor.scale]: this.rData.GMOppBoosts[Factor.scale] ?? 0,\r\n        [Factor.magnitude]: this.rData.GMOppBoosts[Factor.magnitude] ?? 0\r\n      },\r\n\r\n      canTradePosition: posEffectTrade === \"position\"\r\n        || (\r\n          posEffectTrade === false\r\n          && finalPosition !== Position.desperate\r\n          && finalEffect !== Effect.extreme\r\n        ),\r\n      canTradeEffect: posEffectTrade === \"effect\"\r\n        || (\r\n          posEffectTrade === false\r\n          && finalPosition !== Position.controlled\r\n          && finalEffect !== Effect.zero\r\n        ),\r\n\r\n      posRollMods: Object.fromEntries(Object.values(RollModCategory)\r\n        .map((cat) => [cat, this.getRollMods(cat, \"positive\")])) as Record<RollModCategory, BladesRollMod[]>,\r\n      negRollMods: Object.fromEntries(Object.values(RollModCategory)\r\n        .map((cat) => [cat, this.getRollMods(cat, \"negative\")])) as Record<RollModCategory, BladesRollMod[]>,\r\n      hasInactiveConditionals: {\r\n        [RollModCategory.roll]: this.getRollMods(RollModCategory.roll)\r\n          .filter((mod) => mod.isInInactiveBlock)\r\n          .length > 0,\r\n        [RollModCategory.position]: this.getRollMods(RollModCategory.position)\r\n          .filter((mod) => mod.isInInactiveBlock)\r\n          .length > 0,\r\n        [RollModCategory.effect]: this.getRollMods(RollModCategory.effect)\r\n          .filter((mod) => mod.isInInactiveBlock)\r\n          .length > 0,\r\n        [RollModCategory.result]: this.getRollMods(RollModCategory.result)\r\n          .filter((mod) => mod.isInInactiveBlock)\r\n          .length > 0,\r\n        [RollModCategory.after]: this.getRollMods(RollModCategory.after)\r\n          .filter((mod) => mod.isInInactiveBlock)\r\n          .length > 0\r\n      },\r\n\r\n      rollFactors,\r\n\r\n      oddsGradient: \"\"\r\n    };\r\n\r\n    // Determine final costs for tooltip and footer label\r\n    if (specArmorCost || totalStressCost) {\r\n      sheetData.costData = {\r\n        footerLabel: [\r\n          \"( Roll Costs\",\r\n          totalStressCost > 0\r\n            ? `<span class='red-bright'><strong>${totalStressCost} Stress</strong></span>`\r\n            : null,\r\n          specArmorCost && totalStressCost\r\n            ? \"and\"\r\n            : null,\r\n          specArmorCost\r\n            ? \"your <span class='cyan-bright'><strong>Special Armor</strong></span>\"\r\n            : null,\r\n          \")\"\r\n        ]\r\n          .filter((line) => Boolean(line))\r\n          .join(\" \"),\r\n        tooltip: [\r\n          \"<h1>Roll Costs</h1><ul>\",\r\n          ...stressCosts.map((costData) => `<li><strong class='shadowed'>${costData.label}: <span class='red-bright'>${costData.costAmount}</span> Stress</strong></li>`),\r\n          specArmorCost\r\n            ? `<li><strong class='shadowed'>${specArmorCost.label}: <strong class='cyan-bright'>Special Armor</strong></strong></li>`\r\n            : null,\r\n          \"</ul>\"\r\n        ]\r\n          .filter((line) => Boolean(line))\r\n          .join(\"\")\r\n      };\r\n    }\r\n\r\n    // Determine style string for odds bar\r\n    const oddsColors = {\r\n      crit: \"var(--blades-cyan)\",\r\n      success: \"var(--blades-gold)\",\r\n      partial: \"var(--blades-grey-bright)\",\r\n      fail: \"var(--blades-black-dark)\"\r\n    };\r\n    const odds = {...C.DiceOdds[sheetData.diceTotal ?? 0]};\r\n\r\n    // // Split each odds location by 10% to either side\r\n    // const failStops = [\r\n    //   \"var(--blades-black-dark)\",\r\n    //   odds.fail - 10,\r\n    //   Math.min(odds.fail + odds.partial - 1, odds.fail + 10)\r\n    // ] as const;\r\n    // const partialStops = [\r\n    //   \"var(--blades-grey)\",\r\n    //   Math.max(failStops[1] + 1, odds.fail + odds.partial - 10),\r\n    //   Math.min(odds.fail + odds.partial + odds.success - 1, odds.fail + odds.partial + 10)\r\n    // ] as const;\r\n    // const successStops = [\r\n    //   \"var(--blades-gold-bright)\",\r\n    //   Math.max(partialStops[1] + 1, odds.fail + odds.partial + odds.success - 10),\r\n    //   Math.min(odds.fail + odds.partial + odds.success + 10, 100)\r\n    // ] as const;\r\n    // const critStops = [\r\n    //   \"var(--blades-cyan-bright)\"\r\n\r\n    // ] as const;\r\n\r\n\r\n    // Apply changes to odds from result level\r\n    if ((sheetData.rollResultFinal ?? 0) < 0) {\r\n      for (let i = sheetData.rollResultFinal ?? 0; i < 0; i++) {\r\n        // For each negative shift, bump all the colors down one level.\r\n        oddsColors.crit = oddsColors.success;\r\n        oddsColors.success = oddsColors.partial;\r\n        oddsColors.partial = oddsColors.fail;\r\n      }\r\n    } else if ((sheetData.rollResultFinal ?? 0) > 0) {\r\n      for (let i = 0; i < (sheetData.rollResultFinal ?? 0); i++) {\r\n        // For each positive shift, bump all the colors up one level.\r\n        oddsColors.fail = oddsColors.partial;\r\n        oddsColors.partial = oddsColors.success;\r\n        oddsColors.success = oddsColors.crit;\r\n      }\r\n    }\r\n\r\n    const gradientStops = {\r\n      fail: odds.fail,\r\n      partial: odds.fail + odds.partial,\r\n      success: odds.fail + odds.partial + odds.success\r\n    };\r\n\r\n    // Apply tuning for visuals\r\n    gradientStops.fail = Math.min(100, Math.max(0, Math.max(gradientStops.fail / 2, gradientStops.fail - 10)));\r\n    const critSpan = 100 - gradientStops.success;\r\n    gradientStops.success = Math.min(100, Math.max(0, gradientStops.success - Math.max(critSpan / 2, critSpan - 10)));\r\n\r\n    sheetData.oddsGradient = [\r\n      \"linear-gradient(to right\",\r\n      `${oddsColors.fail} ${gradientStops.fail}%`,\r\n      `${oddsColors.partial} ${gradientStops.partial}%`,\r\n      `${oddsColors.success} ${gradientStops.success}%`,\r\n      `${oddsColors.crit})`\r\n    ].join(\", \");\r\n\r\n    sheetData.oddsGradientTestHTML = [\r\n      \"<div class='odds-gradient-test-html'>\",\r\n      `<div class='odds-gradient-box odds-gradient-fail' style='width: ${odds.fail}%;'></div>`,\r\n      `<div class='odds-gradient-box odds-gradient-partial' style='width: ${odds.partial}%;'></div>`,\r\n      `<div class='odds-gradient-box odds-gradient-success' style='width: ${odds.success}%;'></div>`,\r\n      `<div class='odds-gradient-box odds-gradient-crit' style='width: ${odds.crit}%;'></div>`,\r\n      \"</div>\"\r\n    ].join(\"\");\r\n\r\n    eLog.checkLog2(\"rollCollab\", \"ROLL COLLAB GETDATA\", {context, sheetData, user: this.document, userFlags: this.document.getFlag(C.SYSTEM_ID, \"rollCollab\"), rollMods: this.rollMods});\r\n\r\n    return {\r\n      ...context,\r\n      ...sheetData\r\n    };\r\n  }\r\n  // #endregion\r\n\r\n  // #region *** EVALUATING & DISPLAYING ROLL TO CHAT *** ~\r\n  _dieVals?: number[];\r\n  get dieVals(): number[] {\r\n    return (this._dieVals ??= (this.roll.terms as DiceTerm[])[0].results\r\n      .map((result) => result.result)\r\n      .sort()\r\n      .reverse());\r\n  }\r\n\r\n  get dieValsHTML(): string {\r\n    const dieVals = [...this.dieVals];\r\n    const ghostNum = this.isRollingZero ? dieVals.shift() : null;\r\n\r\n    if (this.rollType === RollType.Resistance) {\r\n      return [\r\n        ...dieVals.map((val, i) => `<span class='blades-die ${i === 0 ? \"blades-die-resistance\" : \"blades-die-fail\"} blades-die-${val}'><img src='systems/eunos-blades/assets/dice/faces/${val}.webp' /></span>`),\r\n        ghostNum ? `<span class='blades-die blades-die-ghost blades-die-${ghostNum}'><img src='systems/eunos-blades/assets/dice/faces/${ghostNum}.webp' /></span>` : null\r\n      ]\r\n        .filter((val): val is string => typeof val === \"string\")\r\n        .join(\"\");\r\n    } else {\r\n      return [\r\n        ...dieVals.map((val, i) => {\r\n          if (val === 6 && i <= 1 && this.rollResult === RollResult.critical) {\r\n            return `<span class='blades-die blades-die-critical blades-die-${val}'><img src='systems/eunos-blades/assets/dice/faces/${val}.webp' /></span>`;\r\n          } else if (val === 6) {\r\n            return `<span class='blades-die blades-die-success blades-die-${val}'><img src='systems/eunos-blades/assets/dice/faces/${val}.webp' /></span>`;\r\n          } else if ([4, 5].includes(val)) {\r\n            return `<span class='blades-die blades-die-partial blades-die-${val}'><img src='systems/eunos-blades/assets/dice/faces/${val}.webp' /></span>`;\r\n          } else {\r\n            return `<span class='blades-die blades-die-fail blades-die-${val}'><img src='systems/eunos-blades/assets/dice/faces/${val}.webp' /></span>`;\r\n          }\r\n        }),\r\n        ghostNum ? `<span class='blades-die blades-die-ghost blades-die-${ghostNum}'><img src='systems/eunos-blades/assets/dice/faces/${ghostNum}.webp' /></span>` : null\r\n      ]\r\n        .filter((val): val is string => typeof val === \"string\")\r\n        .join(\"\");\r\n    }\r\n  }\r\n\r\n  get rollResult(): RollResult {\r\n\r\n    // If rollingZero, remove highest die.\r\n    const dieVals = this.isRollingZero\r\n      ? [[...this.dieVals].pop()]\r\n      : this.dieVals;\r\n\r\n    // Is this a critical success?\r\n    if (dieVals.filter((val) => val === 6).length >= 2) { return RollResult.critical }\r\n\r\n    // A full success?\r\n    if (dieVals.find((val) => val === 6)) { return RollResult.success }\r\n\r\n    // A partial?\r\n    if (dieVals.find((val) => val && val >= 4)) { return RollResult.partial }\r\n\r\n    return RollResult.fail;\r\n\r\n  }\r\n\r\n  async outputRollToChat() {\r\n    const speaker = ChatMessage.getSpeaker();\r\n\r\n    let renderedHTML;\r\n\r\n    switch (this.rollType) {\r\n      case RollType.Action: {\r\n        renderedHTML = await renderTemplate(\"systems/eunos-blades/templates/chat/action-roll.hbs\", {\r\n          sourceName: this.rollSource?.rollSourceName ?? \"\",\r\n          oppName: this.rollOpposition?.rollOppName,\r\n          type: U.lCase(this.rollType),\r\n          subType: U.lCase(this.rollSubType),\r\n          downtimeAction: U.lCase(this.rollDowntimeAction),\r\n          position: this.finalPosition,\r\n          effect: this.finalEffect,\r\n          result: this.rollResult,\r\n          trait_label: typeof this.rollTrait === \"number\" ? `${this.rollTrait} Dice` : U.tCase(this.rollTrait),\r\n          dieVals: this.dieValsHTML\r\n        });\r\n        break;\r\n      }\r\n      case RollType.Resistance: {\r\n        renderedHTML = await renderTemplate(\"systems/eunos-blades/templates/chat/resistance-roll.hbs\", {\r\n          dieVals: this.dieValsHTML,\r\n          result: this.rollResult,\r\n          trait_label: typeof this.rollTrait === \"number\" ? `${this.rollTrait} Dice` : U.tCase(this.rollTrait),\r\n          stress: this.resistanceStressCost\r\n        });\r\n\r\n        break;\r\n      }\r\n      case RollType.Downtime: {\r\n\r\n\r\n        break;\r\n      }\r\n      case RollType.Fortune: {\r\n\r\n        break;\r\n      }\r\n      // no default\r\n    }\r\n\r\n    const messageData = {\r\n      speaker: speaker,\r\n      content: renderedHTML,\r\n      type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n      roll: this.roll\r\n    };\r\n\r\n    CONFIG.ChatMessage.documentClass.create(messageData, {});\r\n  }\r\n  async makeRoll() {\r\n    await this.roll.evaluate({async: true});\r\n    await this.outputRollToChat();\r\n    this.close();\r\n  }\r\n  // #endregion\r\n\r\n  // #region LISTENER FUNCTIONS ~\r\n  async _toggleRollModClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const elem$ = $(event.currentTarget);\r\n    const id = elem$.data(\"id\");\r\n    const rollMod = this.getRollModByID(id);\r\n    if (!rollMod) { throw new Error(`Unable to find roll mod with id '${id}'`) }\r\n\r\n    switch (rollMod.status) {\r\n      case RollModStatus.Hidden: rollMod.user_status = RollModStatus.ForcedOff; return;\r\n      case RollModStatus.ForcedOff: rollMod.user_status = RollModStatus.ToggledOff; return;\r\n      case RollModStatus.ToggledOff: rollMod.user_status = RollModStatus.ToggledOn; return;\r\n      case RollModStatus.ToggledOn: rollMod.user_status = game.user.isGM ? RollModStatus.ForcedOn : RollModStatus.ToggledOff; return;\r\n      case RollModStatus.ForcedOn: rollMod.user_status = RollModStatus.Hidden; return;\r\n      // no default\r\n    }\r\n  }\r\n\r\n  async _toggleRollModContext(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const id = elem$.data(\"id\");\r\n    const rollMod = this.getRollModByID(id);\r\n    if (!rollMod) { throw new Error(`Unable to find roll mod with id '${id}'`) }\r\n\r\n    switch (rollMod.status) {\r\n      case RollModStatus.Hidden: rollMod.user_status = RollModStatus.ToggledOff; return;\r\n      case RollModStatus.ForcedOff: rollMod.user_status = RollModStatus.Hidden; return;\r\n      case RollModStatus.ToggledOff: rollMod.user_status = RollModStatus.ForcedOff; return;\r\n      case RollModStatus.ToggledOn: rollMod.user_status = RollModStatus.ToggledOff; return;\r\n      case RollModStatus.ForcedOn: rollMod.user_status = RollModStatus.Hidden; return;\r\n      // no default\r\n    }\r\n  }\r\n\r\n  async _gmControlSet(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const id = elem$.data(\"id\");\r\n    const status = elem$.data(\"status\");\r\n\r\n    this.getRollModByID(id)!.user_status = status as RollModStatus;\r\n  }\r\n\r\n  async _gmControlSetTargetToValue(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const target = elem$.data(\"target\").replace(/flags\\.eunos-blades\\./, \"\");\r\n    const value = elem$.data(\"value\");\r\n\r\n    this.document.setFlag(C.SYSTEM_ID, target, value);\r\n  }\r\n\r\n  async _gmControlResetTarget(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const target = elem$.data(\"target\").replace(/flags\\.eunos-blades\\./, \"\");\r\n\r\n    this.document.unsetFlag(C.SYSTEM_ID, target);\r\n  }\r\n\r\n  async _gmControlReset(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const id = elem$.data(\"id\");\r\n\r\n    this.getRollModByID(id)!.user_status = undefined;\r\n  }\r\n\r\n  async _gmControlSetPosition(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const position = elem$.data(\"status\") as Position;\r\n    this.initialPosition = position;\r\n  }\r\n\r\n  async _gmControlSetEffect(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const effect = elem$.data(\"status\") as Effect;\r\n    this.initialEffect = effect;\r\n  }\r\n\r\n  async _gmControlToggleFactor(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const target = elem$.data(\"target\");\r\n    const value = !elem$.data(\"value\");\r\n\r\n    eLog.checkLog3(\"toggleFactor\", \"_gmControlToggleFactor\", {event, target, value});\r\n\r\n    if (value && /isPrimary/.test(target)) {\r\n      const [_, thisSource, thisFactor] = target.match(/([^.]+)\\.([^.]+)\\.isPrimary/) as [unknown, \"source\" | \"opposition\", Factor];\r\n      eLog.checkLog3(\"toggleFactor\", \"_gmControlToggleFactor - IN\", {thisSource, thisFactor});\r\n      await Promise.all(Object.values(Factor).map((factor) => {\r\n        if (factor === thisFactor) {\r\n          eLog.checkLog3(\"toggleFactor\", `_gmControlToggleFactor - Checking ${factor} === ${thisFactor} === TRUE`, {factor, thisFactor, target, customTarget: `rollCollab.rollFactorToggles.${thisSource}.${factor}.isPrimary`});\r\n          return this.document.setFlag(C.SYSTEM_ID, `rollCollab.rollFactorToggles.${thisSource}.${factor}.isPrimary`, true);\r\n        } else {\r\n          eLog.checkLog3(\"toggleFactor\", `_gmControlToggleFactor - Checking ${factor} === ${thisFactor} === FALSE`, {factor, thisFactor, target, customTarget: `rollCollab.rollFactorToggles.${thisSource}.${factor}.isPrimary`});\r\n          return this.document.setFlag(C.SYSTEM_ID, `rollCollab.rollFactorToggles.${thisSource}.${factor}.isPrimary`, false);\r\n        }\r\n      }));\r\n      eLog.checkLog3(\"toggleFactor\", \"_gmControlToggleFactor - ALL DONE\", {flags: this.document.getFlag(C.SYSTEM_ID, \"rollCollab.rollFactorToggles\")});\r\n    } else {\r\n      this.document.setFlag(C.SYSTEM_ID, `rollCollab.${target}`, value);\r\n    }\r\n  }\r\n\r\n  async _gmControlResetFactor(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!game.user.isGM) { return }\r\n    const elem$ = $(event.currentTarget);\r\n    const target = elem$.data(\"target\");\r\n    this.document.unsetFlag(C.SYSTEM_ID, `rollCollab.${target}`);\r\n  }\r\n\r\n  get resistanceStressCost(): number {\r\n    const dieVals = this.dieVals;\r\n    if (this.rollResult === RollResult.critical) { return -1 }\r\n    if (this.isRollingZero) { dieVals.shift() }\r\n    return 6 - dieVals.shift()!;\r\n  }\r\n\r\n  // #endregion\r\n  // #region ACTIVATE LISTENERS ~\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n    ApplyTooltipListeners(html);\r\n\r\n    // User-Toggleable Roll Mods\r\n    html.find(\".roll-mod[data-action='toggle']\").on({\r\n      click: this._toggleRollModClick.bind(this)\r\n    });\r\n\r\n    html.find(\"[data-action='tradePosition']\").on({\r\n      click: (event) => {\r\n        const curVal = `${$(event.currentTarget).data(\"value\")}`;\r\n        if (curVal === \"false\") {\r\n          this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollPosEffectTrade\", \"effect\");\r\n        } else {\r\n          this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollPosEffectTrade\", false);\r\n        }\r\n      }\r\n    });\r\n    html.find(\"[data-action='tradeEffect']\").on({\r\n      click: (event) => {\r\n        const curVal = `${$(event.currentTarget).data(\"value\")}`;\r\n        if (curVal === \"false\") {\r\n          this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollPosEffectTrade\", \"position\");\r\n        } else {\r\n          this.document.setFlag(C.SYSTEM_ID, \"rollCollab.rollPosEffectTrade\", false);\r\n        }\r\n      }\r\n    });\r\n\r\n    html.find(\"[data-action='roll']\").on({\r\n      click: () => this.makeRoll()\r\n    });\r\n\r\n    if (!game.user.isGM) { return }\r\n\r\n    // GM Controls\r\n    html.on({\r\n      focusin: () => { BladesRollCollab.Active = this } // Set reference to top-most, focused roll.\r\n    });\r\n    html.find(\"[data-action='gm-set'\").on({\r\n      click: this._gmControlSet.bind(this)\r\n    });\r\n    html.find(\"[data-action='gm-reset'\").on({\r\n      click: this._gmControlReset.bind(this)\r\n    });\r\n    html.find(\"[data-action='gm-set-position'\").on({\r\n      click: this._gmControlSetPosition.bind(this)\r\n    });\r\n    html.find(\"[data-action='gm-set-effect'\").on({\r\n      click: this._gmControlSetEffect.bind(this)\r\n    });\r\n    html.find(\"[data-action='gm-set-target'\").on({\r\n      click: this._gmControlSetTargetToValue.bind(this),\r\n      contextmenu: this._gmControlResetTarget.bind(this)\r\n    });\r\n    html.find(\"[data-action='gm-toggle-factor'\").on({\r\n      click: this._gmControlToggleFactor.bind(this),\r\n      contextmenu: this._gmControlResetFactor.bind(this)\r\n    });\r\n    html.find(\".controls-toggle\").on({\r\n      click: (event) => {\r\n        event.preventDefault();\r\n        $(event.currentTarget).parents(\".controls-panel\").toggleClass(\"active\");\r\n      }\r\n    });\r\n\r\n  }\r\n  // #endregion\r\n\r\n  // #region OVERRIDES: _canDragDrop, _onDrop, _onSubmit, close, render ~\r\n  override _canDragDrop(selector: string) {\r\n    eLog.checkLog3(\"canDragDrop\", \"Can DragDrop Selector\", {selector});\r\n    return game.user.isGM;\r\n  }\r\n\r\n  override _onDrop(event: DragEvent) {\r\n    const data = TextEditor.getDragEventData(event) as { type: \"Actor\" | \"Item\", uuid: string };\r\n    const {type, uuid} = data;\r\n    const [id] = (uuid.match(new RegExp(`${type}\\\\.(.+)`)) ?? []).slice(1);\r\n    const oppDoc = game[`${U.lCase(type)}s`].get(id);\r\n    if (oppDoc) {\r\n      this.rollOpposition = oppDoc;\r\n    }\r\n    // super._onDrop(...args);\r\n    // eLog.checkLog3(\"dropEvent\", \"Drop Event\", {event, data, oppDoc});\r\n  }\r\n\r\n  override async _onSubmit(event: Event, {updateData}: FormApplication.OnSubmitOptions = {}) {\r\n    return super._onSubmit(event, {updateData, preventClose: true})\r\n      .then((returnVal) => { this.render(); return returnVal });\r\n  }\r\n\r\n  override async close(options: FormApplication.CloseOptions & { rollID?: string } = {}) {\r\n    // eLog.checkLog3(\"rollCollab\", \"RollCollab.close()\", {options});\r\n    if (options.rollID) { return super.close({}) }\r\n    this.document.setFlag(C.SYSTEM_ID, \"rollCollab\", null);\r\n    socketlib.system.executeForEveryone(\"closeRollCollab\", this.rollID);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  override render(force?: boolean, options?: Application.RenderOptions<DocumentSheetOptions>) {\r\n    if (!this.document.getFlag(C.SYSTEM_ID, \"rollCollab\")) { return this }\r\n    return super.render(force, options);\r\n  }\r\n  // #endregion\r\n\r\n}\r\n\r\ninterface BladesRollCollab {\r\n  get document(): User\r\n}\r\n// #endregion\r\n\r\nexport default BladesRollCollab;"]}