{"version":3,"sources":["../../ts/blades-dialog.ts"],"names":[],"mappings":"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","file":"blades-dialog.js","sourcesContent":["import G, {ApplyTooltipListeners} from \"./core/gsap.js\";\r\nimport U from \"./core/utilities.js\";\r\nimport BladesActor from \"./blades-actor.js\";\r\nimport BladesItem from \"./blades-item.js\";\r\n\r\nexport enum SelectionCategory {\r\n  Heritage = \"Heritage\",\r\n  Background = \"Background\",\r\n  Vice = \"Vice\",\r\n  Playbook = \"Playbook\",\r\n  Reputation = \"Reputation\",\r\n  Preferred_Op = \"Preferred_Op\",\r\n  Gear = \"Gear\",\r\n  Ability = \"Ability\",\r\n  Faction = \"Faction\",\r\n  Upgrade = \"Upgrade\",\r\n  Cohort_Gang = \"Cohort_Gang\",\r\n  Cohort_Expert = \"Cohort_Expert\",\r\n  Feature = \"Feature\",\r\n  Stricture = \"Stricture\",\r\n  VicePurveyor = \"VicePurveyor\",\r\n  Acquaintance = \"Acquaintance\",\r\n  Friend = \"Friend\",\r\n  Rival = \"Rival\",\r\n  Crew = \"Crew\",\r\n  Member = \"Member\",\r\n  Contact = \"Contact\"\r\n}\r\n\r\nclass BladesSelectorDialog extends Dialog {\r\n\r\n  static override get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"eunos-blades\", \"sheet\", \"dialog\"],\r\n      template: \"systems/eunos-blades/templates/dialog.hbs\",\r\n      width: \"auto\",\r\n      height: \"auto\",\r\n      tabs: [{navSelector: \".nav-tabs\", contentSelector: \".tab-content\", initial: \"front\"}]\r\n    });\r\n  }\r\n\r\n  static Initialize() {\r\n    return loadTemplates([\r\n      \"systems/eunos-blades/templates/dialog.hbs\"\r\n    ]);\r\n  }\r\n\r\n  static async Display(\r\n    parent: BladesActor,\r\n    title: string,\r\n    docType: \"Actor\"|\"Item\",\r\n    tabs: Record<string, BladesActor[]|BladesItem[]>,\r\n    tags?: string[]\r\n  ) {\r\n    // eLog.checkLog(\"BladesSelectorDialog.Display()\", {parent, title, tabs});\r\n    const app = new BladesSelectorDialog({\r\n      parent,\r\n      title,\r\n      docType,\r\n      tabs,\r\n      \"tags\": tags?.filter((tag): tag is BladesTag => tag !== \"\"),\r\n      \"content\": \"\",\r\n      \"buttons\": {\r\n        cancel: {\r\n          icon: '<i class=\"fas fa-times\"></i>',\r\n          label: game.i18n.localize(\"Cancel\"),\r\n          callback: () => false\r\n        }\r\n      },\r\n      \"default\": \"cancel\"\r\n    });\r\n\r\n    return app.hasItems ? app.render(true, {width: app.width}) : undefined;\r\n  }\r\n\r\n  get hasItems() {\r\n    return Object.values(this.tabs).some((tabItems) => tabItems.length > 0);\r\n  }\r\n  parent: BladesActor;\r\n  tabs: Record<string, BladesActor[]|BladesItem[]>;\r\n  tags: BladesTag[] = [];\r\n  width: number;\r\n  docType: \"Actor\"|\"Item\";\r\n\r\n  constructor(data: BladesDialog.Data, options?: Partial<BladesDialog.Options>) {\r\n    super(data, options);\r\n\r\n    const validTabs: string[] = [];\r\n    for (const [tabName, tabItems] of Object.entries(data.tabs)) {\r\n      if (tabItems.length === 0) {\r\n        delete data.tabs[tabName];\r\n      } else {\r\n        validTabs.push(tabName);\r\n      }\r\n    }\r\n\r\n    if (validTabs.length === 1 && !(\"Main\" in data.tabs)) {\r\n      data.tabs.Main = [...data.tabs[validTabs[0]]] as BladesActor[]|BladesItem[];\r\n      delete data.tabs[validTabs[0]];\r\n    }\r\n\r\n    this.docType = data.docType;\r\n    this.parent = data.parent;\r\n    this.tabs = data.tabs;\r\n    this.tags = data.tags ?? [];\r\n    this.width = 150 * Math.ceil(Math.sqrt(Object.values(data.tabs)[0].length));\r\n  }\r\n\r\n  override getData() {\r\n    const data = super.getData() as BladesDialog.Data;\r\n    // eLog.checkLog4(\"dialog\", \"[BladesDialog] super.getData()\", {...data});\r\n    data.title = this.title;\r\n    data.tabs = this.tabs;\r\n    data.docType = this.docType;\r\n    data.tags = this.tags;\r\n\r\n    // eLog.checkLog(\"dialog\", \"[BladesDialog] return getData()\", {...data});\r\n    return data;\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    const self = this;\r\n\r\n    //~ Changing Width on Tab Change Depending on Number of Items\r\n    html.find(\".nav-tabs .tab-selector\").on(\"click\", (event) => {\r\n      const tabIndex = U.pInt($(event.currentTarget).data(\"tab\"));\r\n      const numItems = Object.values(self.tabs)[tabIndex].length;\r\n      const width = U.pInt(150 * Math.ceil(Math.sqrt(numItems)));\r\n      eLog.checkLog3(\"nav\", \"Nav Tab Size Recalculation\", {tabIndex, numItems, width});\r\n      this.render(false, {width});\r\n    });\r\n\r\n    //~ Tooltips\r\n    ApplyTooltipListeners(html);\r\n\r\n    //~ Item Control\r\n    html.find(\"[data-item-id]\").on(\"click\", function() {\r\n      if ($(this).parent().hasClass(\"locked\")) { return }\r\n      const docId = $(this).data(\"itemId\");\r\n      const docType = $(this).data(\"docType\");\r\n      eLog.checkLog(\"dialog\", \"[BladesDialog] on Click\", {elem: this, docId, docType, parent: self.parent});\r\n      if (docType === \"Actor\") {\r\n        self.parent.addSubActor(docId, self.tags);\r\n      } else if (docType === \"Item\") {\r\n        self.parent.addSubItem(docId);\r\n      }\r\n      self.close();\r\n    });\r\n  }\r\n}\r\n\r\nexport default BladesSelectorDialog;"]}