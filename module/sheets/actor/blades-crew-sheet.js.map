{"version":3,"sources":["../../ts/sheets/actor/blades-crew-sheet.ts"],"names":[],"mappings":"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","file":"blades-crew-sheet.js","sourcesContent":["import U from \"../../core/utilities.js\";\r\nimport BladesSheet from \"./blades-sheet.js\";\r\nimport BladesActor from \"../../blades-actor.js\";\r\nimport BladesPC from \"../../documents/actors/blades-pc.js\";\r\nimport {BladesCrew} from \"../../documents/blades-actor-proxy.js\";\r\nimport BladesNPC from \"../../documents/actors/blades-npc.js\";\r\nimport BladesFaction from \"../../documents/actors/blades-faction.js\";\r\n// import BladesCrew from \"../../documents/actors/blades-crew.js\";\r\nimport BladesItem from \"../../blades-item.js\";\r\nimport {BladesActorType, BladesItemType} from \"../../core/constants.js\";\r\n\r\nclass BladesCrewSheet extends BladesSheet {\r\n\r\n  declare actor: BladesActorOfType<BladesActorType.crew>;\r\n\r\n  static override get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"eunos-blades\", \"sheet\", \"actor\", \"crew\"],\r\n      template: \"systems/eunos-blades/templates/crew-sheet.hbs\",\r\n      width: 940,\r\n      height: 820,\r\n      tabs: [{navSelector: \".nav-tabs\", contentSelector: \".tab-content\", initial: \"claims\"}]\r\n    });\r\n  }\r\n\r\n  override getData() {\r\n    const context = super.getData();\r\n\r\n    eLog.checkLog(\"actor\", \"[BladesCrewSheet] super.getData()\", {...context});\r\n    const {activeSubItems} = this.actor as BladesCrew;\r\n\r\n    const sheetData: Partial<BladesActorDataOfType<BladesActorType.crew>> = {};\r\n\r\n    //~ Assemble embedded actors and items\r\n    sheetData.preparedItems = Object.assign(\r\n      context.preparedItems ?? {},\r\n      {\r\n        abilities: activeSubItems.filter((item): item is BladesItemOfType<BladesItemType.crew_ability> => item.type === BladesItemType.crew_ability),\r\n        playbook: this.actor.playbook as BladesItemOfType<BladesItemType.crew_playbook>|undefined,\r\n        reputation: activeSubItems.find((item): item is BladesItemOfType<BladesItemType.crew_reputation> => item.type === BladesItemType.crew_reputation),\r\n        upgrades: activeSubItems.filter((item): item is BladesItemOfType<BladesItemType.crew_upgrade> => item.type === BladesItemType.crew_upgrade),\r\n        preferredOp: activeSubItems.find((item): item is BladesItemOfType<BladesItemType.preferred_op> => item.type === BladesItemType.preferred_op)\r\n      }\r\n    ) as BladesActorDataOfType<BladesActorType.crew>[\"preparedItems\"];\r\n\r\n    sheetData.preparedActors = {\r\n      members: this.actor.members,\r\n      contacts: this.actor.contacts\r\n    };\r\n\r\n    sheetData.tierData = {\r\n      label: \"Tier\",\r\n      dotline: {\r\n        data: this.actor.system.tier,\r\n        target: \"system.tier.value\",\r\n        iconEmpty: \"dot-empty.svg\",\r\n        iconEmptyHover: \"dot-empty-hover.svg\",\r\n        iconFull: \"dot-full.svg\",\r\n        iconFullHover: \"dot-full-hover.svg\"\r\n      }\r\n    };\r\n\r\n    sheetData.upgradeData = {\r\n      dotline: {\r\n        dotlineClass: \"dotline-right\",\r\n        data: {\r\n          value: this.actor.availableUpgradePoints,\r\n          max: this.actor.availableUpgradePoints\r\n        },\r\n        dotlineLabel: \"Available Upgrade Points\",\r\n        isLocked: true,\r\n        iconFull: \"dot-full.svg\"\r\n      }\r\n    };\r\n\r\n    sheetData.abilityData = {\r\n      dotline: {\r\n        dotlineClass: \"dotline-right\",\r\n        data: {\r\n          value: this.actor.availableAbilityPoints,\r\n          max: this.actor.availableAbilityPoints\r\n        },\r\n        dotlineLabel: \"Available Ability Points\",\r\n        isLocked: true,\r\n        iconFull: \"dot-full.svg\"\r\n      }\r\n    };\r\n\r\n    sheetData.cohortData = {\r\n      dotline: {\r\n        dotlineClass: \"dotline-right\",\r\n        data: {\r\n          value: this.actor.availableCohortPoints,\r\n          max: this.actor.availableCohortPoints\r\n        },\r\n        dotlineLabel: \"Available Cohort Points\",\r\n        isLocked: true,\r\n        iconFull: \"dot-full.svg\"\r\n      }\r\n    };\r\n\r\n    sheetData.repData = {\r\n      label: \"Rep\",\r\n      dotlines: [\r\n        {\r\n          data: {\r\n            value: Math.min(this.actor.system.rep.value, this.actor.system.rep.max - this.actor.turfCount),\r\n            max: this.actor.system.rep.max - this.actor.turfCount\r\n          },\r\n          target: \"system.rep.value\",\r\n          svgKey: \"teeth.tall\",\r\n          svgFull: \"full|half|frame\",\r\n          svgEmpty: \"full|half|frame\"\r\n        },\r\n        {\r\n          data: {\r\n            value: this.actor.turfCount,\r\n            max: this.actor.turfCount\r\n          },\r\n          target: \"none\",\r\n          svgKey: \"teeth.tall\",\r\n          svgFull: \"full|half|frame\",\r\n          svgEmpty: \"full|half|frame\",\r\n          dotlineClass: \"flex-row-reverse\",\r\n          isLocked: true\r\n        }\r\n      ]\r\n    };\r\n\r\n    sheetData.heatData = {\r\n      label: \"Heat\",\r\n      dotline: {\r\n        data: this.actor.system.heat,\r\n        target: \"system.heat.value\",\r\n        svgKey: \"teeth.tall\",\r\n        svgFull: \"full|half|frame\",\r\n        svgEmpty: \"full|half|frame\"\r\n      }\r\n    };\r\n\r\n    sheetData.wantedData = {\r\n      label: \"Wanted\",\r\n      dotline: {\r\n        data: this.actor.system.wanted,\r\n        target: \"system.wanted.value\",\r\n        svgKey: \"teeth.short\",\r\n        svgFull: \"full|frame\",\r\n        svgEmpty: \"frame\"\r\n      }\r\n    };\r\n\r\n    eLog.checkLog(\"actor\", \"[BladesCrewSheet] return getData()\", {...context, ...sheetData});\r\n    return {...context, ...sheetData} as BladesActorSheetData;\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.options.editable) {return}\r\n\r\n    // Update Inventory Item\r\n    html.find(\".item-sheet-open\").on(\"click\", (event) => {\r\n      const element = $(event.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(element.data(\"itemId\"));\r\n      item?.sheet?.render(true);\r\n    });\r\n\r\n    // Toggle Hold\r\n    html.find(\".hold-toggle\").on(\"click\", () => {\r\n      this.actor.update({\"system.hold\": this.actor.system.hold === \"weak\" ? \"strong\" : \"weak\"});\r\n    });\r\n\r\n\r\n    // Toggle Turf\r\n    html.find(\".turf-select\").on(\"click\", async (event) => {\r\n\r\n      const turf_id = $(event.currentTarget).data(\"turfId\");\r\n      const turf_current_status = $(event.currentTarget).data(\"turfStatus\");\r\n      this.actor.playbook?.update({[\"system.turfs.\" + turf_id + \".value\"]: !turf_current_status})\r\n        .then(() => this.render(false));\r\n    });\r\n  }\r\n}\r\n\r\nexport default BladesCrewSheet;"]}