{"version":3,"sources":["../../ts/sheets/actor/blades-sheet.ts"],"names":[],"mappings":"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","file":"blades-sheet.js","sourcesContent":["// #region IMPORTS~\r\n\r\nimport U from \"../../core/utilities.js\";\r\nimport G, {ApplyTooltipListeners} from \"../../core/gsap.js\";\r\nimport C, {Tag, BladesActorType, BladesItemType, BladesPermissions, RollType, Action, Attribute, Factor} from \"../../core/constants.js\";\r\nimport Tags from \"../../core/tags.js\";\r\nimport BladesActor from \"../../blades-actor.js\";\r\nimport BladesPC from \"../../documents/actors/blades-pc.js\";\r\nimport BladesNPC from \"../../documents/actors/blades-npc.js\";\r\nimport BladesFaction from \"../../documents/actors/blades-faction.js\";\r\nimport BladesCrew from \"../../documents/actors/blades-crew.js\";\r\nimport BladesItem from \"../../blades-item.js\";\r\nimport BladesSelectorDialog, {SelectionCategory} from \"../../blades-dialog.js\";\r\nimport BladesActiveEffect from \"../../blades-active-effect.js\";\r\nimport BladesRollCollab from \"../../blades-roll-collab.js\";\r\n// #endregion\r\n// #region TYPES: BladesCompData ~\r\ntype BladesCompData = {\r\n  elem$: JQuery<HTMLElement>;\r\n  docID?: string;\r\n  docCat?: SelectionCategory;\r\n  docType?: \"Actor\" | \"Item\";\r\n  docTags?: BladesTag[];\r\n  doc?: BladesActor | BladesItem | false;\r\n  dialogDocs?: Record<string, BladesActor[] | BladesItem[]> | false;\r\n};\r\n\r\n\r\n// #endregion\r\n\r\nclass BladesSheet extends ActorSheet {\r\n\r\n  override getData() {\r\n\r\n    const context = super.getData();\r\n\r\n    const sheetData: DeepPartial<BladesActorSheetData\r\n    & BladesActorDataOfType<BladesActorType.pc>\r\n    & BladesActorDataOfType<BladesActorType.crew>\r\n    & BladesActorDataOfType<BladesActorType.npc>\r\n    & BladesActorDataOfType<BladesActorType.faction>\r\n    > = {\r\n      cssClass: this.actor.type,\r\n      editable: this.options.editable,\r\n      isGM: game.eunoblades.Tracker!.system.is_spoofing_player ? false : game.user.isGM,\r\n      actor: this.actor,\r\n      system: this.actor.system,\r\n      tierTotal: this.actor.getFactorTotal(Factor.tier) > 0 ? U.romanizeNum(this.actor.getFactorTotal(Factor.tier)) : \"0\",\r\n      rollData: this.actor.getRollData(),\r\n      activeEffects: Array.from(this.actor.effects) as BladesActiveEffect[],\r\n      hasFullVision: game.user.isGM || this.actor.testUserPermission(game.user, CONST.DOCUMENT_PERMISSION_LEVELS.OBSERVER),\r\n      hasLimitedVision: game.user.isGM || this.actor.testUserPermission(game.user, CONST.DOCUMENT_PERMISSION_LEVELS.LIMITED),\r\n      hasControl: game.user.isGM || this.actor.testUserPermission(game.user, CONST.DOCUMENT_PERMISSION_LEVELS.OWNER),\r\n      preparedItems: {\r\n        cohorts: {\r\n          gang: this.actor.activeSubItems\r\n            .filter((item): item is BladesItemOfType<BladesItemType.cohort_gang> => item.type === BladesItemType.cohort_gang)\r\n            .map((item) => {\r\n              const subtypes = U.unique(Object.values(item.system.subtypes)\r\n                .map((subtype) => subtype.trim())\r\n                .filter((subtype) => /[A-Za-z]/.test(subtype))) as Tag.GangType[];\r\n              const elite_subtypes = U.unique([\r\n                ...Object.values(item.system.elite_subtypes),\r\n                ...(item.parent?.upgrades ?? [])\r\n                  .map((upgrade) => (upgrade.name ?? \"\").trim().replace(/^Elite /, \"\"))\r\n              ]\r\n                .map((subtype) => subtype.trim())\r\n                .filter((subtype) => /[A-Za-z]/.test(subtype) && subtypes.includes(subtype as Tag.GangType))) as Tag.GangType[];\r\n\r\n              const imgTypes = [...elite_subtypes];\r\n              if (imgTypes.length < 2) {\r\n                imgTypes.push(...subtypes.filter((subtype) => !imgTypes.includes(subtype)));\r\n              }\r\n              if (U.unique(imgTypes).length === 1) {\r\n                item.system.image = Object.values(item.system.elite_subtypes).includes(imgTypes[0]) ? `elite-${U.lCase(imgTypes[0])}.svg` : `${U.lCase(imgTypes[0])}.svg`;\r\n              } else if (U.unique(imgTypes).length > 1) {\r\n                const [rightType, leftType] = imgTypes;\r\n                item.system.imageLeft = Object.values(item.system.elite_subtypes).includes(leftType) ? `elite-${U.lCase(leftType)}.svg` : `${U.lCase(leftType)}.svg`;\r\n                item.system.imageRight = Object.values(item.system.elite_subtypes).includes(rightType) ? `elite-${U.lCase(rightType)}.svg` : `${U.lCase(rightType)}.svg`;\r\n              }\r\n\r\n              Object.assign(\r\n                item.system,\r\n                {\r\n                  tierTotal: item.getFactorTotal(Factor.tier) > 0 ? U.romanizeNum(item.getFactorTotal(Factor.tier)) : \"0\",\r\n                  cohortRollData: [\r\n                    {mode: \"untrained\", label: \"Untrained\", color: \"transparent\", tooltip: \"<p>Roll Untrained</p>\"}\r\n                  ],\r\n                  edgeData: Object.fromEntries(Object.values(item.system.edges ?? [])\r\n                    .filter((edge) => /[A-Za-z]/.test(edge))\r\n                    .map((edge) => [edge.trim(), C.EdgeTooltips[edge as KeyOf<typeof C[\"EdgeTooltips\"]>]])),\r\n                  flawData: Object.fromEntries(Object.values(item.system.flaws ?? [])\r\n                    .filter((flaw) => /[A-Za-z]/.test(flaw))\r\n                    .map((flaw) => [flaw.trim(), C.FlawTooltips[flaw as KeyOf<typeof C[\"FlawTooltips\"]>]]))\r\n                }\r\n              );\r\n              return item;\r\n            }),\r\n          expert: this.actor.activeSubItems\r\n            .filter((item): item is BladesItemOfType<BladesItemType.cohort_expert> => item.type === BladesItemType.cohort_expert)\r\n            .map((item) => {\r\n              Object.assign(\r\n                item.system,\r\n                {\r\n                  tierTotal: item.getFactorTotal(Factor.tier) > 0 ? U.romanizeNum(item.getFactorTotal(Factor.tier)) : \"0\",\r\n                  cohortRollData: [\r\n                    {mode: \"untrained\", label: \"Untrained\", tooltip: \"<h2>Roll Untrained</h2>\"}\r\n                  ],\r\n                  edgeData: Object.fromEntries(Object.values(item.system.edges ?? [])\r\n                    .filter((edge) => /[A-Za-z]/.test(edge))\r\n                    .map((edge) => [edge.trim(), C.EdgeTooltips[edge as KeyOf<typeof C[\"EdgeTooltips\"]>]])),\r\n                  flawData: Object.fromEntries(Object.values(item.system.flaws ?? [])\r\n                    .filter((flaw) => /[A-Za-z]/.test(flaw))\r\n                    .map((flaw) => [flaw.trim(), C.FlawTooltips[flaw as KeyOf<typeof C[\"FlawTooltips\"]>]]))\r\n                }\r\n              );\r\n              return item;\r\n            })\r\n        }\r\n      }\r\n    };\r\n\r\n    if (BladesActor.IsType(this.actor, BladesActorType.pc) || BladesActor.IsType(this.actor, BladesActorType.crew)) {\r\n      sheetData.playbookData = {\r\n        dotline: {\r\n          data: this.actor.system.experience.playbook,\r\n          dotlineClass: \"xp-playbook\",\r\n          target: \"system.experience.playbook.value\",\r\n          svgKey: \"teeth.tall\",\r\n          svgFull: \"full|frame\",\r\n          svgEmpty: \"full|half|frame\",\r\n          advanceButton: \"advance-playbook\"\r\n        }\r\n      };\r\n      if (this.actor.system.experience.playbook.value !== this.actor.system.experience.playbook.max) {\r\n        sheetData.playbookData.tooltip = (new Handlebars.SafeString([\r\n          \"<h2>At the End of the Session, Gain XP If ...</h2>\",\r\n          \"<ul>\",\r\n          ... Object.values(this.actor.system.experience.clues ?? []).map((line) => `<li>${line.replace(/^Y/, \"... y\")}</li>`) ?? [],\r\n          \"</ul>\"\r\n        ].join(\"\"))).toString();\r\n      }\r\n\r\n      sheetData.coinsData = {\r\n        dotline: {\r\n          data: this.actor.system.coins,\r\n          target: \"system.coins.value\",\r\n          iconEmpty: \"coin-full.svg\",\r\n          iconFull: \"coin-full.svg\"\r\n        }\r\n      };\r\n    }\r\n\r\n    return {\r\n      ...context,\r\n      ...sheetData\r\n    } as BladesActorSheetData;\r\n\r\n  }\r\n\r\n  // #region LISTENERS & EVENT HANDLERS\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    // Handle removal or revealing of secret information content.\r\n    if (game.user.isGM) {\r\n      html.attr(\"style\", \"--secret-text-display: initial\");\r\n    } else {\r\n      html.find('.editor:not(.tinymce) [data-is-secret=\"true\"]').remove();\r\n    }\r\n\r\n    //~ Tooltips\r\n    ApplyTooltipListeners(html);\r\n\r\n    Tags.InitListeners(html, this.actor);\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.options.editable) { return }\r\n\r\n    // Add dotline functionality\r\n    html.find(\".dotline\").each((_, elem) => {\r\n      if ($(elem).hasClass(\"locked\")) { return }\r\n\r\n      let targetDoc: BladesActor | BladesItem = this.actor as BladesActor;\r\n      let targetField = $(elem).data(\"target\");\r\n\r\n      const comp$ = $(elem).closest(\"comp\");\r\n\r\n      if (targetField.startsWith(\"item\")) {\r\n        targetField = targetField.replace(/^item\\./, \"\");\r\n        const itemId = $(elem).closest(\"[data-comp-id]\").data(\"compId\");\r\n        if (!itemId) {\r\n          return;\r\n        }\r\n        const item = this.actor.items.get(itemId);\r\n        if (!item) {\r\n          return;\r\n        }\r\n        targetDoc = item as BladesItem;\r\n      }\r\n\r\n      const curValue = U.pInt($(elem).data(\"value\"));\r\n      $(elem)\r\n        .find(\".dot\")\r\n        .each((j, dot) => {\r\n          $(dot).on(\"click\", (event: ClickEvent) => {\r\n            event.preventDefault();\r\n            const thisValue = U.pInt($(dot).data(\"value\"));\r\n            if (thisValue !== curValue) {\r\n              if (\r\n                comp$.hasClass(\"comp-coins\")\r\n                || comp$.hasClass(\"comp-stash\")\r\n              ) {\r\n                G.effects\r\n                  .fillCoins($(dot).prevAll(\".dot\"))\r\n                  .then(() => targetDoc.update({[targetField]: thisValue}));\r\n              } else {\r\n                targetDoc.update({[targetField]: thisValue});\r\n              }\r\n            }\r\n          });\r\n          $(dot).on(\"contextmenu\", (event: ContextMenuEvent) => {\r\n            event.preventDefault();\r\n            const thisValue = U.pInt($(dot).data(\"value\")) - 1;\r\n            if (thisValue !== curValue) {\r\n              targetDoc.update({[targetField]: thisValue});\r\n            }\r\n          });\r\n        });\r\n    });\r\n\r\n    // Clock Functionality\r\n    html\r\n      .find(\".clock-container\")\r\n      .on(\"click\", this._onClockLeftClick.bind(this));\r\n    html\r\n      .find(\".clock-container\")\r\n      .on(\"contextmenu\", this._onClockRightClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-add-clock\")\r\n      .on(\"click\", this._onClockAddClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-delete-clock\")\r\n      .on(\"click\", this._onClockDeleteClick.bind(this));\r\n\r\n    // Component Functionality: Open, Add (via SelectorDialog), Archive, Delete, Toggle\r\n    html\r\n      .find(\"[data-comp-id]\")\r\n      .find(\".comp-title\")\r\n      .on(\"click\", this._onItemOpenClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-add\")\r\n      .on(\"click\", this._onItemAddClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-delete\")\r\n      .on(\"click\", this._onItemRemoveClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-delete-full\")\r\n      .on(\"click\", this._onItemFullRemoveClick.bind(this));\r\n    html\r\n      .find(\".comp-control.comp-toggle\")\r\n      .on(\"click\", this._onItemToggleClick.bind(this));\r\n\r\n    html\r\n      .find(\".advance-button\")\r\n      .on(\"click\", this._onAdvanceClick.bind(this));\r\n\r\n    // Roll Functionality\r\n    html\r\n      .find(\"[data-roll-trait]\")\r\n      .on(\"click\", this._onRollTraitClick.bind(this));\r\n\r\n    // Active Effects Functionality\r\n    html\r\n      .find(\".effect-control\")\r\n      .on(\"click\", this._onActiveEffectControlClick.bind(this));\r\n\r\n\r\n    // This is a workaround until is being fixed in FoundryVTT.\r\n    if (this.options.submitOnChange) {\r\n      html.on(\"change\", \"textarea\", this._onChangeInput.bind(this)); // Use delegated listener on the form\r\n    }\r\n  }\r\n\r\n  override async _onSubmit(event: Event, params: List<any> = {}) {\r\n    if (!game.user.isGM && !this.actor.testUserPermission(game.user, CONST.DOCUMENT_PERMISSION_LEVELS.OWNER)) {\r\n      eLog.checkLog(\"actorSheetTrigger\", \"User does not have permission to edit this actor\", {user: game.user, actor: this.actor});\r\n      return {};\r\n    }\r\n    // eLog.checkLog(\"actorSheetTrigger\", \"Submitting Form Data\", {parentActor: this.actor.parentActor, systemTags: this.actor.system.tags, sourceTags: this.actor._source.system.tags, params});\r\n    return super._onSubmit(event, params);\r\n  }\r\n\r\n\r\n  override async close(options?: FormApplication.CloseOptions): Promise<void> {\r\n    if (this.actor.type === BladesActorType.pc) {\r\n      return super.close(options).then(() => this.actor.clearSubActors());\r\n    } else if (this.actor.type === BladesActorType.npc && this.actor.parentActor) {\r\n      return super.close(options).then(() => this.actor.clearParentActor(false));\r\n    }\r\n    return super.close(options);\r\n  }\r\n\r\n  // #region Clock Handlers ~\r\n  async _onClockLeftClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const clock$ = $(event.currentTarget).find(\".clock[data-target]\");\r\n    if (!clock$[0]) {\r\n      return;\r\n    }\r\n    const target = clock$.data(\"target\");\r\n    const curValue = U.pInt(clock$.data(\"value\"));\r\n    const maxValue = U.pInt(clock$.data(\"size\"));\r\n\r\n    G.effects.pulseClockWedges(clock$.find(\"wedges\")).then(() =>\r\n      this.actor.update({\r\n        [target]: G.utils.wrap(0, maxValue + 1, curValue + 1)\r\n      }));\r\n  }\r\n\r\n  async _onClockRightClick(event: ContextMenuEvent) {\r\n    event.preventDefault();\r\n    const clock$ = $(event.currentTarget).find(\".clock[data-target]\");\r\n    if (!clock$[0]) {\r\n      return;\r\n    }\r\n    const target = clock$.data(\"target\");\r\n    const curValue = U.pInt(clock$.data(\"value\"));\r\n\r\n    G.effects.reversePulseClockWedges(clock$.find(\"wedges\")).then(() =>\r\n      this.actor.update({\r\n        [target]: Math.max(0, curValue - 1)\r\n      }));\r\n  }\r\n\r\n  async _onClockAddClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!BladesActor.IsType(this.actor, BladesActorType.faction)) { return }\r\n    const clockID = randomID();\r\n    this.actor.update({[`system.clocks.${clockID}`]: {\r\n      color: \"white\",\r\n      display: \"\",\r\n      gm_notes: \"\",\r\n      isVisible: true,\r\n      isNameVisible: true,\r\n      isActive: true,\r\n      max: 4,\r\n      target: `system.clocks.${clockID}.value`,\r\n      value: 0,\r\n      id: clockID\r\n    }});\r\n  }\r\n\r\n  async _onClockDeleteClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if (!BladesActor.IsType(this.actor, BladesActorType.faction)) { return }\r\n    const clockID = $(event.currentTarget).data(\"clockId\");\r\n    if (!clockID) { return }\r\n    this.actor.update({[`system.clocks.-=${clockID}`]: null});\r\n  }\r\n  // #endregion\r\n\r\n  // #region Component Handlers\r\n  private _getCompData(event: ClickEvent): BladesCompData {\r\n    const elem$ = $(event.currentTarget).closest(\".comp\");\r\n    const compData: BladesCompData = {\r\n      elem$,\r\n      docID: elem$.data(\"compId\"),\r\n      docCat: elem$.data(\"compCat\"),\r\n      docType: elem$.data(\"compType\"),\r\n      docTags: (elem$.data(\"compTags\") ?? \"\").split(/\\s+/g)\r\n    };\r\n    eLog.checkLog2(\"dialog\", \"Component Data\", {elem: elem$, ...compData});\r\n\r\n    if (compData.docID && compData.docType) {\r\n      compData.doc = {\r\n        Actor: this.actor.getSubActor(compData.docID),\r\n        Item: this.actor.getSubItem(compData.docID)\r\n      }[compData.docType];\r\n    }\r\n    if (compData.docCat && compData.docType) {\r\n      compData.dialogDocs = {\r\n        Actor: this.actor.getDialogActors(compData.docCat),\r\n        Item: this.actor.getDialogItems(compData.docCat)\r\n      }[compData.docType];\r\n    }\r\n\r\n    return compData;\r\n  }\r\n  async _onItemOpenClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const {doc} = this._getCompData(event);\r\n    if (!doc) {\r\n      return;\r\n    }\r\n    doc.sheet?.render(true);\r\n  }\r\n\r\n  async _onItemAddClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const addType = $(event.currentTarget).closest(\".comp\").data(\"addType\") as string|undefined;\r\n    if (addType && addType in BladesItemType) {\r\n      await this.actor.createEmbeddedDocuments(\"Item\", [\r\n        {\r\n          name: {\r\n            [BladesItemType.cohort_gang]: \"A Gang\",\r\n            [BladesItemType.cohort_expert]: \"An Expert\"\r\n          }[addType] ?? randomID(),\r\n          type: addType\r\n        }\r\n      ]);\r\n      return;\r\n    }\r\n    const {docCat, docType, dialogDocs, docTags} = this._getCompData(event);\r\n    // eLog.checkLog(\"_onItemAddClick\", {docCat, dialogDocs});\r\n    if (!dialogDocs || !docCat || !docType) {\r\n      return;\r\n    }\r\n    await BladesSelectorDialog.Display(\r\n      this.actor,\r\n      U.tCase(`Add ${docCat.replace(/_/g, \" \")}`),\r\n      docType,\r\n      dialogDocs,\r\n      docTags\r\n    );\r\n  }\r\n\r\n  async _onItemRemoveClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const {elem$, doc} = this._getCompData(event);\r\n    if (!doc) {\r\n      return;\r\n    }\r\n    G.effects.blurRemove(elem$).then(() => {\r\n      if (doc instanceof BladesItem) {\r\n        this.actor.remSubItem(doc);\r\n      } else {\r\n        this.actor.remSubActor(doc);\r\n      }\r\n    });\r\n  }\r\n\r\n  async _onItemFullRemoveClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const {elem$, doc} = this._getCompData(event);\r\n    if (!doc) {\r\n      return;\r\n    }\r\n    G.effects.blurRemove(elem$).then(() => doc.delete());\r\n  }\r\n\r\n  async _onItemToggleClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    const target = $(event.currentTarget).data(\"target\");\r\n    this.actor.update({\r\n      [target]: !getProperty(this.actor, target)\r\n    });\r\n  }\r\n\r\n  async _onAdvanceClick(event: ClickEvent) {\r\n    event.preventDefault();\r\n    if ($(event.currentTarget).data(\"action\") === \"advance-playbook\") {\r\n      this.actor.advancePlaybook();\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region Roll Handlers\r\n  async _onRollTraitClick(event: ClickEvent) {\r\n    const trait_name = $(event.currentTarget).data(\"rollTrait\");\r\n    const roll_type = $(event.currentTarget).data(\"rollType\");\r\n    const rollData: Partial<BladesRollCollab.Config> = {};\r\n    if (U.lCase(trait_name) in {...Action, ...Attribute, ...Factor}) {\r\n      rollData.rollTrait = U.lCase(trait_name) as Action|Attribute|Factor;\r\n    } else if (U.isInt(trait_name)) {\r\n      rollData.rollTrait = U.pInt(trait_name);\r\n    }\r\n\r\n    if (U.tCase(roll_type) in RollType) {\r\n      rollData.rollType = U.tCase(roll_type) as RollType;\r\n    } else if (typeof rollData.rollTrait === \"string\") {\r\n      if (rollData.rollTrait in Attribute) {\r\n        rollData.rollType = RollType.Resistance;\r\n      } else if (rollData.rollTrait in Action) {\r\n        rollData.rollType = RollType.Action;\r\n      }\r\n    }\r\n\r\n    if (game.user.isGM) {\r\n      if (BladesActor.IsType(this.document, BladesActorType.pc) || BladesActor.IsType(this.document, BladesActorType.crew)) {\r\n        rollData.rollSource = this.document;\r\n      } else {\r\n        rollData.rollOpposition = this.document as BladesActor;\r\n      }\r\n    }\r\n\r\n    if (rollData.rollType) {\r\n      BladesRollCollab.NewRoll(rollData as BladesRollCollab.Config);\r\n    } else {\r\n      throw new Error(\"Unable to determine roll type of roll.\");\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region Active Effect Handlers\r\n  async _onActiveEffectControlClick(event: ClickEvent) {\r\n    BladesActiveEffect.onManageActiveEffect(event, this.actor);\r\n  }\r\n  // #endregion\r\n\r\n  // #endregion\r\n}\r\n\r\ninterface BladesSheet {\r\n  get actor(): BladesActor;\r\n}\r\n\r\nexport default BladesSheet;\r\n"]}