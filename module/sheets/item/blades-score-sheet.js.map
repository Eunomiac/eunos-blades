{"version":3,"sources":["../../ts/sheets/item/blades-score-sheet.ts"],"names":[],"mappings":"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","file":"blades-score-sheet.js","sourcesContent":["import U from \"../../core/utilities.js\";\r\nimport C, {BladesActorType, BladesItemType, BladesPhase, Tag, Randomizers} from \"../../core/constants.js\";\r\nimport BladesItemSheet from \"./blades-item-sheet.js\";\r\n\r\nimport {BladesActor, BladesPC} from \"../../documents/blades-actor-proxy.js\";\r\nimport {BladesItem, BladesScore} from \"../../documents/blades-item-proxy.js\";\r\nimport BladesRollCollab from \"../../blades-roll-collab.js\";\r\n\r\n\r\n/* #region BladesTipGenerator */\r\nexport enum BladesTipContext {\r\n  DiceRoll = \"DiceRoll\",\r\n  Combat = \"Combat\",\r\n  General = \"General\"\r\n}\r\n\r\nclass BladesTipGenerator {\r\n\r\n  static get Tips() {\r\n    return {\r\n      [BladesTipContext.DiceRoll]: [],\r\n      [BladesTipContext.Combat]: [\r\n        \"Every combat encounter should advance the main plot, or else it's filler.\",\r\n        \"Inject dialogue into combat encounters, especially from important adversaries.\",\r\n        \"Combat encounters should be a challenge, but not a slog. Don't be afraid to end them early.\",\r\n        \"Infiltrate/Rescue/Destroy: Use these as additional/secondary goals in combat encounters.\",\r\n        \"Tell the next player in the initiative order that they're on deck.\",\r\n        \"Don't trigger combats automatically: Use alternate objectives to incite the players to fight, giving them agency.\",\r\n        \"Add another layer by drawing focus to collateral effects of the combat: a fire, a hostage, a collapsing building, innocents in danger\"\r\n      ],\r\n      [BladesTipContext.General]: [\r\n        \"Rolling the dice always means SOMETHING happens.\",\r\n        \"Jump straight to the action; don't waste time on establishing scenes or filler.\",\r\n        \"Invoke elements of characters' backstories or beliefs to make any scene more personal.\"\r\n\r\n      ]\r\n    };\r\n  }\r\n\r\n  private tipContext: BladesTipContext;\r\n  constructor(tipContext: BladesTipContext) {\r\n    this.tipContext = tipContext;\r\n  }\r\n}\r\n/* #endregion */\r\n\r\n\r\nclass BladesScoreSheet extends BladesItemSheet {\r\n\r\n  static override get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"eunos-blades\", \"sheet\", \"item\", \"score-sheet\"],\r\n      template: \"systems/eunos-blades/templates/items/score-sheet.hbs\",\r\n      width: 900,\r\n      submitOnChange: false,\r\n      height: 970\r\n    });\r\n  }\r\n\r\n  async generateRandomizerData(category?: RandomCat) {\r\n    // Generate full set of random data.\r\n    const randomData: Record<RandomCat, Record<string, Record<string, any>>> = {\r\n      Bargains: Object.fromEntries(Object.entries(U.sample(Randomizers.GM.Bargains\r\n        .filter((bData) => !Object.values(this.document.system.randomizers.Bargains)\r\n          .some((_bData) => _bData.name === bData.name || _bData.effect === bData.effect)), 3, true, (e, a) => a\r\n        .filter((_e) => e.category === _e.category).length === 0))\r\n        .map(([k, v]) => {\r\n          k = `${k}`;\r\n          Object.assign(v, {notes: \"\"});\r\n          return [k, v];\r\n        })),\r\n      Obstacles: Object.fromEntries(Object.entries(U.sample(Randomizers.GM.Obstacles\r\n        .filter((bData) => !Object.values(this.document.system.randomizers.Obstacles)\r\n          .some((_bData) => _bData.name === bData.name || _bData.desc === bData.desc)), 3, true, (e, a) => a\r\n        .filter((_e) => e.category === _e.category).length === 0))\r\n        .map(([k, v]) => {\r\n          k = `${k}`;\r\n          Object.assign(v, {notes: \"\"});\r\n          return [k, v];\r\n        })),\r\n      NPCs: Object.fromEntries(Object.entries(U.sample(Randomizers.GM.NPCs\r\n        .filter((bData) => !Object.values(this.document.system.randomizers.NPCs)\r\n          .some((_bData) => _bData.name === bData.name || _bData.description === bData.description)), 3, true, (e, a) => a\r\n        .filter((_e) => e.arena === _e.arena).length === 0))\r\n        .map(([k, v]) => {\r\n          k = `${k}`;\r\n          Object.assign(v, {notes: \"\"});\r\n          return [k, v];\r\n        })),\r\n      Scores: Object.fromEntries(Object.entries(U.sample(Randomizers.GM.Scores\r\n        .filter((bData) => !Object.values(this.document.system.randomizers.Scores)\r\n          .some((_bData) => _bData.name === bData.name || _bData.desc === bData.desc)), 3, true, (e, a) => a\r\n        .filter((_e) => e.category === _e.category).length === 0))\r\n        .map(([k, v]) => {\r\n          k = `${k}`;\r\n          Object.assign(v, {notes: \"\"});\r\n          return [k, v];\r\n        }))\r\n    };\r\n\r\n    // If category specified, replace all other categories with stored data\r\n    if (category) {\r\n      Object.keys(randomData)\r\n        .filter((cat) => cat !== category)\r\n        .forEach((cat: string) => {\r\n          const _cat = cat as RandomCat;\r\n          randomData[_cat] = this.document.system.randomizers[_cat];\r\n        });\r\n    }\r\n\r\n    // Combine locked data stored in system with randomly-generated data\r\n    const finalRandomData: Record<RandomCat, Record<string, Record<string, any>>> = {\r\n      Bargains: {},\r\n      Obstacles: {},\r\n      NPCs: {},\r\n      Scores: {}\r\n    };\r\n\r\n    // Iterate through all randomizer categories. If system entry isLocked, use that, or use newly-generated data\r\n    Object.keys(randomData).forEach((cat: string) => {\r\n      const _cat = cat as RandomCat;\r\n      Object.entries(randomData[_cat]).forEach(([index, randData]) => {\r\n        if (this.document.system.randomizers?.[_cat][index].isLocked) {\r\n          finalRandomData[_cat][index] = this.document.system.randomizers[_cat][index];\r\n        } else {\r\n          finalRandomData[_cat][index] = randomData[_cat][index];\r\n        }\r\n      });\r\n    });\r\n\r\n    // Overwrite stored data with newly generated & merged randomizer data\r\n    this.document.update({\"system.randomizers\": finalRandomData});\r\n  }\r\n\r\n  override getData() {\r\n    const context = super.getData() as ReturnType<BladesItemSheet[\"getData\"]> & {system: ExtractBladesItemSystem<BladesItemType.score>};\r\n\r\n    const sheetData: Partial<BladesItemDataOfType<BladesItemType.score>> = {};\r\n\r\n    // Get player characters, assign simplified actionData that I probably should have coded them with from the start\r\n    sheetData.playerCharacters = BladesActor.GetTypeWithTags(BladesActorType.pc, Tag.PC.ActivePC)\r\n      .map((pc) => {\r\n        return Object.assign(\r\n          pc,\r\n          {\r\n            actionData: Object.fromEntries(Object.entries(pc.system.attributes)\r\n              .map(([attrName, attrData]) => {\r\n                return [\r\n                  attrName,\r\n                  Object.fromEntries(Object.entries(attrData)\r\n                    .map(([actionName, actionData]) => {\r\n                      return [\r\n                        U.uCase(actionName).slice(0, 3),\r\n                        actionData\r\n                      ];\r\n                    }))\r\n                ];\r\n              }))\r\n          }\r\n        );\r\n      });\r\n\r\n    // Prune system data for blank/empty opposition entries\r\n    const validOppositions: Record<string, BladesRollCollab.OppositionDocData> = {};\r\n    for (const [id, data] of Object.entries(context.system.oppositions)) {\r\n      if (!data.rollOppName && !data.rollOppSubName) { continue }\r\n      validOppositions[id] = data;\r\n    }\r\n    context.system.oppositions = validOppositions;\r\n\r\n    return {\r\n      ...context,\r\n      ...sheetData\r\n    } as ReturnType<BladesItemSheet[\"getData\"]> & {system: ExtractBladesItemSystem<BladesItemType.score>};\r\n  }\r\n\r\n  _toggleRandomizerLock(event: ClickEvent) {\r\n    const elem$ = $(event.currentTarget);\r\n    const elemCat = elem$.data(\"category\") as RandomCat;\r\n    const elemIndex = `${elem$.data(\"index\")}`;\r\n    const elemValue = elem$.data(\"value\");\r\n    if (`${elemValue}` === \"true\") {\r\n      this.document.update({[`system.randomizers.${elemCat}.${elemIndex}.isLocked`]: false});\r\n    } else {\r\n      // const rData = this.document.system.randomizers[elemCat][elemIndex];\r\n      this.document.update({[`system.randomizers.${elemCat}.${elemIndex}.isLocked`]: true});\r\n    }\r\n  }\r\n\r\n  _selectImage(event: ClickEvent) {\r\n    const elem$ = $(event.currentTarget);\r\n    const imageNum = elem$.data(\"imgNum\");\r\n    this.document.update({\"system.imageSelected\": imageNum});\r\n  }\r\n\r\n  _deselectOrDeleteImage(event: ContextMenuEvent) {\r\n    const elem$ = $(event.currentTarget);\r\n    const imageNum = elem$.data(\"imgNum\");\r\n    if (this.document.system.imageSelected === imageNum) {\r\n      // eLog.checkLog3(\"scoreSheet\", `imageSelected: ${this.document.system.imageSelected} === imgNum: ${imageNum}: DESELECTING`);\r\n      this.document.update({\"system.-=imageSelected\": null});\r\n      return;\r\n    }\r\n    const images = {...this.document.system.images};\r\n    this.document.update({\"system.-=images\": null}).then(() => this.document.update({\r\n      \"system.images\": Object.fromEntries(Object.entries(Object.values(images)\r\n        .filter((_, i) => U.pInt(imageNum) !== i)))\r\n    }));\r\n  }\r\n\r\n  _addImage() {\r\n    U.displayImageSelector(\r\n      path => {\r\n        const imgIndex = U.objSize(this.document.system.images);\r\n        return this.document.update({[`system.images.${imgIndex}`]: path});\r\n      },\r\n      \"systems/eunos-blades/assets\",\r\n      this.position\r\n    );\r\n  }\r\n\r\n  _selectRollOpposition(event: ClickEvent) {\r\n    eLog.checkLog3(\"Select Roll Opposition\", {event});\r\n    const elem$ = $(event.currentTarget);\r\n    const oppId = elem$.data(\"oppId\");\r\n    this.document.update({\"system.oppositionSelected\": oppId});\r\n    if (BladesScore.Active?.id === this.document.id && BladesRollCollab.Active) {\r\n      BladesRollCollab.Active.rollOpposition = this.document.system.oppositions[oppId];\r\n    }\r\n  }\r\n\r\n  _triggerRandomize(event: ClickEvent) {\r\n    const elem$ = $(event.currentTarget);\r\n    const category = elem$.data(\"category\");\r\n    if (category && category in Randomizers.GM) {\r\n      this.generateRandomizerData(category);\r\n    } else {\r\n      this.generateRandomizerData();\r\n    }\r\n  }\r\n\r\n  async _updateGMNotesOnPC(event: JQuery.ChangeEvent) {\r\n    const elem$ = $(event.currentTarget);\r\n    const actor = BladesActor.Get(elem$.data(\"id\"));\r\n    if (!actor) { throw new Error(`Unable to retrieve actor with id '${elem$.data(\"id\")}'`) }\r\n    const updateText = event.currentTarget.innerHTML;\r\n    eLog.checkLog3(\"scoreSheet\", \"Retrieved Text, Updating ...\", {updateText});\r\n    await actor.update({\"system.gm_notes\": updateText});\r\n    eLog.checkLog3(\"scoreSheet\", \"Updated!\", {gm_notes: actor.system.gm_notes});\r\n  }\r\n\r\n  override async activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    html.find(\"[data-action='select-image']\").on({\r\n      click: this._selectImage.bind(this),\r\n      contextmenu: this._deselectOrDeleteImage.bind(this)\r\n    });\r\n    html.find(\"[data-action='add-image']\").on({\r\n      click: this._addImage.bind(this)\r\n    });\r\n    html.find(\".roll-opposition-name\").on({\r\n      dblclick: this._selectRollOpposition.bind(this)\r\n    });\r\n    html.find(\".toggle-lock\").on({\r\n      click: this._toggleRandomizerLock.bind(this)\r\n    });\r\n    html.find(\"[data-action='randomize'\").on({\r\n      click: this._triggerRandomize.bind(this)\r\n    });\r\n\r\n    html.find(\"textarea.pc-summary-notes-body\").on({\r\n      change: this._updateGMNotesOnPC.bind(this)\r\n    });\r\n  }\r\n\r\n  override async _onSubmit(event: OnSubmitEvent, params: List<any> = {}) {\r\n    eLog.checkLog3(\"scoreSheet\", \"_onSubmit()\", {event, params, elemText: event.currentTarget.innerHTML});\r\n    let isForcingRender = true;\r\n    const elem$ = $(event.currentTarget);\r\n\r\n\r\n    const prevPhase = this.item.system.phase;\r\n    const submitData = await super._onSubmit(event, params);\r\n\r\n    const newPhase = this.item.system.phase;\r\n    if (prevPhase !== newPhase) {\r\n      switch (prevPhase) {\r\n        case BladesPhase.CharGen: {\r\n\r\n          break;\r\n        }\r\n        case BladesPhase.Freeplay: {\r\n\r\n          break;\r\n        }\r\n        case BladesPhase.Score: {\r\n          isForcingRender = false;\r\n          game.actors.filter((actor): actor is BladesPC => BladesActor.IsType(actor, BladesActorType.pc))\r\n            .forEach((actor) => actor.clearLoadout());\r\n          break;\r\n        }\r\n        case BladesPhase.Downtime: {\r\n\r\n          break;\r\n        }\r\n        // no default\r\n      }\r\n      switch (newPhase) {\r\n        case BladesPhase.CharGen: {\r\n\r\n          break;\r\n        }\r\n        case BladesPhase.Freeplay: {\r\n\r\n          break;\r\n        }\r\n        case BladesPhase.Score: {\r\n\r\n          break;\r\n        }\r\n        case BladesPhase.Downtime: {\r\n\r\n          break;\r\n        }\r\n        // no default\r\n      }\r\n    }\r\n    if (isForcingRender) {\r\n      game.actors.filter((actor) => actor.type === BladesActorType.pc)\r\n        .forEach((actor) => actor.sheet?.render());\r\n    }\r\n    return submitData;\r\n  }\r\n\r\n}\r\n\r\ndeclare interface BladesScoreSheet {\r\n  get document(): BladesScore\r\n}\r\n\r\nexport default BladesScoreSheet;"]}