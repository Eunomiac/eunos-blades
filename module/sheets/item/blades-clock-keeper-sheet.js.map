{"version":3,"sources":["../../ts/sheets/item/blades-clock-keeper-sheet.ts"],"names":[],"mappings":"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","file":"blades-clock-keeper-sheet.js","sourcesContent":["\r\nimport {BladesItemType} from \"../../core/constants.js\";\r\nimport BladesItemSheet from \"./blades-item-sheet.js\";\r\nimport BladesItem from \"../../blades-item.js\";\r\nimport BladesClockKeeper from \"../../documents/items/blades-clock-keeper.js\";\r\n\r\ntype BladesClockKeeperSheetData = Partial<BladesItemSheetData> & {\r\n  clock_keys: Record<string, BladesMultiClockData>\r\n};\r\n\r\nclass BladesClockKeeperSheet extends BladesItemSheet {\r\n\r\n  static Get() { return game.eunoblades.ClockKeeper as BladesClockKeeper }\r\n\r\n  static override get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      classes: [\"eunos-blades\", \"sheet\", \"item\", \"clock-keeper\"],\r\n      template: \"systems/eunos-blades/templates/items/clock_keeper-sheet.hbs\",\r\n      width: 700,\r\n      height: 970\r\n    });\r\n  }\r\n\r\n  static async Initialize() {\r\n    game.eunoblades ??= {};\r\n    Items.registerSheet(\"blades\", BladesClockKeeperSheet, {types: [\"clock_keeper\"], makeDefault: true});\r\n    Hooks.once(\"ready\", async () => {\r\n      let clockKeeper: BladesClockKeeper|undefined = game.items.find((item): item is BladesClockKeeper => item.type === \"clock_keeper\");\r\n      if (!clockKeeper) {\r\n        clockKeeper = (await BladesClockKeeper.create({\r\n          name: \"Clock Keeper\",\r\n          type: \"clock_keeper\",\r\n          img: \"systems/eunos-blades/assets/icons/misc-icons/clock-keeper.svg\"\r\n        })) as BladesClockKeeper;\r\n      }\r\n      game.eunoblades.ClockKeeper = clockKeeper;\r\n      game.eunoblades.ClockKeeper.renderOverlay();\r\n    });\r\n    Hooks.on(\"canvasReady\", async () => { game.eunoblades.ClockKeeper?.renderOverlay() });\r\n    return loadTemplates([\r\n      \"systems/eunos-blades/templates/items/clock_keeper-sheet.hbs\",\r\n      \"systems/eunos-blades/templates/parts/clock-sheet-row.hbs\"\r\n    ]);\r\n  }\r\n\r\n  static InitSockets() {\r\n    if (game.eunoblades.ClockKeeper) {\r\n      socketlib.system.register(\"renderOverlay\", game.eunoblades.ClockKeeper.renderOverlay);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  // override async _updateObject(event: unknown, formData: any) {\r\n  //   const updateData = await this.object.update(formData);\r\n  //   socketlib.system.executeForEveryone(\"renderOverlay\");\r\n  //   // this.item.renderOverlay();\r\n  //   return updateData;\r\n  // }\r\n\r\n  override getData() {\r\n    const context = super.getData() as ReturnType<BladesItemSheet[\"getData\"]> & List<any>;\r\n\r\n    const sheetData: BladesClockKeeperSheetData = {\r\n      clock_keys: Object.fromEntries((Object.entries(context.system.clock_keys ?? {})\r\n        .filter(([keyID, keyData]) => Boolean(keyData && keyData.scene === context.system.targetScene)))) as Record<string, BladesMultiClockData>\r\n    };\r\n\r\n    return {...context, ...sheetData} as BladesItemSheetData;\r\n  }\r\n\r\n  addKey(event: MouseEvent) {\r\n    event.preventDefault();\r\n    this.item.addClockKey();\r\n  }\r\n\r\n  deleteKey(event: MouseEvent) {\r\n    event.preventDefault();\r\n    const keyID = (event.currentTarget as HTMLElement).dataset.id;\r\n    if (keyID) {\r\n      this.item.deleteClockKey(keyID);\r\n    }\r\n  }\r\n\r\n  setKeySize(event: InputEvent) {\r\n    event.preventDefault();\r\n    const keyID = (event.target as HTMLInputElement).dataset.id;\r\n    if (keyID) {\r\n      this.item.setKeySize(keyID, parseInt((event.target as HTMLInputElement).value));\r\n    }\r\n  }\r\n\r\n  override async activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    // @ts-expect-error Fuck.\r\n    html.find(\"[data-action=\\\"add-key\\\"\").on(\"click\", this.addKey.bind(this));\r\n    // @ts-expect-error Fuck.\r\n    html.find(\"[data-action=\\\"delete-key\\\"\").on(\"click\", this.deleteKey.bind(this));\r\n    // @ts-expect-error Fuck.\r\n    html.find(\".key-clock-counter\").on(\"change\", this.setKeySize.bind(this));\r\n  }\r\n}\r\n\r\ndeclare interface BladesClockKeeperSheet {\r\n  item: BladesClockKeeper\r\n}\r\n\r\nexport default BladesClockKeeperSheet;"]}